At4util={};At4util.formatConstrainsLegacy=function(g){var b=g.XRecommended?g.XRecommended:null;var o=g.YRecommended?g.YRecommended:null;var l=g.XRecommendedMandatory?g.XRecommendedMandatory:null;var k=g.YRecommendedMandatory?g.YRecommendedMandatory:null;var h=g.XMax?g.XMax:null;var e=g.YMax?g.YMax:null;var q=g.XMaxMandatory?g.XMaxMandatory:null;var n=g.YMaxMandatory?g.YMaxMandatory:null;var d=g.XMin?g.XMin:null;var p=g.YMin?g.YMin:null;var f=g.XMinMandatory?g.XMinMandatory:null;var c=g.YMinMandatory?g.YMinMandatory:null;var a=false;var m=false;var j="";if(o||b||l||k||h||e||n||q||p||d||c||f){if(l&&b&&k&&o){j="Tamaño <b> obligatorio </b>: "+b+"x"+o+" pixels<br>"}else{if(b&&l){j+="Ancho <b>obligatorio</b>: "+b+"pixels<br>"}if(o&&k){j+="Alto <b>obligatorio</b>: "+o+"pixels<br>"}if(b&&o){j+="Tamaño <b>recomendado</b>: "+b+"x"+o+" pixeles<br>"}if(q&&h&&n&&e){j+="Tamaño <b>maximo</b>: "+h+"x"+e+" pixeles<br>";a=true}if(f&&d&&c&&p){j+="Tamaño <b>minimo</b>: "+d+"x"+p+" pixeles<br>";m=true}if(!q&&h&&!n&&e){j+="Tamaño <b>maximo recomendado</b>: "+h+"x"+e+" pixeles<br>";a=true}if(!f&&d&&!c&&p){j+="Tamaño <b>minimo recomendado</b>: "+d+"x"+p+" pixeles<br>";m=true}if(!a){if(h&&q){j+="Ancho <b>maximo obligatorio</b>: "+h+"pixeles <br>"}else{if(h){j+="Ancho <b>maximo recomendado</b>: "+h+"pixeles <br>"}}}if(e&&n){j+="Alto <b>maximo obligatorio</b>: "+e+"pixeles <br>"}else{if(e){j+="Alto <b>maximo recomendado</b>: "+e+"pixeles <br>"}}if(!m){if(d&&f){j+="Ancho <b>minimo obligatorio</b>: "+d+"pixeles <br>"}else{if(p){j+="Ancho <b>minimo recomendado</b>: "+d+"pixeles <br>"}}}if(p&&c){j+="Alto <b>minimo obligatorio</b>: "+p+"pixeles <br>"}else{if(p){j+="Alto <b>minimo recomendado</b>: "+p+"pixeles <br>"}}}}else{j="No hay restricciones para este archivo"}return j};At4util.formatConstrainsLocale=function(g){var b=g.XRecommended?g.XRecommended:null;var p=g.YRecommended?g.YRecommended:null;var m=g.XRecommendedMandatory?g.XRecommendedMandatory:null;var k=g.YRecommendedMandatory?g.YRecommendedMandatory:null;var h=g.XMax?g.XMax:null;var e=g.YMax?g.YMax:null;var r=g.XMaxMandatory?g.XMaxMandatory:null;var o=g.YMaxMandatory?g.YMaxMandatory:null;var d=g.XMin?g.XMin:null;var q=g.YMin?g.YMin:null;var f=g.XMinMandatory?g.XMinMandatory:null;var c=g.YMinMandatory?g.YMinMandatory:null;var a=false;var n=false;var j="";var l=At4util.constrainsLang;if(p||b||m||k||h||e||o||r||q||d||c||f){if(m&&b&&k&&p){j=l.tObligado+Ext.String.format(l.dos,b,p)+l.br}else{if(b&&m){j+=l.wObligado+Ext.String.format(l.uno,b)+l.br}if(p&&k){j+=l.hObligado+Ext.String.format(l.uno,p)+l.br}if(b&&p){j+=l.tRecomendado+Ext.String.format(l.dos,b,p)+l.br}if(r&&h&&o&&e){j+=l.tMax+Ext.String.format(l.dos,h,e)+l.br;a=true}if(f&&d&&c&&q){j+=l.tMin+Ext.String.format(l.dos,d,q)+l.br;n=true}if(!r&&h&&!o&&e){j+=l.tMaxRecomendado+Ext.String.format(l.dos,h,e)+l.br;a=true}if(!f&&d&&!c&&q){j+=l.tMinRecomendado+Ext.String.format(l.dos,d,q)+l.br;n=true}if(!a){if(h&&r){j+=l.wMaxObligado+Ext.String.format(l.uno,h)+l.br}else{if(h){j+=l.wMaxRecomendado+Ext.String.format(l.uno,h)+l.br}}}if(e&&o){j+=l.hMaxObligado+Ext.String.format(l.uno,e)+l.br}else{if(e){j+=l.hMaxRecomendado+Ext.String.format(l.uno,e)+l.br}}if(!n){if(d&&f){j+=l.wMinObligado+Ext.String.format(l.uno,d)+l.br}else{if(q){j+=l.wMinRecomendado+Ext.String.format(l.uno,d)+l.br}}}if(q&&c){j+=l.hMinObligado+Ext.String.format(l.uno,q)+l.br}else{if(q){j+=l.hMinRecomendado+Ext.String.format(l.uno,q)+l.br}}}}else{j=l.noHay}return j};At4util.formatConstrains=function(b){var a=true;if(a){return At4util.formatConstrainsLocale(b)}return At4util.formatConstrainsLegacy(b)};At4util.formatFileConstrainsString=function(d){var e=At4util.constrainsLang;var b=e.br;var a="";if(d.maxKb>0){a+=e.tMax+" "+d.maxKb+e.kb+b}a+=b+e.formatosAdmitidos+b;var c=0;for(i in d.mimeTypes){if(c!=0){a+=", "}c++;a+=i}if(c==0){a+=e.todosFormatos}return a};At4util.formatFileConstrainsTable=function(d){var e=At4util.constrainsLang;var b=e.br;var a="";if(d.maxKb>0){a+=e.tMax+" "+d.maxKb+e.kb+b}a+=b+e.formatosAdmitidos+b;var c=Object.keys(d.mimeTypes).length;if(c>0){a+=e.table.start;for(i in d.mimeTypes){a+=Ext.String.format(e.table.row,i,d.mimeTypes[i])}a+=e.table.end}if(c==0){a+=e.todosFormatos}return a};At4util.formatFileConstrains=function(b){var a=false;if(a){return At4util.formatFileConstrainsTable(b)}return At4util.formatFileConstrainsString(b)};At4util.icons={plus:"glyphicons glyphicons-plus-sign",update:"glyphicons glyphicons-restart",remove:"glyphicons glyphicons-bin",editar:"glyphicons glyphicons-edit",add:"glyphicons glyphicons-plus-sign",exportar:"glyphicons glyphicons-file-export",close:"glyphicons glyphicons-remove",order:"glyphicons glyphicons-disk-saved",herramientas:"glyphicons glyphicons-settings",avanzado:"glyphicons glyphicons-more-windows",configure:"glyphicons glyphicons-cogwheel",save:"glyphicons glyphicons-floppy-disk",restart:"glyphicons glyphicons-restart",apply:"glyphicons glyphicons-download-alt",auditarForm:"glyphicons glyphicons-cardio",validarForm:"glyphicons glyphicons-eye-open",validar:"glyphicons glyphicons-ok-circle",rechazar:"glyphicons glyphicons-remove-circle",posponer:"glyphicons glyphicons-roundabout",};At4util.formatTitularLabel=function(a){var e=a.nombre;var c=a.apellidos;var b=a.apellidosRepresentante;var d="";if(e!=null){d+=e+" - "}d+=c;if(b!=null){d+=" - "+b}return d};At4util.tabIndexHelper=function(a,b){this.tabItem=a?a:1;this.tabsPerItem=b?b:100};At4util.tabIndexHelper.prototype.getNext=function(){this.tabItem=this.tabItem+this.tabsPerItem;return this.tabItem};Ext.define("At4FrameworkIntranet.FormDefaults",{singleton:true,resumenAuditoriaTitleText:"Resumen de auditoría",resumenAuditoriaModUserTextLabel:"Usuario modificación",resumenAuditoriaModUserTextQtip:"Usuario que modificó el registro por última vez",resumenAuditoriaCreatorUserTextLabel:"Usuario creación",resumenAuditoriaCreatorUserTextQtip:"Usuario que dio de alta el registro",resumenAuditoriaModDateTextLabel:"Fecha modificación",resumenAuditoriaModDateTextQtip:"Fecha en que se modificó el registro por última vez",resumenAuditoriaCreatorDateTextLabel:"Fecha creación",resumenAuditoriaCreatorDateTextQtip:"Fecha en que se dio de alta el registro",NUMBER_FIELD_WIDTH:50,TEXT_FIELD_WIDTH:400,TEXT_FIELD_WIDTH_200:200,COLOR_FIELD_WIDTH:205,DOBLE_TEXT_FIELD_WIDTH:660,YMEDIO_TEXT_FIELD_WIDTH:490,HALF_TEXT_FIELD_WIDTH:150,THIRD_TEXT_FIELD_WIDTH:265,THIRD_TEXT_FIELD_LABEL_WIDTH:170,QUARTER_TEXT_FIELD_WIDTH:90,TINY_TEXT_FIELD_WIDTH:65,TEXTAREA_FIELD_WIDTH:410,TEXTAREA_FIELD_HEIGHT:180,TEXTAREA_FIELD_HEIGHT_250:250,TEXTAREA_FIELD_HEIGHT_150:150,DECIMAL_SEPARATOR:".",COLUMN_DEFAULTS:{msgTarget:"under",validationEvent:true,border:false,labelAlign:"top",autoHeight:true,autoWidth:true,collapsible:false,},FIELD_DEFAULTS:{msgTarget:"under",border:false,labelAlign:"top"},USER_REGEX:/^([A-Za-z0-9\_\-]+)$/,getStore:function(j,h,c,d){var a=[{name:"ID"},{name:"DISPLAY"}];if(h){if(h instanceof Array){for(i in h){var f=h[i];a=a.concat(f)}}else{a=a.concat(h)}}if(!c){c={}}var e="At4FrameworkIntranet.generic-"+j+"dataModel";var b="";if(Ext.ClassManager.isCreated(e)){b=Ext.ClassManager.get(e)}else{b=Ext.define(e,{extend:"Ext.data.Model",proxy:serverDatabaseActions.createRelationPopupProxy(j,e,c.reader,d),fields:a})}if(!c.hasOwnProperty("remoteSort")){c.remoteSort=true}if(!c.hasOwnProperty("remoteFilter")){c.remoteFilter=true}c.model=e;var g=Ext.create("Ext.data.Store",c);if(c.liveFiltersFn){g.addListener("beforeload",function(l,k){var n=c.liveFiltersFn();if(n&&n.length>0){var m=k.getConfig("filters");if(!m){m=[]}k.setConfig("filters",m.concat(n))}})}return g},getFieldLabel:function(a,b){return At4FrameworkIntranet[a].prototype[b+"HeaderLabel"]},resumenAuditoria:function(){var a=[];a.dateCreation=new Ext.form.DateField({name:"dateCreation",fieldLabel:this.resumenAuditoriaCreatorDateTextLabel,labelAlign:"top",labelAttrTpl:" data-qtip='"+this.resumenAuditoriaCreatorDateTextQtip+"'",disabled:true,width:At4FrameworkIntranet.FormDefaults.HALF_TEXT_FIELD_WIDTH,format:"d-m-Y"});a.lastModified=new Ext.form.DateField({name:"lastModified",fieldLabel:this.resumenAuditoriaModDateTextLabel,labelAlign:"top",labelAttrTpl:" data-qtip='"+this.resumenAuditoriaModDateTextQtip+"'",disabled:true,width:At4FrameworkIntranet.FormDefaults.HALF_TEXT_FIELD_WIDTH,format:"d-m-Y"});a.creatorUser=new Ext.form.TextField({name:"creatorUser",fieldLabel:this.resumenAuditoriaCreatorUserTextLabel,labelAlign:"top",labelAttrTpl:" data-qtip='"+this.resumenAuditoriaCreatorUserTextQtip+"'",disabled:true,width:At4FrameworkIntranet.FormDefaults.HALF_TEXT_FIELD_WIDTH,maxLength:32});a.modUser=new Ext.form.TextField({name:"modUser",fieldLabel:this.resumenAuditoriaModUserTextLabel,labelAlign:"top",labelAttrTpl:" data-qtip='"+this.resumenAuditoriaModUserTextQtip+"'",disabled:true,width:At4FrameworkIntranet.FormDefaults.HALF_TEXT_FIELD_WIDTH,maxLength:32});return{xtype:"fieldset",layout:{type:"table",columns:2},defaults:{columnWidth:200,msgTarget:"under",validationEvent:true,border:false,labelAlign:"top",autoHeight:true,autoWidth:true,collapsible:false,bodyStyle:"padding: 0 15px 0 0"},border:true,labelAlign:"top",autoHeight:true,autoWidth:false,width:500,animCollapse:true,collapsed:true,collapsible:true,title:this.resumenAuditoriaTitleText,style:"margin-top: 20px",items:[{xtype:"fieldset",items:[a.dateCreation]},{xtype:"fieldset",items:[a.creatorUser]},{xtype:"fieldset",items:[a.lastModified]},{xtype:"fieldset",items:[a.modUser]}]}},columns:function(h,b){var l=At4FrameworkIntranet.FormDefaults.COLUMN_DEFAULTS;var d=At4FrameworkIntranet.FormDefaults.FIELD_DEFAULTS;var k=h.length;var a=h[0].length;var g=-1;if(b&&b.tabIndex){g=b.tabIndex}for(var e=0;e<k;e++){if(h[e].length>a){a=h[e].length}if(g==-1){for(var c=0;c<h[e].length;c++){if(h[e][c].tabIndex){g=h[e][c].tabIndex;break}}}}var f=[];for(var e=0;e<a;e++){f[e]={xtype:"fieldset",cls:"at4-fieldset",defaults:{labelAlign:"top",padding:0,},items:[]};for(var c=0;c<k;c++){if(h[c][e]){f[e].items[c]=h[c][e];f[e].items[c].parentSubFormItem=f[e];if(g!=-1){}}}}return{xtype:"container",layout:"column",defaults:l,border:false,labelAlign:"top",style:"padding: 0",autoHeight:true,width:"100%",collapsible:false,items:f}},rows:function(b,a,e){var c=[];Ext.each(b,function(g,j,f){var h=[];Ext.each(g,function(l,k,m){h.push(l)});c.push(Ext.apply({xtype:"At4Framework-rowContainer",items:h},e))});var d=Ext.apply({xtype:"At4Framework-fieldmainpanel",items:c},a);return d},debugButton:function(a){return{text:"debug",hidden:!window.At4Framework_modoDesarrollo,scope:a,handler:function(){var b=a.getForm().getValues();console.log(b);var c=function(d){var f="<table><tr><td>Field</td><td>Value</td></tr>";for(i in d){var e=d[i]?d[i]:"undefined";f+="<tr><td>"+i+"</td><td>"+e+"</td></tr>"}f+="</table>";return f};Ext.create("Ext.window.Window",{title:"debug",resizable:true,autoScroll:true,width:500,height:400,html:c(b)}).show()}}},tabIndexer:function(a,c){if(!c){c=0;for(i in a){if(a.hasOwnProperty(i)&&a[i].tabindex){c=Math.max(c,a[i].tabindex)}}}var b=c;for(i in a){if(a.hasOwnProperty(i)){a[i].tabIndex=b++}}return a},radioMaker:function(a,b){var c=[];Ext.each(a,function(f,e,d){c.push({})})},size:function(d,c,b){var a=20*c;return(((b*this.BASE_SIZE)-a)/b)*d},BASE_SIZE:70,});Ext.namespace("Ext.util");Ext.util.Format.euroMoney=function(a){a=(Math.round((a-0)*100))/100;a=(a==Math.floor(a))?a+".00":((a*10==Math.floor(a*10))?a+"0":a);a=String(a);var e=a.split(".");var d=e[0];var b=e[1]?","+e[1]:",00";var c=/(\d+)(\d{3})/;while(c.test(d)){d=d.replace(c,"$1.$2")}a=d+b;return a+" €"};Ext.util.Format.Doblers=function(a){a=(Math.round((a-0)*100))/100;a=(a==Math.floor(a))?a+".00":((a*10==Math.floor(a*10))?a+"0":a);a=String(a);var e=a.split(".");var d=e[0];var b=e[1]?","+e[1]:",00";var c=/(\d+)(\d{3})/;while(c.test(d)){d=d.replace(c,"$1.$2")}a=d+b;return a};Ext.util.Format.esNumber=function(a){a=String(a);var e=a.split(".");var d=e[0];var b=e[1]?","+e[1]:"";var c=/(\d+)(\d{3})/;while(c.test(d)){d=d.replace(c,"$1.$2")}return d+b};Ext.apply(Ext.util.Format,{numberFormat:{decimalSeparator:",",decimalPrecision:2,groupingSeparator:".",groupingSize:3,currencySymbol:"€"},formatNumber:function(c,a){var d=Ext.apply(Ext.apply({},this.numberFormat),a);if(typeof c!=="number"){c=String(c);if(d.currencySymbol){c=c.replace(d.currencySymbol,"")}if(d.groupingSeparator){c=c.replace(new RegExp(d.groupingSeparator,"g"),"")}if(d.decimalSeparator!=="."){c=c.replace(d.decimalSeparator,".")}c=parseFloat(c)}var e=c<0;c=Math.abs(c).toFixed(d.decimalPrecision);var b=c.indexOf(".");if(b>=0){if(d.decimalSeparator!=="."){c=c.slice(0,b)+d.decimalSeparator+c.slice(b+1)}}else{b=c.length}if(d.groupingSeparator){while(b>d.groupingSize){b-=d.groupingSize;c=c.slice(0,b)+d.groupingSeparator+c.slice(b)}}if(d.currencySymbol){c=d.currencySymbol+c}if(e){c="-"+c}return c}});Ext.apply(Ext.form.VTypes,{daterange:function(d,c){var b=c.parseDate(d);if(!b){return false}if(c.startDateField){var e=Ext.getCmp(c.startDateField);if(!e.maxValue||(b.getTime()!=e.maxValue.getTime())){e.setMaxValue(b);e.validate()}}else{if(c.endDateField){var a=Ext.getCmp(c.endDateField);if(!a.minValue||(b.getTime()!=a.minValue.getTime())){a.setMinValue(b);a.validate()}}}return true},password:function(c,b){if(b.initialPassField){var a=Ext.getCmp(b.initialPassField);return(c==a.getValue())}return true},passwordText:"Passwords do not match"});Ext.define("At4FrameworkIntranet.ApplicationBasic",{extend:"Ext.Mixin",statusBarDefaultTxt:"Listo",cargandoMenuTxt:"Cargando menú...",registerTabTitle:"{0}: registro",newRegisterTabTitle:"{0}: nuevo",registerTabTitleAperturaDirecta:"{0}: ",startTabTitle:"Inicio",sessionExpiredTitle:"Sesión expirada",sessionExpiredMsg:'Su sesión ha expirado, por favor, autentifíquese de nuevo.\nPara evitar esto en el futuro, marque la casilla "Recordar la contraseña"',introducir:"Introducir:",error:"Error",idioma:"es",tema:At4Framework_activeTheme?At4Framework_activeTheme:"at4",contextPath:"/acireback",toolbar:null,tabPanel:null,statusBar:null,menuSearchPlaceholder:"Abrir...",afterRelogFormMsg:"Su sesión caducó al realizar su última acción y ésta fue rechazada, por favor vuelva a realizar dicha acción.",afterRelogFormTitle:"Advertencia!",});Ext.define("At4FrameworkIntranet.mixin.simpleMultilang",{extend:"Ext.Mixin",menuAll:null,flagSetValue:true,width:At4FrameworkIntranet.FormDefaults.TEXT_FIELD_WIDTH,langs:["Es","Ca"],initComponent:function(c){var b;var e;var a;this.inputs={};this.inputsArray=[];var c=c?c:"Text";this.currentLang=0;for(b=0;b<this.langs.length;b++){e=this.langs[b];a=this.name+e;var d=Ext.create("Ext.form.field."+c,{name:this.name+e,multilang:this,lang:e,style:"margin: 0px 3px 0px 3px; left: 0px; width: 100%",labelAlign:"left",hidden:true,triggers:{selIdioma:{cls:"multilang-icon-"+e,extraCls:"multilang-icon-static"}},setValue:function(f){Ext.form.field[c].superclass.setValue.call(this,f);this.multilang.setLangValue(this.lang,f)}});this.inputs[e]=d;if(this.parentForm){this.parentForm.hiddenFields.push(d)}this.inputsArray.push(d)}this.menuAll=Ext.create("Ext.menu.Menu",{cls:"multilang-menu",layout:"vbox"})},seleccionarIdioma:function(a){this.inputs[this.langs[this.currentLang]].setValue(this.getValue());var b=this.currentLang;this.currentLang=a;if(this.currentLang>=this.langs.length){this.currentLang=0}if(this.currentLang<0){this.currentLang=this.langs.length-1}this.setValue(this.inputs[this.langs[this.currentLang]].getValue());this.triggers.selIdioma.el.removeCls("multilang-icon-"+this.langs[b]).addCls("multilang-icon-"+this.langs[this.currentLang])},setLangValue:function(b,a){if(b!==this.langs[this.currentLang]){return}if(!this.flagSetValue){this.flagSetValue=true;return}this.setValue(a)},listeners:{render:function(d,c){var b,e,a;for(b=0;b<this.langs.length;b++){e=this.langs[b];a=this.name+e;this.ownerCt.add(this.inputs[e])}},change:function(){var a=this.inputs[this.langs[this.currentLang]];var b=this.getValue();a.setValue(b,true);this.flagSetValue=false}},checkError:function(a){return this.currentLang==0}});Ext.define("At4FrameworkIntranet.mixin.MenuMultilang",{extend:"At4FrameworkIntranet.mixin.simpleMultilang",desplegarIdiomas:function(){if(!this.itemsAddedToMenu){this.menuAll.add(this.menuItems);this.itemsAddedToMenu=true}for(i=0;i<this.menuAll.items.items.length;i++){if(this.menuAll.items.items[i].lang==this.langs[this.currentLang]){this.menuAll.items.items[i].hide()}else{this.menuAll.items.items[i].show()}}var a=this.getXY();a[1]=a[1]+this.getHeight();this.menuAll.setWidth(this.getWidth());this.menuAll.showAt(a)},initComponent:function(){this.callParent(arguments);this.menuItems=[];Ext.each(this.inputsArray,function(b,e,a){var d={xtype:"textfield",triggers:b.triggers,lang:b.lang,inputMainField:b,listeners:{change:{fn:function(g,f){this.setValue(f)},scope:b},render:{fn:function(g,f){g.setValue(g.inputMainField.getValue())}}},};this.menuItems.push(d);var c=function(g,f){if(g.tempField){console.log("tempField changed");g.tempField.setValue(f)}else{for(i in this.menuAll.items.items){if(this.menuAll.items.items.hasOwnProperty(i)){g.tempField=this.menuAll.items.items[i];if(g.tempField.lang==g.lang){g.tempField.setValue(f);break}}}}};b.addListener("change",c,this)},this)},menuItems:[],itemsAddedToMenu:false,listeners:{render:function(d,c){var b,e,a;for(b=0;b<this.langs.length;b++){e=this.langs[b];a=this.name+e;this.ownerCt.add(this.inputs[e])}},keypress:function(b,d,c){var a=true;switch(d.keyCode){case 13:a=true;break;case 18:a=false;break;default:return}a=d.shiftKey?!a:a;if(a){this.seleccionarIdioma(this.currentLang+1)}else{this.seleccionarIdioma(this.currentLang-1)}},change:function(){this.inputs[this.langs[this.currentLang]].setValue(this.getValue(),true)}},});Ext.define("At4FrameworkIntranet.mixin.DroppedMultilang",{extend:"At4FrameworkIntranet.mixin.simpleMultilang"});Ext.define("At4FrameworkIntranet.At4FrameworkIntranet",{extend:"At4FrameworkIntranet.ApplicationBasic",toolbarHeight:45,headerImageWidth:160,showUserLogoutButton:true,showTemaButton:true,showLangButton:true,availableLangs:["ca","es","en"],constructor:function(j){Ext.apply(this,j);dwr.engine.setTextHtmlHandler(this.openLogin.bind(this));this.cache={constrains:{}};this.util={};this.toolbar=Ext.create("Ext.toolbar.Toolbar",{cls:"top-toolbar",height:this.toolbarHeight,columnWidth:1,flex:1,width:"100%",border:false,items:[" "]});var f=Ext.get("header");var d=[];if(f){d.push({xtype:"box",el:"header",border:false})}var e=f?f.getBottom()+this.toolbarHeight:this.toolbarHeight;this.headerHeight=e;var a=215;this.headerImageLogo=Ext.create("Ext.Img",{src:"img/applogo.png",width:a,height:e,imgCls:"logo",autoEl:{tag:"a",href:".",target:"_self",width:a,height:e,},cls:"headerImage",region:"west",});d.push(this.toolbar);this.headerPanel=Ext.create("Ext.Panel",{border:false,layout:"hbox",region:"north",height:e,items:d,cls:"header-panel",header:false,});this.statusBar=Ext.create("Ext.ux.StatusBar",{id:"At4Framework-status",autoClear:10000,defaultText:this.statusBarDefaultTxt});var c;var b=At4Framework_modoDesarrollo?"At4FrameworkIntranet.MainTabPanel":"Ext.tab.Panel";this.tabPanel=Ext.create(b,{region:"center",layoutOnTabChange:true,stateful:true,stateId:"maintabpanel",deferredRender:false,autoScroll:true,enableTabScroll:true,margins:"0 4 4 0",activeTab:0,bodyStyle:"overflow: hidden",cls:"at4-top-toolbar",width:900,application:this,bbar:this.statusBar,items:[],plugins:[Ext.create("Ext.ux.TabCloseMenu",{})],});c=this.tabPanel;var h=Ext.get("footer");if(h){var g=Ext.create("Ext.container.Container",{border:false,layout:"fit",region:"south",cls:"alma-header",height:31,items:[{el:h}]})}this.viewport=Ext.create("Ext.container.Viewport",{layout:"border",border:false,padding:"48 0 0 0",items:[this.headerPanel,c,g]});this.updateToolbar(At4FrameworkIntranet.Bootstraper.menuPrincipal);Ext.GlobalEvents.addListener({resize:{fn:function(k,l,m){this.hideTopMenu();this.onViewResize(k,l,m)},scope:this}})},hideTopMenu:function(){var a=Ext.getBody().getViewSize().width;this.headerOpen=false;this.headerPanel.setHeight(this.headerHeight)},onViewResize:function(a,b,c){var d=Ext.WindowManager.getActive();if(d){if(d.xtype=="at4window"){if(d.originalWidth<a){d.setWidth(d.originalWidth)}else{d.setWidth(a)}if(d.originalHeight<b){d.setHeight(d.originalHeight)}else{d.setHeight(b)}}d.center()}},saveGridListMetaData:function(a,b){if(!gridMetaDataCache[a.form]){gridMetaDataCache[a.form]=b}},updateToolbar:function(a){var d=a.menus;var e={handler:this.onItemClick,scope:this,cls:"at4-menuButton",scale:"small",titleAlign:"left",};for(var b=0;b<d.length;b++){if(d[b].menu&&d[b].menu.items){setMenuDefaults(d[b].menu,Ext.apply({},{},e));d[b].menu.cls="at4-headerMenu";this.toolbar.insert(b,Ext.apply({text:d[b].text,iconCls:d[b].iconCls,scale:"small",menu:Ext.create("Ext.menu.Menu",d[b].menu)},e))}else{Ext.apply(d[b],e);this.toolbar.insert(b,d[b])}}this.toolbar.add("->");var g=false;if(this.showUserLogoutButton){g={id:"userLogoutButton",cls:"at4-menuButton",scale:"small",iconCls:"glyphicons glyphicons-user glyph-white",text:window.username,menu:Ext.create("Ext.menu.Menu",{cls:"at4-headerMenu",items:[{id:"logoutButton",iconCls:"glyphicons glyphicons-log-out",text:this.salirTxt,handler:function(){location.href=window.logoutUrl},width:"auto",},{iconCls:"glyphicons glyphicons-server-ban",text:this.olvidarEstadosTexto,id:"stateResetButton",scope:this,handler:function(){Ext.Msg.show({title:this.borrarestadAplicacion,message:this.mensajeReset,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,scope:this,fn:function(h){if(h==="yes"){Ext.MessageBox.wait("Recargando","Espere..");var j=Ext.state.Manager.getProvider();for(var k in j.state){Ext.state.Manager.clear(k)}Ext.state.Manager.getProvider().on("savesuccess",function(){window.location.reload()},this)}}})},}]})};this.toolbar.add(g)}var c=false;if(this.showTemaButton){c={cls:"at4-menuButton",tooltip:"Tema",tooltip:this.temaTxt,iconCls:"glyphicons glyphicons-picture",menu:Ext.create("Ext.menu.Menu",{items:[{id:"at4ThemeButton",text:"Desktop",checked:(this.tema=="at4"?true:false),group:"theme",handler:null,scope:this,checkHandler:this.onChangeTheme},{id:"at4TouchThemeButton",text:"Touch",checked:(this.tema=="at4-touch"?true:false),group:"theme",handler:null,scope:this,checkHandler:this.onChangeTheme},{id:"at4AcireButton",text:"Acire",checked:(this.tema=="at4-touch-acire"?true:false),group:"theme",handler:null,scope:this,checkHandler:this.onChangeTheme},{id:"crispThemeButton",text:"Tema Crisp",checked:(this.tema=="crisp"?true:false),group:"theme",handler:null,scope:this,checkHandler:this.onChangeTheme},{id:"crispTouchThemeButton",text:"Tema Crisp Touch",checked:(this.tema=="crisp-touch"?true:false),group:"theme",handler:null,scope:this,checkHandler:this.onChangeTheme}]})};this.toolbar.add(c)}var f=false;if(this.showLangButton){f={tooltip:(this.idioma=="en"?"English":this.idioma=="es"?"Castellano":"Català"),cls:"at4-menuButton",text:"Idioma",iconCls:"glyphicons glyphicons-globe-af",menu:Ext.create("Ext.menu.Menu",{cls:"at4-headerMenu",items:[{id:"langButtonEN",text:"English",checked:(this.idioma=="en"?true:false),group:"idioma",handler:null,scope:this,hidden:this.availableLangs.indexOf("en")==-1,checkHandler:this.onChangeLang},{id:"langButtonES",text:"Castellano",checked:(this.idioma=="es"?true:false),handler:null,group:"idioma",scope:this,hidden:this.availableLangs.indexOf("es")==-1,checkHandler:this.onChangeLang},{id:"langButtonCA",text:"Català",checked:(this.idioma=="ca"?true:false),handler:null,group:"idioma",scope:this,hidden:this.availableLangs.indexOf("ca")==-1,checkHandler:this.onChangeLang}]})};this.toolbar.add(f)}if(this.customToolbarButton){this.toolbar.add(this.customToolbarButton)}this.toolbar.doLayout();this.statusBar.clearStatus({useDefaults:true})},onChangeLang:function(c,b){if(b){var a="./index.html?lang=";switch(c.id){case"langButtonCA":a+="ca";break;case"langButtonES":a+="es";break;case"langButtonEN":a+="en";break;default:break}location.href=a}},onChangeTheme:function(c,b){if(b){var a="./index.html?tema=";switch(c.id){case"at4ThemeButton":a+="at4";break;case"at4TouchThemeButton":a+="at4-touch";break;case"crispThemeButton":a+="crisp";break;case"crispTouchThemeButton":a+="crisp-touch";break;case"at4AcireButton":a+="at4-touch-acire";break;default:break}location.href=a}},onItemClick:function(a,b){b.stopEvent();if(a.menu){return}this.hideTopMenu();this.openMenuFormItem(a)},openMenuFormItem:function(a){if(a.link){this.updateTab(a.href,a.text,a.href,a.iconCls)}else{switch(a.mode){case"list":if(gridMetaDataCache[a.form]){this.openListGrid(a,gridMetaDataCache[a.form])}else{serverGui.getListMetadata(a,this.openListGrid,this)}break;case"new":this.openNewRecordForm(a);break;case"plain":switch(a.form){case"configuracion":this.openRecordForm({form:"configuracion",},{oid:"1"});break;case"validar":serverDatabaseActions.runAction(ValidacionService.obtenerInfraccionParaValidar,[],this.openValidar,serverDatabaseActions.exceptionHandler,this);break;case"auditar":serverDatabaseActions.runAction(ValidacionService.obtenerInfraccionParaAuditar,[],this.openAuditar,serverDatabaseActions.exceptionHandler,this);break;case"obrirManualGeneral":this.openPdf(a,"docs/manual.pdf");break}break}}},openRecordForm:function(c,b,a,e){var d={data:b,isState:e};if(gridMetaDataCache[c.form]){this.doOpenRecordForm(c,gridMetaDataCache[c.form],d,a)}else{serverGui.getListMetadata(c,this.doOpenRecordForm,this,d)}},doOpenRecordForm:function(h,g,j,c){var f=j.data;var l=j.isState;if(!gridMetaDataCache[h.form]){gridMetaDataCache[h.form]=g}var e=f.oid||f.id||f.clave;e=String(e).replace(" ","");var a=h.form;var b=a+"-plainRecord-"+e.replace(/[_|.]/g,"-");var d=this.getTab(b);if(!d){var k=h.text?h.text:g.formItem.text;k=c||Ext.String.format(this.registerTabTitle,k);d=Ext.create("At4FrameworkIntranet."+g.formClassName,this,a,g,{id:b+Ext.id(),closable:true,closeAction:"destroy",iconCls:h.iconCls,isStateLoaded:!!l,title:k});this.tabPanel.add(d);this.registerTabId(b,d);d.loadData(e,f)}this.tabPanel.setActiveTab(d)},openNewRecordForm:function(d,c,a){var b={formItem:d,extraCfg:c,requiredData:a};if(gridMetaDataCache[d.form]){this.doOpenNewRecordForm(d,gridMetaDataCache[d.form],b)}else{serverGui.getListMetadata(d,this.doOpenNewRecordForm,this,b)}},openNewWindowForm:function(b,a){if(gridMetaDataCache[b.form]){this.doOpenNewWindowForm(b,gridMetaDataCache[b.form],a)}else{serverGui.getListMetadata(b,this.doOpenNewWindowForm,this,a)}},doOpenNewWindowForm:function(c,d,a){if(!gridMetaDataCache[c.form]){gridMetaDataCache[c.form]=d}var b=Ext.create("Ext.window",{title:c.text,closable:true,modal:true,closeAction:"hide",width:720,height:670,deferredRender:false,plain:true,layout:"fit",items:[Ext.create(At4FrameworkIntranet[d.formClassName],this,c.form,d,{closable:true})]});b.parentList=a;b.show()},doOpenNewRecordForm:function(j,g,c){var h=c.requiredData;var a=c.extraCfg?c.extraCfg:{};if(!gridMetaDataCache[j.form]){gridMetaDataCache[j.form]=g}var b=j.form;var d=b+"-newForm";var e=this.getTab(d);if(!e){var k=j.text?j.text:g.formItem.text;k=Ext.String.format(this.newRegisterTabTitle,k);var f=Ext.apply({closable:true,isNewForm:true,id:g.formClassName+"-newForm"+Ext.id(),iconCls:j.iconCls,title:k},a);e=Ext.create("At4FrameworkIntranet."+g.formClassName,this,b,g,f);if(h){e.setValues(h);console.log("RequiredData values set!")}this.tabPanel.add(e);this.registerTabId(d,e)}this.tabPanel.setActiveTab(e)},onNewRecordDone:function(f,h){var a=h.formName;text=f.title;var g=h.rowid;if(gridMetaDataCache[h.formName]){var k=gridMetaDataCache[h.formName].formItem;text=k.text}f.setTitle(Ext.String.format(this.registerTabTitle,text));this.unRegisterTabId(f);var b=a+"-plainRecord-"+g;this.registerTabId(b,f);var l=a+"-list";var m=this.getTab(l);if(m){m.store.reload()}if(h.formName=="titular"){var e=this.getTab("contrato-newForm");if(e){var d=f.getValues();var j=At4util.formatTitularLabel(d);var c={titularId:g,titularLabel:j};e.setValues(c)}}},onUpdateRecordDone:function(c){var a=c.formName;var d=a+"-list";var b=this.getTab(d);if(b){b.store.reload()}},onDeleteRecordDone:function(c,f){var g=gridMetaDataCache[f.formName].formItem;var a=g.form;var e=f.rowid;var b=a+"-plain-"+e;var d=this.getTab(b);if(d){this.unRegisterTabId(d);this.tabPanel.remove(d)}var h=g.form+"-list";var j=this.getTab(h);if(j&&c.id!=j.id){j.store.reload();j.show()}},openCustomListGrid:function(c,b,a){b.extraId=c;if(gridMetaDataCache[b.form]){this.openListGrid(b,gridMetaDataCache[b.form],a)}else{serverGui.getListMetadata(b,this.openListGrid,this,a)}},openListGrid:function(c,f,a){if(!gridMetaDataCache[c.form]){gridMetaDataCache[c.form]=f}var b=c.form+"-list";if(c.extraId){b+="-"+c.id}var d=this.getTab(b);if(!d){var e=c.text?c.text:f.formItem.text;d=new Ext.create("At4FrameworkIntranet."+f.listClassName,this.tabPanel,{id:b+Ext.id(),closable:true,title:e,stateId:b,closeAction:"destroy",stateful:true,tipo:"normal",iconCls:c.iconCls},this,f,a);this.tabPanel.add(d);this.registerTabId(b,d)}this.tabPanel.setActiveTab(d)},openLogin:function(c,a){var b="pdf_"+Ext.ux.util.MD5(a);console.error("Esto no se deberia estar llamando");return this.addTab(b,c.text,a,c.iconCls)},openPdf:function(c,a){var b="pdf_"+Ext.ux.util.MD5(a);return this.addTab(b,c.text,a,c.iconCls)},getTab:function(a){if(tabIdRegister[a]){return tabIdRegister[a]}else{return null}},registerTabId:function(a,b){tabIdRegister[a]=b;b.registeredTabId=a},unRegisterTabId:function(a){if(tabIdRegister[a.registeredTabId]){delete tabIdRegister[a.registeredTabId]}},addTab:function(a,d,e,b){var c=this.getTab(a);if(!c){var c=Ext.create("At4FrameworkIntranet.IFrame",{id:a+Ext.id(),src:e,title:d,closable:true,iconCls:b,width:350,height:350});c.application=this;c=this.tabPanel.add(c).show();this.registerTabId(a,c)}this.tabPanel.setActiveTab(c)},updateTab:function(b,e,a,c){var d=this.getTab(b);if(!d){d=this.addTab(b,e,a,c)}this.tabPanel.setActiveTab(d)},openLogin:function(c){var e=this;if(!this.sessionExpiredAlerted){var b=1;if(b==1){var f=Ext.getCmp("loginWindow");var a=this.contextPath+"/index.html?fastRelogUser="+window.username;if(!f){var d=Ext.create("At4FrameworkIntranet.IFrame",{id:Ext.id(),autoregister:false,listeners:{frameload:{fn:function(j){var h=j.target.contentWindow;var k=h.location.pathname;console.log(k);switch(k){case this.contextPath+"/login/loginError.html":case this.contextPath+"/login/loginForm.html":d.show();e.loginError();break;case this.contextPath+"/dwr/call/plaincall/GuiService.saveState.dwr":case this.contextPath+"/index.html":e.loginSuccess();break;default:h.location.replace(a);break}},scope:this,},frameunload:{fn:function(h){d.hide()},scope:this},domload:{fn:function(h){console.log(arguments)},scope:this,}},src:a,});f=Ext.create({xtype:"at4window",title:this.windowExpiredSesiontitle,id:"loginWindow",width:1024,height:768,closeAction:"destroy",layout:"fit",closable:false,draggable:false,resizable:false,modal:true,html:'<div style="display: table; height: 100%; width: 100%;"><div style="display: table-cell; vertical-align: middle;"><div class="loader">Loading...</div></div></div>',items:[d]})}else{var g=f.items.items[0];g.show();g.getWin().location.replace(a)}Ext.getBody().addCls("sesion-caducada");f.show()}if(b==2){console.log("Method unfinished");console.warn("Method unfinished");var f=Ext.getCmp("loginWindow");if(!f){this.loginPanel=Ext.create("Ext.form.Panel",{url:this.contextPath+"/login/loginForm.html",defaults:{labelAlign:"top"},defaultType:"textfield",items:[{inputType:"text",disabled:true,fieldLabel:"username",value:username},{inputType:"hidden",name:"username",hidden:true,value:username},{inputType:"password",fieldLabel:"password",name:"password",allowBlank:false}],reader:{type:"xml",record:"meta",rootProperty:"head"},errorReader:{type:"xml",record:"meta",rootProperty:"head"},listeners:{beforeaction:{fn:function(h,j){j.oldHandleResponse=j.handleResponse;j.handleResponse=function(k){k.responseXML=k.responseText;return j.oldHandleResponse(k)}}}},buttons:[{xtype:"button",text:"Submit",handler:function(){var h=this.loginPanel.getForm();if(h.isValid()){h.submit({success:function(j,k){e.handleLogin(j,k)},failure:function(j,k){e.handleLogin(j,k)}})}},scope:this}]});f=new Ext.Window({title:"Login",id:"loginWindow",closeAction:"destroy",layout:"fit",closable:false,draggable:false,resizable:false,modal:true,items:[this.loginPanel]})}f.show()}}},hideField:function(b){b.ownerCt.hide();b.hide();var a=b.getEl();if(a!=undefined){a.up(".x-form-item").setDisplayed(false)}},handleLogin:function(c,e){var h=new DOMParser();var g=h.parseFromString(e.response.responseXML,"text/html");var f=Ext.fly(g).select("meta").elements;var a="";for(i in f){var b=f[i];if(f.hasOwnProperty(i)){var d=b.getAttribute("data-url");if(d){a=d}}}switch(a){case"index":this.loginSuccess();break;case"loginForm":case"loginError":default:this.loginError()}},loginSuccess:function(){console.log("logueado guay");Ext.getCmp("loginWindow").hide();Ext.getBody().removeCls("sesion-caducada");this.reloadTabs()},loginError:function(){console.log("logueado error")},reloadTabs:function(b){Ext.Msg.hide();var a=false;for(var c in this.tabPanel.items.items){var d=this.tabPanel.items.items[c];if(d.xtype=="gridpanel"){if(b){d.reconfigure(null,d.gridMetaData.columns)}d.store.load()}else{if(d.xtype=="form"){a=true}}}if(a){Ext.Msg.alert(this.afterRelogFormTitle,this.afterRelogFormMsg)}},showField:function(b){b.ownerCt.show();b.show();var a=b.getEl();if(a!=undefined){a.up(".x-form-item").setDisplayed(true)}b.render()},cargaValidar:function(a){this.doOpenValidar(a,false)},openValidar:function(a){this.doOpenValidar(a,true)},doOpenValidar:function(a,b){if(!this.validarWindow){this.validarWindow=Ext.create("At4FrameworkIntranet.ValidarForm",{})}if(a){this.validarWindow.obtenerSiguiente=b;this.validarWindow.loadData(a);this.validarWindow.show()}else{Ext.Msg.alert("Finalizado","No quedan infracciones por validar")}},reloadListGrid:function(c){var b={form:c.formPanel.formName,iconCls:c.iconCls,text:c.title,};var a=c.customConfig;var d=c.gridMetaData;c.close();this.openListGrid(b,d,a)}});Ext.namespace("At4FrameworkIntranet");Ext.define("At4FrameworkIntranet.DwrStateProvider",{extend:"Ext.ux.state.HttpProvider",constructor:function(a){Ext.apply(this,a);this.callParent([{}])},submitState:function(){if(!this.dirty){this.dt.delay(this.delay);return}this.dt.cancel();var c=this.saveAction;var a=Ext.clone(this.queue);this.dirty=false;var b=[];b.push(a);b.push({callback:function(d){this.onSaveSuccess(d,a)}.bind(this),exceptionHandler:this.onSaveFailure.bind(this)});c.apply(this,b)},readState:function(){var b=this.loadAction;var a=[];a.push({callback:this.onReadSuccess.bind(this),exceptionHandler:this.onReadFailure.bind(this)});b.apply(this,a)},onSaveSuccess:function(b,a){if(true!==b.success){if(true===this.logFailure){this.log(this.saveFailureText,a,b)}this.dirty=true}else{Ext.each(a,function(g){if(!g){return}var f=g[this.paramNames.name];var h=this.decodeValue(g[this.paramNames.value]);if(undefined===h||null===h){Ext.ux.state.HttpProvider.superclass.clear.call(this,f)}else{Ext.ux.state.HttpProvider.superclass.set.call(this,f,h)}},this);if(false===this.dirty){this.queue=[]}else{var d,c,e;for(d=0;d<a.length;d++){e=false;for(c=0;c<this.queue.length;c++){if(a[d].name===this.queue[c].name){e=true;break}}if(true===e&&this.encodeValue(a[d].value)===this.encodeValue(this.queue[c].value)){Ext.Array.remove(this.queue,this.queue[c])}}}if(true===this.logSuccess){this.log(this.saveSuccessText,a,b)}this.fireEvent("savesuccess",this)}},onReadSuccess:function(a){var b;if(true!==a.success){if(true===this.logFailure){this.log(this.readFailureText,a,a)}}else{b=a.data;if(!(b instanceof Array)&&true===this.logFailure){this.log(this.dataErrorText,b,a);return}Ext.each(b,function(c){this.state[c[this.paramNames.name]]=this.decodeValue(c[this.paramNames.value])},this);this.queue=[];this.dirty=false;if(true===this.logSuccess){this.log(this.readSuccessText,b)}this.fireEvent("readsuccess",this)}}});Ext.define("At4FrameworkIntranet.MainTabPanel",{extend:"Ext.tab.Panel",stateful:true,applyState:function(a){if(this.isStateListenerApplyed){return}this.isStateListenerApplyed=true;this.addListener("afterrender",function(b,c){if(b.aplicadoEstado){return}b.aplicadoEstado=true;var d=c.state;for(i in d){var e=d[i];if(typeof e!="object"||!e.config){return}switch(e.type){case"formItem":if(!e.config.data.oid){break}window.setTimeout(function(){var g=this.obj;var f=this.scope;b.application.openRecordForm({form:g.config.formName,iconCls:g.config.iconCls},g.config.data,g.config.title,true)}.bind({scope:this,obj:e}),50);break;case"grid":window.setTimeout(function(){var g=this.obj;var f=this.scope;b.application.openMenuFormItem({form:g.config.formName,mode:"list",iconCls:g.config.iconCls})}.bind({scope:this,obj:e}),50);break}}},this,{state:a})},getState:function(){if(this.stateDestroy){return{}}var c=this.callParent();var a=this.items.items;var b=[];Ext.Array.each(a,function(g,f,h){var d;var e={};if(g.formName){d="formItem";e.formName=g.formName;e.data={};e.data.oid=g.dataId;e.title=g.title;e.iconCls=g.iconCls}else{d="grid";e.formName=g.stateId.split("-list")[0];e.iconCls=g.iconCls}e.dataId=g.dataId;b.push({config:e,type:d})});return b},stateEvents:["add","activate","show","collapse","expand","close","remove"]});Ext.namespace("At4FrameworkIntranet");Ext.define("At4FrameworkIntranet.ComboBox",{extend:"Ext.form.field.ComboBox",constructor:function(a){Ext.apply(this,a);if(this.autoCarga){this.store.load()}this.callParent(a);this.showAddRelatedButton();if(this.showReloadButton){this.getTrigger("reload").show()}},triggers:{openRelated:{cls:"trigger-relationlink",weight:-1,hidden:true,handler:function(a){a.openRelatedForm(a)}},addRelated:{cls:"trigger-relationAdd",weight:-1,hidden:true,handler:function(a){a.form.application.openNewRecordForm({form:a.relatedForm,iconCls:a.relatedIconCls})}},reload:{cls:"trigger-reload",weight:-1,hidden:true,handler:function(a){a.store.load(a.store.lastOptions)}}},openRelatedForm:function(b){var a=b.getRelatedId(b);if(b.relatedForm&&a){b.form.application.openRecordForm({form:b.relatedForm,iconCls:b.relatedIconCls},{oid:a})}},getRelatedId:function(a){return this.getValue()},clearValue:function(){if(this.disableAfterclear){this.disable()}this.callParent(arguments)},showRelatedButton:function(){if(this.showRelated!=false){this.getTrigger("openRelated").show()}},showAddRelatedButton:function(){if(this.showAddRelated!=false){this.getTrigger("addRelated").show()}},hideRelatedButtons:function(){this.getTrigger("addRelated").hide();this.getTrigger("openRelated").hide()},listeners:{change:function(b){var a=b.getSelectedRecord();this.hideRelatedButtons();if(a){if(b.relatedForm){b.showRelatedButton()}}else{if(b.relatedForm){b.showAddRelatedButton()}}}},xtype:"At4Framework-combobox",loadingText:"cargando...",minChars:2,liveFiltersFn:Ext.emptyFn,autoCarga:false,showAddRelated:false,valueField:"ID",displayField:"DISPLAY",autoLoadOnValue:false,setComboValue:function(e,a){var d="",b="";if(typeof a[e]=="object"&&a[e].asString!=null){d=a[e].asString}else{d=a[e]}var c=/Id$/;if(c.test(e)){b=a[e.replace(c,"Label")]}else{b=a[e]}if(!!d&&!!b){if(!this.store.isLoaded()){this.store.add({ID:d,DISPLAY:b});this.store.loadCount++}this.selectValue(d)}},selectValue:function(b){var a=this.store.findRecord("ID",b);if(a){this.select(a)}else{this.setRawValue(b)}},setValue:function(a){if(this.store.isLoaded()){this.callParent(arguments)}else{this.setRawValue(a)}if(a&&this.disableAfterclear){this.enable()}}});Ext.define("At4FrameworkIntranet.RelatedBox",{extend:"Ext.form.field.Text",xtype:"At4Framework-relatedbox",editable:false,triggers:{openRelated:{cls:"trigger-relationlink",weight:-1,handler:function(a){a.openRelatedForm(a)}}},openRelatedForm:function(b){var a=this.relatedId;if(b.relatedForm&&a){b.form.application.openRecordForm({form:b.relatedForm,iconCls:b.relatedIconCls},{oid:a})}},setComboValue:function(e,a){var d="",b="";if(typeof a[e]=="object"&&a[e].asString!=null){d=a[e].asString}else{d=a[e]}var c=/Id$/;if(c.test(e)){b=a[e.replace(c,"Label")]}else{b=a[e]}if(!!d&&!!b){this.setValue(b);this.relatedId=d}},});Ext.define("At4FrameworkIntranet.HiddenComboBox",{extend:"Ext.form.field.Hidden",xtype:"At4Framework-hiddencombobox",setValue:function(a){if((typeof a)=="object"){a=a.asString}this.callParent([a])}});Ext.define("At4FrameworkIntranet.ItemSelector",{extend:"Ext.ux.ItemSelector",listeners:{render:function(a){if(this.autoLoadOnRender){this.store.load()}},resize:function(e,d,a,b,f,c){}},showOnlySelected:false,constructor:function(a){this.store=a.fromStore;this.store.addListener({load:{scope:this,fn:function(){this.doLayout()}}});this.callParent([a]);this.on("render",function(){if(!this.layoutRerendered){this.layoutRerendered=true;window.setTimeout(function(){this.doLayout()}.bind(this),250)}},this)},initComponent:function(){var a=this;a.callParent();a.ddGroup=null},setupItems:function(){var a=this.callParent(arguments);if(this.showOnlySelected){return a[2]}return a},moveRec:function(f,e){if(this.showOnlySelected){return}var c=this,g=c.fromField,a=c.toField,b=f?g.store:a.store,d=f?a.store:g.store;b.suspendEvents();d.suspendEvents();b.remove(e);d.add(e);d.sort("ORDER","asc");b.resumeEvents();d.resumeEvents();g.boundList.refresh();a.boundList.refresh();c.syncValue()},xtype:"At4Framework-itemselector",msWidth:305,msHeight:200,width:630,buttons:["add","remove"],valueField:"ID",displayField:"DISPLAY",reloadOnSetValues:false,autoLoadOnRender:true,toTitle:"Seleccionados",fromTitle:"Disponibles",getRecordsForValue:function(h){var g=this,b=[],k=g.store.getRange(),m=g.valueField,e=0,l=k.length,c,d,f;for(f=h.length;e<f;++e){for(d=0;d<l;++d){c=k[d];var a=c.get(m);if(h[e]&&(a==h[e]||a==h[e].asString)){b.push(c)}}}return b},});Ext.define("At4FrameworkIntranet.ImporteField",{extend:"Ext.form.field.Number",constructor:function(a){Ext.apply(this,a);this.callParent([{}])},xtype:"At4Framework-importe",decimalSeparator:".",allowDecimals:true,decimalPrecision:2});Ext.define("At4FrameworkIntranet.CifNifField",{extend:"Ext.form.field.Text",constructor:function(a){Ext.apply(this,a);this.callParent([{}])},xtype:"At4Framework-cifnif",regex:/^[A-Za-z]{1}[0-9]{7,9}$|^[X-Zx-z]{1}[0-9]{7,9}[A-Za-z]{1}$|^[0-9]{7,9}[A-Za-z]$|^[A-Za-z]{1}[0-9]{7}[A-Za-z]{1}$/,regexText:this.cifIncorrectoTexto,width:At4FrameworkIntranet.FormDefaults.HALF_TEXT_FIELD_WIDTH,maxLength:9});Ext.define("At4FrameworkIntranet.PasswordField",{extend:"Ext.form.field.Text",constructor:function(a){Ext.apply(this,a);this.callParent(this,{listeners:{valid:{fn:this.onValid,scope:this}}})},xtype:"At4Framework-password",width:195,allowBlank:true,inputType:"password",minLength:8,rePassField:null,onValid:function(){if(this.rePassField){this.rePassField.validate()}}});Ext.define("At4FrameworkIntranet.RepeatPasswordField",{extend:"At4FrameworkIntranet.PasswordField",constructor:function(a){Ext.apply(this,a);if(this.initialPassField){this.initialPassField.rePassField=this}this.callParent(this,{})},xtype:"At4Framework-repeatpassword",passwordText:"Las contraseñas no coinciden",width:195,allowBlank:true,inputType:"password",initialPassField:null,validator:function(a){if(this.initialPassField){if(a!=this.initialPassField.getValue()){return this.passwordText}}return true}});Ext.define("At4FrameworkIntranet.Window",{extend:"Ext.window.Window",xtype:"at4window",constructor:function(a){Ext.apply(this,a);a={};this.originalHeight=this.height;this.originalWidth=this.width;this.callParent(arguments);this.on("show",At4FrameworkIntranet.resizeFormWindow);this.on("resize",At4FrameworkIntranet.resizeFormWindow)}});At4FrameworkIntranet.resizeFormWindow=function(g,e,a,c,h){if(!g||!g||g.hidden||g.disabled){return}var d=Ext.getBody().getViewSize();var f=Math.min(d.width,e);var b=Math.min(d.height,a);if(!(isNaN(f)||isNaN(b))){g.setSize(f,b)}g.center()};Ext.define("Ext.ux.at4.SpaceField",{extend:"Ext.container.Container",xtype:"spaceField",height:22,width:320});Ext.define("At4FrameworkIntranet.FotoField",{extend:"Ext.Img",src:"img/no_img.jpg",loadingSrc:"img/no_img.jpg",mixins:["Ext.form.Labelable","Ext.form.field.Field"],xtype:"imageField",setValue:function(a){this.getEl().dom.src=this.loadingSrc;if(!a){return}var b="./export/descarregar?objectId="+a+"&docname=foto-foto&mode=inline";if(this.disableCache){b+="&v="+new Date().getTime()}this.getEl().dom.src=b}});Ext.define("Ext.ux.at4.OneToOneField",{extend:"Ext.form.FieldContainer",xtype:"otofield",minHeight:50,constructor:function(){this.button=Ext.create({xtype:"button",disaabled:true,text:"Abrir",handler:function(){this.application.openRecordForm({iconCls:this.relatedIconCls,form:this.relatedForm},{oid:this.recordId})},scope:this,});this.items=[this.button];this.callParent(arguments)},setValue:function(a){if(a){this.recordId=a;this.button.enable()}else{this.button.disable()}}});Ext.define("Ext.ux.at4.ynncField",{extend:"Ext.form.ComboBox",xtype:"ynncField",queryMode:"local",valueField:"ID",displayField:"DISPLAY",editable:false,constructor:function(){var a=Ext.create("Ext.data.Store",{fields:["DISPLAY","ID"],data:[{DISPLAY:"No",ID:"0"},{DISPLAY:"Si",ID:"1"},{DISPLAY:"NS",ID:"2"},]});this.store=a;this.callParent(arguments)},setValue:function(a){a=a+"";return this.callParent([a])}});Ext.define("Ext.ux.CurrencyField",{extend:"Ext.form.field.Number",alias:["widget.currencyfield"],privateFocus:false,currency:"€",listeners:{render:function(a){a.showCurrency(a)},blur:function(a){a.privateFocus=false;a.showCurrency(a)},focus:function(a){a.privateFocus=true;a.setRawValue(a.valueToRaw(a.getValue()))},change:function(a,b){if(!a.privateFocus){a.showCurrency(a)}}},showCurrency:function(a){a.setRawValue(Ext.util.Format.currency(a.valueToRaw(a.getValue()),a.currency,2,true))},valueToRaw:function(a){if(!a){return a}return a.toString().replace(/[^0-9.]/g,"")},rawToValue:function(a){return Ext.util.Format.round(this.valueToRaw(a),2)},getSubmitValue:function(){var a=this.callParent(arguments);return this.valueToRaw(a)},getErrors:function(a){a=this.rawToValue(a);return this.callParent([a])}});Ext.define("At4FrameworkIntranet.RadioGroup",{extend:"Ext.form.RadioGroup",xtype:"at4-radiogroup",height:50,setValue:function(a){var b={};b[this.name]=a;this.callParent([b])},constructor:function(a){var b={store:a.store,displayField:a.displayField,valueField:a.valueField};delete a.displayField;delete a.valueField;delete a.store;this.gridEditor=Ext.create("Ext.form.field.ComboBox",b);a.items=[];b.store.each(function(c){this.items.push({inputValue:c.data.ID,name:a.name,boxLabel:c.data.DISPLAY})},a);if(At4Framework_modoDesarrollo){console.warn("Revisar que ",this," tenga el grid con el store filter")}return this.callParent([a])}});Ext.define("At4FrameworkIntranet.MultilangText",{extend:"Ext.form.field.Text",xtype:"At4FrameworkIntranet-multilangtext",mixins:{multilang:"At4FrameworkIntranet.mixin.MenuMultilang"},enableKeyEvents:true,constructor:function(a){this.callParent(arguments);this.mixins.multilang.constructor.call(this,a)},triggers:{selIdioma:{cls:"multilang-icon-Es",handler:function(){this.mixins.multilang.seleccionarIdioma.call(this,this.currentLang+1)}},dropIdioma:{cls:"multilang-all",handler:function(){this.mixins.multilang.desplegarIdiomas.call(this)}}},initComponent:function(){this.callParent();this.mixins.multilang.initComponent.call(this)},getErrors:function(){if(this.mixins.multilang.checkError.call(this)){return this.callParent(arguments)}return[]}});Ext.define("At4FrameworkIntranet.Textarea",{extend:"Ext.form.field.TextArea",growMin:80,growMax:350,grow:true});Ext.define("At4FrameworkIntranet.MultilangTextarea",{extend:"Ext.form.field.TextArea",xtype:"At4FrameworkIntranet-multilangtextarea",mixins:{multilang:"At4FrameworkIntranet.mixin.DroppedMultilang"},width:At4FrameworkIntranet.FormDefaults.TEXT_FIELD_WIDTH,growMin:80,growMax:350,grow:true,triggers:{selIdioma:{cls:"multilang-icon-Es",extraCls:"multilang-icon",handler:function(){this.seleccionarIdioma.call(this,this.currentLang+1)}}},constructor:function(a){this.callParent(arguments);this.mixins.multilang.constructor.call(this,a)},initComponent:function(){this.mixins.multilang.initComponent.call(this,"TextArea");this.callParent()},getErrors:function(){if(this.mixins.multilang.checkError.call(this)){return this.callParent(arguments)}return[]}});if(typeof CKEDITOR!=="undefined"){Ext.define("At4FrameworkIntranet.HtmlArea",{extend:"Ext.ux.CKEditor",xtype:"At4FrameworkIntranet-htmlarea",labelStyle:"height: 25px;",listeners:{resize:function(b,a){b.ownerCt.doLayout()},instanceReady:function(b,a){b.ownerCt.doLayout()}}});Ext.define("At4FrameworkIntranet.MultilangHtmlArea",{extend:"At4FrameworkIntranet.HtmlArea",xtype:"At4Framework-multilanghtmlarea",mixins:{multilang:"At4FrameworkIntranet.mixin.simpleMultilang"},width:At4FrameworkIntranet.FormDefaults.TEXT_FIELD_WIDTH,grow:false,labelAlign:"top",constructor:function(a){this.callParent(arguments);this.mixins.multilang.constructor.call(this,a);window.temp1=this},initComponent:function(){this.mixins.multilang.initComponent.call(this,"TextArea");this.callParent()},getErrors:function(){if(this.mixins.multilang.checkError.call(this)){return this.callParent(arguments)}return[]},listeners:{render:function(){this.mixins.multilang.listeners.render.call(this)},change:function(){this.mixins.multilang.listeners.change.call(this)}},seleccionarIdioma:function(a){var c=this.currentLang;this.currentLang++;if(this.currentLang>=this.langs.length){this.currentLang=0}var b=this.currentLang;this.inputs[this.langs[c]].setValue(this.getValue());this.setValue(this.inputs[this.langs[b]].getValue());var d="multilang-icon-"+this.langs[b];this.triggerEl.removeCls("multilang-icon-"+this.langs[c]).addCls(d);return d},CKConfig:{extraPlugins:"justify,multilang",extraPluginFn:function(){this.seleccionarIdioma.call(this,this.currentLang+1)},toolbarGroups:[{name:"document",groups:["mode","document","doctools"]},{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","multilanggroup"]},{name:"forms"},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]},{name:"links"},{name:"styles",groups:["styles"]},{name:"styles"},{name:"colors"},{name:"tools"},{name:"others"},{name:"about"}],entities:false,basicEntities:false,skin:"icy_orange",preset:"full",languages:{ca:1,en:1,es:1}}})}Ext.namespace("At4FrameworkIntranet");Ext.define("At4FrameworkIntranet.fileuploadfield",{extend:"Ext.form.TextField",windowHeight:150,constructor:function(a){this.addEvents("fileselected");this.callParent([a])},readOnly:true,style:"width: 200px",autoSize:Ext.emptyFn,browseTxt:this.browseTxt,onRender:function(c,a){this.callParent(arguments);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.createFileInput();var b=Ext.applyIf(this.buttonCfg||{},{text:this.browseTxt});this.button=new Ext.Button(Ext.apply(b,{renderTo:this.wrap,cls:"x-form-file-btn"+(b.iconCls?" x-btn-icon":"")}));this.addFileListener()},getFileInputId:function(){return this.id+"-file"},onResize:function(a,b){this.callParent(arguments);this.wrap.setWidth(a)},preFocus:Ext.emptyFn,getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])},reset:function(){var a=this.getFileInput();if(a!=null){Ext.get(a.id).findParentNode("form").reset();var b=100;var c=this;setTimeout(function(){c.removeFileInput()},b);setTimeout(function(){c.createFileInput()},b);setTimeout(function(){c.addFileListener()},b)}},createFileInput:function(){this.fileInput=this.wrap.createChild({name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1})},removeFileInput:function(){this.fileInput.remove()},addFileListener:function(){this.fileInput.on("change",function(){var a=this.fileInput.dom.value;this.setValue(a);this.fireEvent("fileselected",this,a)},this)},getFileInput:function(){return this.fileInput}});Ext.enableDWRUploadFile=function(c){var a={};a.submit=c.submit;a.check=c.check;var b=c.buttonIcon;if(typeof(b)=="undefined"){b=this.buttonIcon}var d=c.buttonText;if(typeof(d)=="undefined"||d==""){d=this.buttonText}a.file=Ext.create("Ext.form.field.File",{fieldLabel:this.fieldLabel,labelAlign:"top",labelWidth:75,width:300,});a.fieldset=new Ext.form.FieldSet({defaults:{msgTarget:"under",validationEvent:true},border:false,labelAlign:"top",autoHeight:true,autoWidth:true,collapsible:false,items:[a.file]});a.nav=new Ext.FormPanel({labelWidth:100,padding:"10 5 10 5",width:200,border:false,fileUpload:true,collapsible:false,defaultType:"textfield",items:[a.fieldset]});a.dlgPopup=new Ext.Window({modal:true,layout:"fit",width:400,height:this.windowHeight,closable:false,resizable:false,plain:true,title:this.windowTitle,items:[a.nav],buttons:[{text:this.uploadButtonText,iconCls:this.uploadButtonIcon,handler:function(){a.submit();a.dlgPopup.hide()}},{text:this.closeButtonText,iconCls:this.closeButtonIcon,handler:function(){a.dlgPopup.hide()}}]});this.uploadButton=new Ext.Button({text:d,disabled:false,tabIndex:c.tabIndex,iconCls:b,disabled:this.disabled,scope:this,handler:function(){if(a.check()){var e=a.file;e.reset();a.dlgPopup.show()}}});this.getFileInput=function(){return a.file.button.fileInputEl.dom}};Ext.namespace("At4FrameworkIntranet");Ext.define("At4FrameworkIntranet.BaseForm",{extend:"Ext.form.Panel",constructor:function(b){Ext.apply(this,b);if(At4Framework_modoDesarrollo){if(this.maxTabIndex==1.25){Ext.log.warn(this.id,"No tiene definido un tab index maximo")}}for(var a in this.fields){var c=this.fields[a];c.form=this}this.statusBar=Ext.getCmp("At4Framework-status");this.callParent([{}])},actualizarTxt:"Actualizar",destroy:function(){this.application.unRegisterTabId(this);this.callParent(arguments)},eliminarTxt:"Eliminar",cerrarTxt:"Cerrar",ejecutandoTxt:"Ejecutando...",espereTxt:"espere...",borrarRegistroTxt:"¿Borrar registro?",nuevoRegistroTxt:"Añadir registro",camposObligatoriosVaciosTxt:"¡Hay campos obligatorios sin rellenar!",seguroTxt:"¿está seguro?<br/>Esta acción no se puede deshacer.",anyadidoTxt:"Añadido 1 elemento",actualizadoTxt:"Actualizado 1 elemento",eliminadoTxt:"Eliminado 1 elemento",multiForms:[],loadedValues:{},statusBar:null,maxTabIndex:1.25,setValues:function(a){Ext.apply(this.loadedValues,a);var e,g;for(g in a){if(typeof a[g]!="function"){e=this.form.findField(g);if(!e){e=this.fields[g];if(this.multiForms[g]){e=null}}if(e){if(e.xtype=="At4Framework-itemselector"){if(a[g]==null){e.reset()}else{var c=[];for(var b=0;b<a[g].length;b++){c.push(a[g][b][e.recordPK])}e.setValue(c)}}else{if(e.xtype=="At4Framework-combobox"||e.xtype=="At4Framework-relatedbox"){if(a[g]==null||a[g]==0){e.reset()}else{e.setComboValue(g,a)}}else{if(e.xtype=="At4Framework-password"){e.setValue("");if(e.rePassField){e.rePassField.setValue("")}}else{if(e.xtype=="colorfield"){var d=a[g];if(d){e.setValue(d)}}else{e.setValue(a[g])}}}}if(this.form.trackResetOnLoad){e.originalValue=e.getValue()}}else{if(this.multiForms&&(e=this.multiForms[g])){e.setValues(a[g])}else{if(g=="id"&&typeof a[g]=="object"){for(var f in a[g]){if(a[g].hasOwnProperty(f)){if(e=this.form.findField("id."+f)){e.setValue(a[g][f]);if(this.form.trackResetOnLoad){e.originalValue=e.getValue()}}}}}}}}}}});Ext.namespace("At4FrameworkIntranet");Ext.define("At4FrameworkIntranet.BasicForm",{extend:"At4FrameworkIntranet.BaseForm",multilangRE:/^.+(Es|Ca|Ct|En|De)$/,loadDataFailFn:function(){console.log("hubo error oculto");console.log(arguments);this.close()},constructor:function(c,d,f,a,b){this.application=c;this.formName=d;this.gridMetaData=f;Ext.apply(this,b);var e=this.gridMetaData.showNewButton;var g=Ext.apply(this.fieldDefaults,{labelAlign:"top"});this.callParent([{defaultType:"textfield",labelWidth:90,defaults:this.fieldDefaults,deferredRender:false,bodyStyle:"border-bottom: 1px solid #D6D3D6",autoHeight:false,autoScroll:true,border:false,items:a,monitorValid:e,buttonAlign:"left",dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",tabIndex:this.maxTabIndex+1,activeChildTabIndex:this.maxTabIndex+2,items:[{text:this.actualizarTxt,id:this.getId()+"actualizarButton",iconCls:At4util.icons.update,name:"_dwrstore",scope:this,disabled:!e,cls:"at4-update",hidden:false,style:"margin: 0px 5px 0px 10px;",handler:this.submitActualizar},{text:this.eliminarTxt,id:this.getId()+"eliminarButton",iconCls:At4util.icons.remove,name:"_dwrstore",scope:this,cls:"at4-delete",formBind:false,disabled:true,hidden:false,style:"margin: 0px 5px 0px 10px;",handler:function(){Ext.Msg.show({title:this.borrarRegistroTxt,msg:this.seguroTxt,icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,scope:this,fn:function(h){if("yes"!==h){return}Ext.MessageBox.wait(this.ejecutandoTxt,this.espereTxt);FormDataService.deleteForm(this.formName,this.dataId,this.afterDeleteForm.bind(this))}})}},At4FrameworkIntranet.FormDefaults.debugButton(this)]}]}]);this.fireEvent("formprepared",this)},getFormName:function(){return this.formName},getFieldEditor:function(g,c){if(this.fields){var f=this.fields[g];var e=false;if(f){if(f.xtype=="at4-radiogroup"){f=f.gridEditor}else{if(f.xtype=="At4Framework-combobox"){f.showAddRelated=false;f.showRelated=false;f.hideRelatedButtons()}}e=!f.disableUpdates}else{var b=this.multilangRE;if(b.test(g)){var d=g.substring(g.length-2);g=g.substring(0,g.length-2);var a=this.fields[g];e=!a.disableUpdates;if(a){f=a.inputs[d]}}}if(e){if(f.hidden){f.show()}f.setMargin(0);return f}else{return null}}else{Ext.Msg.alert("Alert","No se puede acceder a los campos de edicion")}},loadData:function(a){this.dataId=a;this.loadedValues={};var b=Ext.create("Ext.form.Action.DWRLoad",this,{dwrFunction:FormDataService.loadFormData,dwrArgs:[this.formName,a],waitMsg:this.ejecutandoTxt,waitTitle:this.espereTxt,setValuesFunction:Ext.bind(this.setValues,this),scope:this,failure:this.isStateLoaded?this.loadDataFailFn:serverDatabaseActions.genericFormFailureHandler,success:function(e,f){for(var d in this.multiForms){if(typeof this.multiForms[d]!="function"){this.multiForms[d].enable();if(this.multiForms[d].deferredLoad){this.multiForms[d].unload();if(this.multiForms[d].isActiveTab){this.multiForms[d].fireEvent("activate",this.multiForms[d])}}}}var c=this.getDockedItems()[0].items.getAt(0);var h=this.getDockedItems()[0].items.getAt(1);this.isStateLoaded=false;if(f.result.canUpdate){c.setVisible(true);c.enable();for(var d in this.multiForms){if(typeof this.multiForms[d]!="function"&&this.multiForms[d].xtype=="panel"){this.multiForms[d].setEditable(true)}}}else{c.setVisible(false);c.disable();for(var d in this.multiForms){if(typeof this.multiForms[d]!="function"){this.multiForms[d].setEditable(false)}}}if(f.result.canDelete){h.setVisible(true);h.enable()}else{h.setVisible(false)}if(this.fields){for(var g in this.fields){if(this.fields[g].disableUpdates){this.fields[g].disable()}}}return this.fireEvent("afterload",a,f.result)}});this.getForm().doAction(b)},afterInsertForm:function(c,d){var b=d.result.addedElementKeys[0];this.loadData(b);if(this.nestedParent){var a=this.nestedParent.onNewRecordDone(this,d.result.updatedElement)}else{this.application.onNewRecordDone(this,{rowid:b,formName:this.formName})}this.isNewForm=false;Ext.each(this.allowAfterNew,function(e){e.allowBlank=true});this.statusBar.setStatus({text:this.anyadidoTxt,clear:true})},afterUpdateForm:function(b,c){this.loadData(this.dataId);if(this.nestedParent){var a=this.nestedParent.onUpdateRecordDone(this,c.result.updatedElement,this.currentRecord)}else{this.application.onUpdateRecordDone({rowid:this.dataId,formName:this.formName,nestedParent:this.nestedParent})}this.statusBar.setStatus({text:this.actualizadoTxt,clear:true})},afterDeleteForm:function(a){Ext.MessageBox.updateProgress(1);Ext.MessageBox.hide();if(a.success){this.application.onDeleteRecordDone(this,{rowid:this.dataId,formName:this.formName});this.statusBar.setStatus({text:this.eliminadoTxt,clear:true})}else{Ext.Msg.alert("Error:",a.message)}},afterInsertFailureForm:function(a,b){if(b.result!=null&&b.result.correcto){Ext.Msg.alert('<spring:message code="forms.general.success" javaScriptEscape="true"/>',b.result.message)}else{if(b.result!=null){Ext.Msg.alert('<spring:message code="forms.general.error" javaScriptEscape="true"/>',b.result.message)}}},loadSubpanelData:function(a,c){var b=Ext.create("Ext.form.Action.DWRLoad",this,{dwrFunction:FormDataService.loadSubPanelFormData,dwrArgs:[this.formName,a,c],waitMsg:this.ejecutandoTxt,waitTitle:this.espereTxt,setValuesFunction:Ext.bind(this.setValues,this),scope:this,failure:serverDatabaseActions.genericFormFailureHandler,success:function(d,e){return true},});this.getForm().doAction(b)},qtipEnabler:function(a){Ext.tip.QuickTipManager.register({target:a.getId(),text:a.qtip,trackMouse:false})},submitActualizar:function(){if(!this.getForm().isValid()){Ext.Msg.show({title:this.actualizarRegistroTxt,msg:this.camposObligatoriosTxt,icon:Ext.Msg.WARNING,buttons:Ext.Msg.OK,scope:this})}else{var a=null;if(this.dataId){a=Ext.create("Ext.form.Action.DWRSubmit",this,{dwrArgs:[this.formName,this.dataId],dwrFunction:FormDataService.updateForm,waitMsg:this.ejecutandoTxt,waitTitle:this.espereTxt,success:this.afterUpdateForm,failure:serverDatabaseActions.genericFormFailureHandler,scope:this})}else{a=Ext.create("Ext.form.Action.DWRSubmit",this,{dwrArgs:[this.formName],dwrFunction:FormDataService.addForm,waitMsg:this.ejecutandoTxt,waitTitle:this.espereTxt,success:this.afterInsertForm,failure:this.afterInsertFailureForm,scope:this})}this.getForm().doAction(a)}}});Ext.namespace("At4FrameworkIntranet");Ext.define("At4FrameworkIntranet.BasicSubForm",{extend:"At4FrameworkIntranet.BaseForm",constructor:function(d,a,c){this.application=d;Ext.apply(this,c);var b=this.getId()+"-ActualizarSubFormButton";if(!this.viewOnly){this.actualizarButton=Ext.create("Ext.button.Button",{text:this.actualizarTxt,id:b,iconCls:At4util.icons.update,name:"_dwrstore",scope:this,cls:"at4-update",disabled:false,hidden:false,style:"margin: 0px 5px 0px 5px;",handler:this.updateForm})}this.callParent([{trackResetOnLoad:false,defaultType:"textfield",labelWidth:90,deferredRender:false,autoHeight:false,closable:false,overflowY:"auto",overflowX:"hidden",header:false,border:false,labelAlign:"top",items:a,monitorValid:true,buttonAlign:"right",buttons:[this.actualizarButton,{text:this.cerrarTxt,id:this.getId()+"CerrarButton",iconCls:At4util.icons.close,scope:this,formBind:false,disabled:false,cls:"at4-delete",hidden:false,style:"margin: 0px 5px 0px 5px",handler:function(){this.parentPanel.closeForm()}},At4FrameworkIntranet.FormDefaults.debugButton(this)]}])},currentRecord:null,bodyStyle:"border-bottom: 1px solid #D6D3D6",parentPanel:null,editable:true,actionBusy:false,actionPile:[],subFormName:null,loadData:function(a){this.emptyForm();this.currentRecord=a;this.dataId=a.data.oid;this.setValues(a.data);for(var b in this.multiForms){if(typeof this.multiForms[b]!="function"){this.multiForms[b].enable();this.multiForms[b].setEditable(this.editable)}}if(this.fields){for(var c in this.fields){if(this.fields[c].disableUpdates){this.fields[c].disable()}}}return this.fireEvent("afterload",{},a)},setEditable:function(a){this.editable=a;if(this.actualizarButton){this.actualizarButton.setVisible(a)}for(var b in this.multiForms){if(typeof this.multiForms[b]!="function"){this.multiForms[b].setEditable(a)}}},updateForm:function(b){var a={};if(this.dataId){if(this.application.formName!=null){a=Ext.create("Ext.form.Action.DWRSubmit",this,{dwrArgs:[this.application.formName,this.application.dataId,this.subFormName,this.dataId],dwrFunction:FormDataService.updateSubForm,waitMsg:this.ejecutandoTxt,waitTitle:this.espereTxt,success:this.afterUpdateForm,failure:this.afterUpdateError,clientValidation:b,scope:this})}else{a=Ext.create("Ext.form.Action.DWRSubmit",this,{dwrArgs:[this.application.subFormName,this.application.dataId,this.subFormName,this.dataId],dwrFunction:FormDataService.updateSubForm,waitMsg:this.ejecutandoTxt,waitTitle:this.espereTxt,clientValidation:b,success:this.afterUpdateForm,failure:this.afterUpdateError,scope:this})}}else{if(this.application.formName!=null){a=Ext.create("Ext.form.Action.DWRSubmit",this,{dwrArgs:[this.application.formName,this.application.dataId,this.subFormName],dwrFunction:FormDataService.addSubForm,waitMsg:this.ejecutandoTxt,waitTitle:this.espereTxt,clientValidation:b,success:this.afterInsertForm,failure:this.afterInsertFailureForm,scope:this})}else{a=Ext.create("Ext.form.Action.DWRSubmit",this,{dwrArgs:[this.application.subFormName,this.application.dataId,this.subFormName],dwrFunction:FormDataService.addSubForm,waitMsg:this.ejecutandoTxt,clientValidation:b,waitTitle:this.espereTxt,success:this.afterInsertForm,failure:this.afterInsertFailureForm,scope:this})}}this.getForm().doAction(a)},emptyForm:function(){this.currentRecord=null;this.dataId=null;this.loadedValues={};for(var a in this.multiForms){if(typeof this.multiForms[a]!="function"){this.multiForms[a].disable();this.multiForms[a].setEditable(false);this.multiForms[a].setValues([])}}if(this.fields){for(var b in this.fields){if(this.fields[b].disableUpdates){this.fields[b].disable()}}}if(this.fields){for(var b in this.fields){if(this.fields[b].disableUpdates){this.fields[b].enable()}if(this.fields[b].xtype=="At4Framework-combobox"){var b=this.fields[b];if(!b.noReload){b.clearValue()}}}}this.form.reset();return this.fireEvent("afteremptyform")},setParentPanel:function(a){this.parentPanel=a},afterInsertForm:function(c,d){var b=d.result.addedElementKeys[0];var a=this.parentPanel.onNewRecordDone(this,d.result.updatedElement);this.statusBar.setStatus({text:this.anyadidoTxt,clear:true});this.loadData(a)},afterInsertFailureForm:function(a,b){if(b.result!=null&&b.result.correcto){Ext.Msg.alert('<spring:message code="forms.general.success" javaScriptEscape="true"/>',b.result.message)}else{if(b.result!=null){Ext.Msg.alert('<spring:message code="forms.general.error" javaScriptEscape="true"/>',b.result.message)}}},afterUpdateForm:function(b,c){this.actionBusy=false;if(this.actionPile.length>0){this.submitRawRecord(this.actionPile.splice(0,1)[0])}else{var a=this.parentPanel.onUpdateRecordDone(this,c.result.updatedElement,this.currentRecord);this.statusBar.setStatus({text:this.actualizadoTxt,clear:true});this.loadData(a)}},afterUpdateError:function(a,b){if(b&&b.result&&b.result.correcto){Ext.Msg.alert('<spring:message code="forms.general.success" javaScriptEscape="true"/>',b.result.message)}else{Ext.Msg.alert('<spring:message code="forms.general.error" javaScriptEscape="true"/>',b.result.message)}},submitRawRecord:function(a){if(!this.actionBusy){this.actionBusy=true;this.loadData(a);this.updateForm(false)}else{this.actionPile.push(a)}}});Ext.namespace("At4FrameworkIntranet");Ext.define("At4FrameworkIntranet.FieldMainPanel",{extend:"Ext.container.Container",xtype:"At4Framework-fieldmainpanel",defaults:At4FrameworkIntranet.FormDefaults.FIELD_DEFAULTS,collapsible:false,layout:"anchor",labelAlign:"top",border:false,});Ext.define("At4FrameworkIntranet.FormTabPanel",{extend:"Ext.TabPanel",xtype:"At4Framework-formtabpanel",plain:true,border:true,layout:"fit",bodyBorder:true,bodyStyle:"border-top: 0",activeTab:0,width:"100%",minWidth:840,enableTabScroll:true,deferredRender:false,defaults:{layout:"anchor",labelWidth:80,width:"100%",defaultType:"textfield",bodyStyle:"padding:15px 0px 15px 15px",hideMode:"offsets"}});Ext.define("At4FrameworkIntranet.subFormContainer",{extend:"Ext.container.Container",xtype:"At4Framework-subFormContainer",margin:"12px 0px 0px 0px",width:"100%",minWidth:840,layout:"fit",});Ext.define("At4FrameworkIntranet.responsiveContainer",{extend:"Ext.container.Container",xtype:"At4Framework-responsiveContainer",defaults:Ext.apply(At4FrameworkIntranet.FormDefaults.COLUMN_DEFAULTS,{margin:"0px 10px 10px 10px",cls:"at4-field"}),margin:15,layout:"column",});Ext.define("At4FrameworkIntranet.rowContainer",{extend:"Ext.container.Container",defaults:Ext.apply(At4FrameworkIntranet.FormDefaults.COLUMN_DEFAULTS,{cls:"at4-field"}),xtype:"At4Framework-rowContainer",width:"100%",cls:"at4-rowContainer",minWidth:840,layout:{type:"hbox",pack:"start"}});Ext.define("At4FrameworkIntranet.mixin.DateRangeValidator",{timerange:function(e,d){var b=d.name;var a=this.getForm().getFields().items;for(var c=0;c<a.length;c++){var f=a[c];if(f.startTimeField==b){f.setMinValue(e)}if(f.endTimeField==b){f.setMaxValue(e)}}return true}});Ext.define("At4FrameworkIntranet.IFrame",{extend:"Ext.ux.IFrame",autoregister:true,constructor:function(){var a=this;a.callParent(arguments);a.addListener("afterrender",function(){var b=a.el.select("iframe").elements[0];if(!b){return}b.onload=function(){a.fireEventArgs("frameload",arguments);b.contentWindow.onunload=function(){a.fireEventArgs("frameunload",arguments)}}})},beforeDestroy:function(){if(this.autoregister){this.application.unRegisterTabId(this)}this.callParent()}});Ext.define("At4FrameworkIntranet.ExportBasePrompt",{extend:"At4FrameworkIntranet.Window",xtype:"at4gridSavePrompt",width:300,modal:true,plain:true,title:"Guardar configuracion",layout:"fit",height:220,closable:false,closeAction:"hide",inputLabelTxt:"Nombre",sobrescribirLabelTxt:"Nombre duplicado, sobrescribir?",configuracionPrivadaLabelTxt:"Configuracion privada",guardarLabel:"Guardar",cancelarLabel:"Cancelar",stateSaveSuccessTxt:"Exito en guardar el estado",stateSaveErrorTxt:"Error al guardar el estado, por favor, vuelva a intentarlo mas tarde.",expcfgSaveSuccessTxt:"Exito en guardar la configuracion",expcfgSaveErrorTxt:"Error al guardar la configuracion, por favor, vuelva a intentarlo mas tarde.",constructor:function(a){Ext.apply(this,a);this.loadTrigger=Ext.create("Ext.form.trigger.Trigger",{hidden:true,cls:"loadingTrigger"});this.input=Ext.create({labelAlign:"top",fieldLabel:this.inputLabelTxt,xtype:"textfield",style:"margin-top: 6px;margin-left: 8px",width:275,listeners:{change:{scope:this,fn:this.onChangeFn}},triggers:[this.loadTrigger]});this.sobrescribir=Ext.create({xtype:"checkbox",fieldLabel:this.sobrescribirLabelTxt,style:"margin-left: 8px",width:275,labelWidth:250,hidden:true});if(this.showPrivada){this.privada=Ext.create({xtype:"checkbox",fieldLabel:this.configuracionPrivadaLabelTxt,style:"margin-left: 8px",width:275,labelWidth:250,value:true})}this.save=Ext.create({xtype:"button",text:this.guardarLabel,scope:this,handler:this.onSaveFn});this.cancel=Ext.create({xtype:"button",text:this.cancelarLabel,scope:this,handler:this.onCancelFn});this.items={xtype:"panel",buttonAlign:"right",layout:"vbox",defaults:{style:""},items:[this.input,this.sobrescribir,this.privada],buttons:[this.save,this.cancel]};this.callParent()},show:function(a){this.formScope=a;this.input.setValue();this.sobrescribir.setValue();this.sobrescribir.hide();this.loadTrigger.hide();this.callParent()},onSaveFn:function(){var a=this.doOnSave(this,this.formScope);if(a){this.close()}},onCancelFn:function(){var a=this.doOnClose(this,this.formScope);if(a){this.close()}},onChangeFn:function(){this.doOnChange(this,this.formScope)},});Ext.define("At4FrameworkIntranet.AppCfgPrompt",{extend:"At4FrameworkIntranet.ExportBasePrompt",xtype:"at4appConfigSavePrompt",doOnClose:function(){return true},doOnChange:function(b,a){if(!b.dt){b.dt=new Ext.util.DelayedTask()}b.loading=true;b.loadTrigger.show();b.dt.delay(750,function(){GuiService.isAppCfgNameUsed(b.input.getValue(),a.stateId,function(c){b.loading=false;b.loadTrigger.hide();if(c){b.valid=true;b.sobrescribir.hide()}else{b.valid=false;b.sobrescribir.show()}})},a)},doOnSave:function(d,c){var a=d.sobrescribir.getValue();if(d.loading||!(d.valid||(!d.valid&&a))){return false}var g=d.input.getValue();var b=c.stateId;var f=c.getState();var e={etiqueta:g,nombre:b,valor:encodeURIComponent(JSON.stringify(f))};GuiService.saveAppConfig(e,a,function(h){var j="";if(h){j=this.stateSaveSuccessTxt}else{j=this.stateSaveErrorTxt}Ext.toast({html:j,header:false,autoCloseDelay:5000,align:"bl"})});return true},});Ext.define("At4FrameworkIntranet.ExportCfgPrompt",{extend:"At4FrameworkIntranet.ExportBasePrompt",xtype:"at4ExportConfigSavePrompt",showPrivada:true,height:250,doOnClose:function(){return true},doOnChange:function(b,a){if(!b.dt){b.dt=new Ext.util.DelayedTask()}b.loading=true;b.loadTrigger.show();b.dt.delay(750,function(){GuiService.isExportCfgNameUsed(b.input.getValue(),a.fromScope.stateId,function(c){b.loading=false;b.loadTrigger.hide();if(c){b.valid=true;b.sobrescribir.hide()}else{b.valid=false;b.sobrescribir.show()}})},a)},doOnSave:function(e,f){var a=e.sobrescribir.getValue();if(e.loading||!(e.valid||(!e.valid&&a))){return false}var c=f.getValues();var h=e.input.getValue();var d=f.fromScope.stateId;var b=e.privada.getValue();var g={etiqueta:h,nombre:d,privada:b,columnas:encodeURIComponent(JSON.stringify(c.columns)),formato:encodeURIComponent(JSON.stringify(c.formato))};GuiService.saveExportConfig(g,a,function(j){var l="";if(j){l=this.expcfgSaveSuccessTxt;var k=f.afterInsertItem||function(){};k=k.bind(f);k(j)}else{l=this.expcfgSaveErrorTxt}Ext.toast({html:l,header:false,autoCloseDelay:5000,align:"bl"})});return true},});Ext.define("At4FrameworkIntranet.ExportForm",{extend:"Ext.form.Panel",xtype:"configureExportForm",formatoTxt:"Formato",columnasTxt:"Columnas",configuracionTxt:"Configuraciones guardadas",cargarTxt:"Cargar",guardarTxt:"Guardar",reiniciarTxt:"Reiniciar",borrarTxt:"Borrar",cerrarTxt:"Cerrar",exportarTxt:"Exportar",formats:[{label:"Documento Microsoft Excel (xls)",code:"xls"},{label:"Valores separados por coma (csv)",code:"csv"},{label:"Documento portable PDF (pdf)",code:"pdf"},{label:"Documento Microsoft Word (docx)",code:"docx"}],constructor:function(b){this.id=Ext.id();this.fromScope=b.application;this.nameStateId=b.application.stateId;var h={};var l=this.formats;var k=Ext.create("Ext.data.Store",{fields:["label","code"],data:l});var a=[];for(var f=0;f<b.customExportColumns.length;f++){var e=b.customExportColumns[f];var c=e.header;var m=e.dataIndex;if(m&&c&&e.baseId!="-leftActions-head"&&e.baseId!="-rightActions-head"){a.push({label:c,code:m})}}var j=Ext.create("Ext.data.Store",{fields:["label","code"],data:a});var g={liveFiltersFn:function(){return[{property:"nombre",value:this.nameStateId}]}.bind(this)};h.formato=Ext.create({xtype:"combobox",fieldLabel:this.formatoTxt,store:k,queryMode:"local",editable:false,displayField:"label",labelAlign:"top",name:"formato",value:"pdf",allowBlank:false,width:250,valueField:"code"});h.columnas=Ext.create({xtype:"At4Framework-itemselector",fieldLabel:this.columnasTxt,ddReorder:false,disableDD:true,draggable:false,name:"columns",width:450,height:400,displayField:"DISPLAY",labelAlign:"top",valueField:"ID",fromStore:At4FrameworkIntranet.FormDefaults.getStore(this.fromScope.gridMetaData.formItem.form,{name:"ORDER",type:"int"},null,FormDataService.getExportCols),});h.configuracion=new At4FrameworkIntranet.ComboBox({labelAlign:"top",fieldLabel:this.configuracionTxt,store:At4FrameworkIntranet.FormDefaults.getStore("ConfigExportacion",[{name:"FORMATO"},{name:"COLUMNAS"},{name:"EDITABLE",type:"boolean"}],g,GuiService.getListadoConfigExportacion),remoteFilter:false,allQuery:this.nameStateId,width:At4FrameworkIntranet.FormDefaults.TEXT_FIELD_WIDTH,recordPK:"id",showAddRelated:false,showReloadButton:true,editable:false,listeners:{change:{scope:this,fn:function(n,p,o){if(p&&n.getSelectedRecord().data.EDITABLE){this.fields.aplicar.enable();this.fields.borrar.enable()}else{this.fields.aplicar.disable();this.fields.borrar.disable()}}}}});h.aplicar=Ext.create({xtype:"button",text:this.cargarTxt,scope:this,disabled:true,border:true,handler:function(){var o=this.fields.configuracion.getSelectedRecord();var n=JSON.parse(decodeURIComponent(o.get("FORMATO")));var p=JSON.parse(decodeURIComponent(o.get("COLUMNAS")));this.fields.formato.setValue(n);this.fields.columnas.setValue(p)}});h.guardar=Ext.create({xtype:"button",text:this.guardarTxt,scope:this,border:true,handler:function(n,o){this.nameWindow.show(this)}});h.reiniciar=Ext.create({xtype:"button",text:this.reiniciarTxt,scope:this,border:true,handler:function(n,o){this.reset()}});h.borrar=Ext.create({xtype:"button",text:this.borrarTxt,scope:this,disabled:true,border:true,handler:function(){var n=this.fields.configuracion.getDisplayValue();var o=this.fields.configuracion.getValue();Ext.Msg.show({title:"Seguro?",message:"Esta a punto de borrar una configuracion de exportado. Este cambio no se puede deshacer",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(p){if(p==="yes"){GuiService.removeConfigExportacion(o,function(q){if(q){Ext.Msg.alert("Finalizado",'La configuracion "'+n+'" ha sido borrada exitosamente');var r=h.configuracion;r.clearValue();r.store.load(r.store.lastOptions)}else{Ext.Msg.alert("Error",'Hubo un error en borrar la configuracion "'+n+'".')}})}}})}});this.fields=h;this.items={xtype:"container",scrollable:true,height:"100%",layout:"anchor",items:[{xtype:"At4Framework-responsiveContainer",layout:"column",minHeight:90,border:"0 0 1px 0",padding:"7px 15px 0 15px",style:{borderColor:"black",borderStyle:"solid"},items:[h.configuracion,{xtype:"container",width:"100%",layout:"hbox",padding:"10px 20px",defaults:{margin:"0 5 5 0"},items:[h.aplicar,h.guardar,h.borrar,h.reiniciar]}],},{xtype:"At4Framework-responsiveContainer",style:"padding-top: 13px;",items:At4FrameworkIntranet.FormDefaults.columns([[h.columnas,h.formato]])}]};var d=this.getId()+"nameWindow";this.nameWindow=Ext.getCmp(d);if(!this.nameWindow){this.nameWindow=Ext.create({xtype:"at4ExportConfigSavePrompt"})}this.buttons=[{text:this.exportarTxt,scope:this,handler:function(o,p){var n=this.getValues();var r=n.formato||"pdf";var q=n.columns||[];this.fromScope.exportFile(r,null,null,"advancedExport",q);console.log("exportar",arguments)}},{text:this.cerrarTxt,iconCls:At4util.icons.close,scope:this,cls:"at4-delete",style:"margin: 0px 5px 0px 5px",handler:function(){this.fromScope.configWindow.close()}}];this.callParent()},afterInsertItem:function(c){var a={FORMATO:c.formato,COLUMNAS:c.columnas,DISPLAY:c.etiqueta,ID:c.id,};var b=this.fields.configuracion;b.store.loadRawData([a]);b.selectValue(c.id);console.log(a)},});Ext.define("At4FrameworkIntranet.ExportWindow",{extend:"At4FrameworkIntranet.Window",xtype:"at4GridListWindow",width:355,modal:true,plain:true,layout:"fit",height:170,resizable:true,closable:true,closeAction:"destroy",title:"Configuraciones de listado",cargarTxt:"Cargar",seleccionarTxt:"Seleccionar configuracion",borrarTxt:"Borrar",borrarMsgTitle:"Seguro?",borrarMsgMessage:"Esta a punto de borrar una configuracion del listado. Este cambio no se puede deshacer",borrarMsgOkTitle:"Finalizado",borrarMsgOk:"La configuracion %disp% ha sido borrada exitosamente",borrarMsgKoTitle:"Error",borrarMsgKo:"Hubo un error en borrar la configuracion %disp%.",constructor:function(b){var a={};var c={liveFiltersFn:function(){return[{property:"nombre",value:b.name}]}};a.configuracion=new At4FrameworkIntranet.ComboBox({labelAlign:"top",fieldLabel:this.seleccionarTxt,editable:false,margin:"5px 0 0 15px",width:320,store:At4FrameworkIntranet.FormDefaults.getStore("ConfigAplicacion",{name:"VALOR"},c,GuiService.getListadoConfigAplicacion),remoteFilter:false,recordPK:"id",showReloadButton:true,showAddRelated:false,listeners:{change:{scope:this,fn:function(d,f,e){if(f){a.borrar.enable();a.cargar.enable()}else{a.borrar.disable();a.cargar.disable()}}}}});a.cargar=Ext.create({xtype:"button",scope:this,showReloadButton:true,text:this.cargarTxt,disabled:true,handler:function(){console.log(arguments);var e=a.configuracion.getSelectedRecord();var f=JSON.parse(decodeURIComponent(e.data.VALOR));console.log(f);var d=b.onLoad(f);if(d){this.close()}}});a.borrar=Ext.create({xtype:"button",scope:this,showReloadButton:true,text:this.borrarTxt,disabled:true,handler:function(){var d=this.fields.configuracion.getDisplayValue();var e=this.fields.configuracion.getValue();Ext.Msg.show({title:this.borrarMsgTitle,message:this.borrarMsgMessage,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(f){if(f==="yes"){GuiService.removeConfigAplicacion(e,function(g){if(g){Ext.Msg.alert(this.borrarMsgOkTitle,this.borrarMsgOk.replace("%disp%",d));var h=a.configuracion;h.clearValue();h.store.load(h.store.lastOptions)}else{Ext.Msg.alert(this.borrarMsgKoTitle,this.borrarMsgKo.replace("%disp%",d))}})}}})}});this.fields=a;this.items={xtype:"panel",buttonAlign:"right",layout:"vbox",items:[a.configuracion],buttons:[a.cargar,a.borrar]};this.callParent()},});Ext.define("At4FrameworkIntranet.AbstractGrid",{extend:"Ext.grid.Panel",yesText:"Si",noText:"No",abrirText:"Abrir",accionesText:"Acciones",eliminarText:"Eliminar",guardarText:"Guardar",guardarTodoText:"Guardar todo",cancelarTodoText:"Cancelar todo",pregCancelarTodoText:"Â¿Cancelar todo?",cancelarTodoMsgText:"¿Desea cancelar todos los cambios pendientes?<br/>Esta acción no se puede deshacer.",copiarText:"Copiar",nadaHacerText:"Nada que hacer",noRegistroModificadoText:"No hay ningún registro modificado.",modificadoElementoText:"Modificado 1 elemento ",modificadosElementosText:"Modificados {0} elementos ",limpiarFiltrosText:"Limpiar filtros",limpiarFiltrosTipText:"Limpiar los filtros configurados",nuevoText:"Nuevo",nuevoTipText:"Añadir nuevo registro",exportarText:"exportar",exportarTipText:"convertir a formatos de intecambio",cargandoText:"cargando ...",noPuedeMoverColumnaText:"No puede mover esta columna",borrarRegistroTxt:"Â¿Borrar registro?",borrarSeguroTxt:"Â¿Borrar el registro {0}?<br/>Esta acción no se puede deshacer.",borrarAuditorias:"Â¿Borrar el registro {0}?<br/>Esta acción no se puede deshacer.",textExportarPdfSolicitud:"PDF de la solicitud",textExportarPdfsSolicituds:"PDFs de les solicituds",pdfs:"PDFs",textCodigoBarras:"Lectura de código de barras",codigoBarras:"Introducir código",textInformeDeutes:"Informe de Deutes",textInformeDeficiencies:"Informe de Deficiencies",textTramitsAudiencia:"Tramits audiÃ¨ncia",errorInformeDeficiencies:"No es pot generar l'informe de deficiencies. La convocatoria no te aquest tipus d'informe.",errorInformeDeutes:"No es pot generar l'informe de deutes. La convocatoria no te aquest tipus d'informe.",errorInformeDeutesCompteCorrent:"No es pot generar l'informe de deutes. L'expedient no te el compte de pagament informat.",errorInformeTramitsAudiencia:"No es pot generar l'informe de tramis d'audiÃ¨ncia. La convocatoria no te aquest tipus d'informe.",autoSizeColumns:function(){if(this.autoSized){return}if(this.application.tabPanel.getActiveTab()!=this&&this.rendered){return}if(!this.store.isLoaded()){return}this.autoSized=true;if(At4Framework_modoDesarrollo){console.debug("Autosize columns")}window.setTimeout(function(){var c=this.getView().getHeaderCt().getVisibleGridColumns();var a=c.length;for(var b=0;b<a;b++){var d=c[b];d.autoSize();if(d.width<d.autoSizeMinWidth){d.setWidth(d.autoSizeMinWidth)}else{if(d.width>d.autoSizeMaxWidth){d.setWidth(d.autoSizeMaxWidth)}}}}.bind(this),50)},exportFile:function(f,n,d,o,l){if(!n){n="./export/exportar"}var c=this.store.lastOptions;o=o?o:"export";var p={filename:o};if(c.grouper){p.groupBy=c.grouper._property}if(c.sorters){p.direction=c.sorters[0]?c.sorters[0]._direction:""}if(c.groupers){p.sort=c.sorters[0]?c.groupers[0]._property:""}if(c.sorters){p.sort=p.sort?p.sort:"";p.sort+=c.sorters[0]?c.sorters[0]._property:""}var j=c.filters?c.filters:[];var h=0;for(var r=0;r<j.length;r++,h++){p["filter_field_"+h]=j[r]._property;var b=j[r].type;b=(b=="multiList")?"list":b;p["filter_type_"+h]=b;var t=j[r]._value;if(t instanceof Date){t=Ext.Date.format(t,"d/m/Y")}p["filter_value_"+h]=t;if(j[r]._operator&&j[r].type!="boolean"){p["filter_comparison_"+h]=j[r]._operator}}for(var r=0;r<this.extraFilters.length;r++,h++){p["filter_field_"+h]=this.extraFilters[r].field;p["filter_type_"+h]=this.extraFilters[r].data.type;p["filter_value_"+h]=this.extraFilters[r].data.value;if(this.extraFilters[r].data.comparison){p["filter_comparison_"+h]=this.extraFilters[r].data.comparison}}p.formName=this.gridMetaData.formItem.form;p.exportCols=l||[];var m=Ext.id();var k=document.createElement("iframe");k.id=m;k.name=m;k.className="x-hidden";if(Ext.isIE){k.src=Ext.SSL_SECURE_URL}document.body.appendChild(k);if(Ext.isIE){document.frames[m].name=m}var a=Ext.DomHelper.append(document.body,{tag:"form",method:"post",action:n+"."+f,target:m});document.body.appendChild(a);var q;for(var e in p){q=document.createElement("input");q.type="hidden";q.name=e;q.value=p[e];a.appendChild(q)}if(d){var s=d.get("oid");q=document.createElement("input");q.type="hidden";q.name="claveItemPdf";q.value=s;a.appendChild(q)}var g=function(){Ext.EventManager.removeListener(k,"load",g,this);setTimeout(function(){document.body.removeChild(k)},110)};Ext.EventManager.on(k,"load",g,this);a.submit()},findFirstGroupingField:function(a){for(i in a){if(a[i].groupable){return a[i].dataIndex}}return""},columnStoreRenderer:function(b,e,a,g,c){var f="";if(b){var d=null;if((d=e.column.columnStore.getById(b))){f=d.get("DISPLAY")}else{f=b}}return f},configureGridMetaData:function(){var d=this.gridMetaData;var a=this.customConfig;if(d.configured){for(var b=0;b<this.columns.length;b++){var c=this.columns[b];this.configureEditMode(c);c.id=this.getId()+c.baseId;c.stateId=this.stateId+c.baseId}useGroupSummary=d.useGroupSummary;if(!d.disableOpenForm){this.leftRowActions=this.columns[0]}if(this.gridMetaData.showDeleteButton){this.rightRowActions=this.columns[this.columns.length-1]}}else{for(var b=0;b<this.columns.length;b++){var c=this.columns[b];this.configureEditMode(c);c.baseId=c.dataIndex+"-head";c.id=this.getId()+c.baseId;c.stateId=this.stateId+c.baseId;if(a&&a.columns&&a.columns[c.dataIndex]){Ext.apply(c,a.columns[c.dataIndex])}this.configureRenderers(c);this.configureFilters(c);if(!c.width){c.width=150}this.configureSummaryType(c)}this.configureRowActions();this.bindActions();this.gridMetaData.configured=true}},configureRowActions:function(){var a=this.customConfig;var c=this.configProperties;var d=this.gridMetaData;if(!d.disableOpenForm){this.leftRowActions=Ext.apply({header:"&nbsp;",xtype:"actioncolumn",width:50,baseId:"-leftActions-head",id:this.getId()+"-leftActions-head",items:[{setIconCls:"icon-add",icon:"img/ico/Editar_ico.png",tooltip:this.abrirText,handler:function(f,h,e){var g=f.getStore().getAt(h);g.data.oid=g.data.oid||g.data.codigo;this.openRecord(g)}.bind(this)}]},this.rowActionsDefaults);this.columns.splice(0,0,this.leftRowActions)}this.rightActions=new Array();this.hasRowActions=false;if(c.editMode){saveButton={iconCls:"icon-disk",getClass:function(e,f,g){if(g.dirty){return"icon-disk"}else{return"x-item-disabled-icon-disk"}},tooltip:this.guardarText,disabled:true,hideIndex:"cannotSave"};cancelButton={iconCls:"icon-cross",getClass:function(e,f,g){if(g.dirty){return"icon-cross"}else{return"x-item-disabled-icon-cross"}},tooltip:this.guardarText,disabled:true,hideIndex:"cannotSave"};this.rightActions.push(saveButton);this.rightActions.push(cancelButton);this.hasRowActions=true}if(this.gridMetaData.showDeleteButton){deleteButton={iconCls:"icon-minus",tooltip:this.eliminarText,hideIndex:"cannotDelete"};this.rightActions.push(deleteButton);this.hasRowActions=true}if(a&&a.rightActions){for(var b=0;b<a.rightActions.length;b++){this.rightActions.push(a.rightActions[b])}this.hasRowActions=true}},bindActions:function(){if(this.hasRowActions){if(this.rightActions){var a=[];for(x in this.rightActions){if(this.rightActions.hasOwnProperty(x)){a.push({iconCls:this.rightActions[x].iconCls,getClass:this.rightActions[x].getClass,handler:this.rightRowActionsHandler,scope:this,tooltip:this.rightActions[x].tooltip})}}this.rightRowActions=Ext.apply({header:this.accionesText,xtype:"actioncolumn",baseId:"-rightActions-head",id:this.getId()+"-rightActions-head",width:100,items:a},this.rowActionsDefaults)}this.columns[this.columns.length]=this.rightRowActions}},configureEditMode:function(c){var a=this.customConfig;var d=this.configProperties;if(d.editMode){if(c.editable){var b={};if(a&&a.editor&&a.editor[c.dataIndex]){b=a.editor[c.dataIndex]}else{b=this.formPanel.getFieldEditor(c.dataIndex)}if(b){c.editor=b;c.editor.grid=this;c.editor.boxLabelCls="at4-hidden";c.editor.labelCls="at4-hidden";if(!b.disabled){c.cls="editable-cell-header";c.tdCls="editable-cell"}}}}else{c.editable=false}},configureRenderers:function(column){var customConfig=this.customConfig;var gridMetaData=this.gridMetaData;column.minWidth=70;column.maxWidth=1024;column.autoSizeMinWidth=70;column.autoSizeMaxWidth=240;if(customConfig&&customConfig.renderers&&customConfig.renderers[column.dataIndex]){column.renderer=customConfig.renderers[column.dataIndex]}else{if(column.sofaRenderer){switch(column.sofaRenderer){case"text":column.renderer=function(value,metaData,record,rowIndex,colIndex,store){metaData.css="sofa-wrap-normal";var rendered=Ext.util.Format.ellipsis(value,300);return rendered};if(!column.width){column.width=120}column.autoSizeMinWidth=70;column.autoSizeMaxWidth=200;break;case"largetext":column.renderer=function(value,metaData,record,rowIndex,colIndex,store){metaData.css="sofa-wrap-normal";var rendered=Ext.util.Format.ellipsis(value,300);return rendered};if(!column.width){column.width=240}column.autoSizeMinWidth=160;column.autoSizeMaxWidth=240;break;case"many2many":column.renderer=function(value,metaData,record,rowIndex,colIndex,store){metaData.css="sofa-wrap-normal";if(value==""||value==null||value.length<1){return value}var separator=", ";var ret="";for(var i=0;i<value.length;i++){if(i>0){ret+=separator}ret+=value[i].primaryLabel}return ret};if(!column.width){column.width=240}column.autoSizeMinWidth=240;column.autoSizeMaxWidth=240;break;case"password":column.renderer=function(value,metaData,record,rowIndex,colIndex,store){return"********"};break;case"date":column.renderer=function(value,metaData,record,rowIndex,colIndex,store){var rendered="";if(value){rendered=Ext.Date.format(value,"d-m-Y")}return rendered};break;case"datetime":column.renderer=function(value,metaData,record,rowIndex,colIndex,store){var rendered="";if(value){rendered=Ext.Date.format(value,"d-m-Y H:i")}return rendered};break;case"time":column.renderer=Ext.util.Format.dateRenderer("H:i:s");break;case"euromoney":column.renderer=Ext.util.Format.euroMoney;column.align="right";break;case"bulkimage":case"binfile":column.renderer=function(value,metaData,record,rowIndex,colIndex,store){return value?this.yesText:this.noText}.bind(this);break;case"boolean":column.renderer=function(value,metaData,record,rowIndex,colIndex,store){if(value===null){return""}return value?this.yesText:this.noText}.bind(this);break;case"popup":var modelName="At4FrameworkIntranet.simpleStoreModel"+gridMetaData.formItem.form+column.dataIndex;if(!eval(modelName)){Ext.define(modelName,{extend:"Ext.data.Model",fields:["ID","DISPLAY"],idProperty:"ID"})}column.columnStore=Ext.create("Ext.data.Store",{model:modelName,data:column.sofaStoreValues});column.renderer=this.columnStoreRenderer.bind(this);break;case"relationpopup":var columnName=column.dataIndex;var relatedForm=column.relatedForm;column.columnStore=Ext.create("Ext.data.Store",{proxy:serverDatabaseActions.createRelationPopupProxy(relatedForm),reader:{type:"json",totalProperty:"totalNumRecords",rootProperty:"resultados",id:"ID"},fields:[{name:"ID"},{name:"DISPLAY"}],});column.columnStore.load();column.renderer=this.columnStoreRenderer.bind(this);break;case"checkbox":break}}}},configureFilters:function(c){var f=this.configProperties;var a=this.customConfig;if(f.useFilters){var e=null;if(c.sofaFilter){var b=c.sofaFilter.type;switch(b){case"multicombo":if(!c.columnStore){if(a&&a.columnStore&&a.columnStore[c.dataIndex]){c.columnStore=a.columnStore[c.dataIndex]}else{var d=c.relatedForm;c.columnStore=At4FrameworkIntranet.FormDefaults.getStore(d)}}if(c.columnStore){c.sofaFilter.type="multiList";c.sofaFilter.labelField="DISPLAY";c.sofaFilter.idField="ID";c.sofaFilter.phpMode=true;c.sofaFilter.store=c.columnStore;e=c.sofaFilter}break;case"list":if(c.sofaStoreValues){c.sofaFilter.labelField="DISPLAY";c.sofaFilter.phpMode=true;c.sofaFilter.options=c.sofaStoreValues;e=c.sofaFilter}break;default:e=c.sofaFilter;break}c.filter=c.sofaFilter}}},configureSummaryType:function(a){var b=this.configProperties;if(a.summaryType){this.gridMetaData.useGroupSummary=true;a.summaryRenderer=function(g,d,c,h,f,e){if(this.renderer){g=this.renderer(g,d,c,h,f,e)}this.renderizadoSummary=d[this.id].text+": "+g;return g}.bind(a)}},rightRowActionsHandler:function(c,f,b,e,d,a){switch(e.iconCls){case"icon-minus":this.deleteRecord(a);break;case"icon-disk":this.updateRecord(a);break;case"icon-cross":this.rejectRecord(a);break;case"icon-arrow-up":this.actualizarPosicion(a,"up");break;case"icon-arrow-down":this.actualizarPosicion(a,"down");break;case"icon-map":this.mostrarMapa(a);break;case"icon-application-double":alert("duplicado");break;default:Ext.toast("Error: Accion no reconocida.");break}},});Ext.namespace("At4FrameworkIntranet");Ext.define("At4FrameworkIntranet.ListadoGrid",{extend:"At4FrameworkIntranet.AbstractGrid",uses:["Ext.ux.grid.PageSize"],constructor:function(f,J,q,s,b){this.debugConstructorCallTime=new Date();this.viewer=f;this.application=q;this.customConfig=b;this.autoSized=false;Ext.apply(this,J);this.gridMetaData=s;this.activeFilterCount=0;if(b){if(b.gridConfig){Ext.apply(t,b.gridConfig)}}var e=new At4FrameworkIntranet.ListadoGridConfig(this,t);e.editMode=s.editable;this.editMode=e.editMode;this.columns=s.columns;this.tipo=s.editable?"editable":J.tipo;var z="At4FrameworkIntranet.dataModel"+this.id;var k="";this.extraFilters=b?b.extraFilters:[];if(Ext.ClassManager.isCreated(z)){k=Ext.ClassManager.get(z)}else{k=Ext.define(z,{extend:"Ext.data.Model",idProperty:"oid",proxy:{type:"dwr",dwrFunction:FormDataService.getListado,dwrParams:[this.gridMetaData.formItem.form],listeners:this.getListeners(this.extraFilters),reader:{type:"json",totalProperty:"totalNumRecords",rootProperty:"resultados",model:k}},fields:s.recordFields})}var C={model:k,groupField:e.groupField||s.defaultGroupBy||"",listeners:{beforeload:function(L,M){if(L.getModifiedRecords().length>0){Ext.Msg.alert("Debe cancelar los cambios","Existen registros modificados sin guardar<br/>debe guardar o cancelar los cambios para poder continuar");return false}},load:{scope:this,fn:function(M,L,O,N){if(!M.groupField&&!M.isGrouped()){this.getView().getFeature(0).disable()}this.autoSizeColumns()}}},pageSize:this.myPageSize,remoteSort:true,remoteFilter:true,};this.store=Ext.create("Ext.data.Store",C);if(e.sortField){this.store.setSorters([{property:e.sortField,direction:e.sortDirection?e.sortDirection:"ASC"}])}else{if(s.defaultSort){this.store.setSorters([{property:s.defaultSort,direction:s.defaultDirection?s.defaultDirection:"ASC"}])}}var B=false;this.formPanelName="At4FrameworkIntranet."+s.formClassName;if(e.editMode){this.formPanel=Ext.create(this.formPanelName,this.application,s.formItem.form,s,{id:Ext.id()})}this.configProperties=e;this.configureGridMetaData();this.statusBar=Ext.getCmp("At4Framework-status");var d=[];var H=[];var D=Ext.create("Ext.button.Button",{id:this.getId()+"filterOutButton",text:this.limpiarFiltrosText,tooltip:this.limpiarFiltrosTipText,hideMode:"visibility",iconCls:"icon-filter-out",scope:this,handler:this.clearFilters});var o=false;if(b&&b.buttons){for(E=0;E<b.buttons.length;E++){var j=Ext.create("Ext.button.Button",b.buttons[E]);H.splice(0,0,j)}o=true}if(this.gridMetaData.showNewButton){var h=Ext.create("Ext.button.Button",{text:this.nuevoText,tooltip:this.nuevoTipText,iconCls:"icon-plus",scope:this,handler:this.newRecord});H.splice(0,0,h);o=true}if(o){H.push("-")}H.push(D);H.push("->");if(e.editMode){var l={xtype:"tbseparator",id:this.getId()+"buttonsSeparator",};H.push(l);var r=this;var y=Ext.create("Ext.button.Button",{text:this.guardarTodoText,iconCls:"icon-disk-all",scope:this,id:this.getId()+"saveallButton",handler:this.commitChanges});H.push(y);var m=Ext.create("Ext.button.Button",{text:this.cancelarTodoText,iconCls:"icon-undo",id:this.getId()+"cancelallButton",scope:this,handler:this.rejectChanges});H.push(m)}this.displaySummaryItem=Ext.create("Ext.toolbar.TextItem",{text:""});H.push(this.displaySummaryItem);if(this.showResetStateButton){H.push({text:this.olvidarEstadoTexto,iconCls:"glyphicons glyphicons-cloud-minus",scope:this,handler:function(){Ext.Msg.show({title:this.borrarEstadoListado,message:this.mensajeEstado,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,scope:this,fn:function(L){if(L==="yes"){this.resetStateFn()}}})}})}var p=[{text:"excel",iconCls:"icon-export-excel",scope:this,handler:function(){this.exportFile("xls")}},{text:"csv",iconCls:"icon-export-csv",scope:this,handler:function(){this.exportFile("csv")}},{text:"pdf",iconCls:"icon-export-pdf",scope:this,handler:function(){this.exportFile("pdf")}},{text:"docx",iconCls:"icon-export-docx",scope:this,handler:function(){this.exportFile("docx")}}];if(this.gridMetaData.customExportFormats){var G=this.gridMetaData.customExportFormats.length;for(var E=0;E<G;E++){var F=this.gridMetaData.customExportFormats[E];p.push({text:F,iconCls:"icon-export-"+F,scope:this,handler:function(){this.exportFile(F)}})}}if(false&&this.gridMetaData.showExportControls){H.push("-");H.push(new Ext.button.Button({text:this.exportarText,tooltip:this.exportarTipText,iconCls:At4util.icons.exportar,menu:{items:p}}))}if(true||this.showNeuExportButton){var K=this.getId()+"configWindow";this.configWindow=Ext.getCmp(K);if(!this.configWindow){this.gridConfigForm=Ext.create("At4FrameworkIntranet.ExportForm",{customExportFormats:this.gridMetaData.customExportFormats,customExportColumns:this.columns,application:this});this.configWindow=Ext.create({xtype:"at4window",width:850,modal:true,plain:true,title:this.configExportWindowTitle,layout:"fit",height:680,id:K,closeAction:"hide",items:[this.gridConfigForm]})}var u=this.getId()+"nameWindow";this.nameWindow=Ext.getCmp(u);if(!this.nameWindow){this.nameWindow=Ext.create({xtype:"at4appConfigSavePrompt"})}var n={text:"Configurar",iconCls:At4util.icons.configure,menu:{items:[{text:this.configMenuGuardarHeaderLabel,scope:this,iconCls:At4util.icons.save,handler:function(){var L=this;this.nameWindow.show(this)}},{text:this.configMenuAplicarHeaderLabel,scope:this,iconCls:At4util.icons.apply,handler:function(){Ext.create("At4FrameworkIntranet.ExportWindow",{name:this.stateId,onLoad:function(L){var M=Ext.state.Manager.getProvider();Ext.ux.state.HttpProvider.superclass.set.call(M,this.stateId,L);this.application.reloadListGrid(this);return true}.bind(this)}).show()},},{text:this.configMenuReiniciarHeaderLabel,scope:this,iconCls:At4util.icons.restart,handler:function(){this.reconfigure(null,this.gridMetaData.columns)}}]}};p.push({text:this.configMenuAvanzadoHeaderLabel,scope:this,iconCls:At4util.icons.avanzado,handler:function(){this.configWindow.show(this)}});var w={text:this.exportarText,iconCls:At4util.icons.exportar,menu:{items:p,}};var c=this.extraSubMenuHerramientas?this.extraSubMenuHerramientas:null;var g=Ext.create("Ext.button.Button",{text:this.herramientasText,tooltip:this.exportarTipText,iconCls:At4util.icons.herramientas,menu:{items:[n,w,c]}});H.push("-");H.push(g)}var A=Ext.create("Ext.toolbar.Toolbar",{items:H});if(b&&b.selectionModel){selectionModel=b.selectionModel}var v=null;var I={forceFit:false,enableRowBody:false};I.groupTextTpl="{text}";if(b&&b.viewConfig){Ext.apply(I,b.viewConfig)}var a=[];this.filtersActivos=[];if(e.useFilters){d.push({ptype:"gridfilters",stateId:this.getStateId()+"-pFilters",})}if(this.gridMetaData.useGroupSummary){a.push({ftype:"groupingsummary",groupByText:this.groupByTextLabel,showGroupsText:this.showGroupsTextLabel,})}else{a.push({ftype:"grouping",groupByText:this.groupByTextLabel,showGroupsText:this.showGroupsTextLabel,})}var t={};switch(this.tipo){case"normal":t={editMode:false};break;case"editable":t={editMode:true};d.push({ptype:"cellediting",clicksToEdit:2});break}this.callParent([{region:"center",viewConfig:{enableTextSelection:true,},features:a,stripeRows:true,dockedItems:[A,{xtype:"pagingtoolbar",pageSize:this.myPageSize,store:this.store,dock:"bottom",displayInfo:true,plugins:[new Ext.ux.grid.PageSize()]}],loadMask:{msg:this.cargandoText},plugins:d,listeners:{beforeedit:function(L,N,M){if(N.record.get("cannotUpdate")){return false}},afterrender:function(L,M){this.setOutButtons();this.batchButtons()},destroy:function(L,M){this.application.unRegisterTabId(L);this.autoSized=false},edit:function(Q,L,O){var P=L.grid.formPanel.getFieldEditor(L.field,true);if(P.xtype=="At4Framework-combobox"){var M=P.getStore().findRecord("ID",L.value);var N=M.data.DISPLAY;L.record.set(L.field,N);L.record.set(L.field+"Id",L.value);L.record.set(L.field+"Label",N)}this.batchButtons()},validateedit:function(P,L,N){var O=L.grid.formPanel.getFieldEditor(L.field,true);if(O.xtype=="At4Framework-combobox"){var M=O.getStore().findRecord("ID",L.value);if(!(L.value!=L.originalValue&&M)){return false}}return true},filterchange:function(L,N,M){this.activeFilterCount=N.length;this.setOutButtons()},columnmove:function(L,O,R,N,M){if(L.getVisibleGridColumns().length<=N){var Q=this.headerCt;var P=Q.getGridColumns().length-1;Q.move(P,P-1);this.getView().refresh()}},columnschanged:function(L,M){this.autoSizeColumns()},show:{scope:this,fn:this.autoSizeColumns},add:{scope:this,fn:this.autoSizeColumns}}}]);if(At4Framework_modoDesarrollo){console.debug("Tiempo de carga de ListadoGrid: "+(new Date()-this.debugConstructorCallTime)+"ms")}},openRecord:function(a){this.application.openRecordForm(this.gridMetaData.formItem,a.data)},newRecord:function(){this.application.openNewRecordForm(this.gridMetaData.formItem)},clearFilters:function(){this.filters.clearFilters();this.activeFilterCount=0;if(this.rendered){this.setOutButtons()}},setOutButtons:function(){var a=Ext.get(this.getId()+"filterOutButton");if(this.activeFilterCount>0){if(a){a.show()}}else{if(a){a.hide()}}},batchButtons:function(){if(this.editMode){var d=Ext.get(this.getId()+"saveallButton");var a=Ext.get(this.getId()+"cancelallButton");var b=Ext.get(this.getId()+"buttonsSeparator");var c=this.store.getModifiedRecords();if(c.length>0){d.show();a.show();b.show()}else{d.hide();a.hide();b.hide()}this.doLayout()}},updateRecord:function(a){var b=a.get("oid");if(a.dirty){serverDatabaseActions.updateGrid(this.gridMetaData.formItem.form,[b],[a],this.updateRecordCallback,this)}else{Ext.Msg.alert(this.nadaHacerText,this.noRegistroModificadoText)}},rejectRecord:function(a){a.reject();this.batchButtons();this.setOutButtons()},commitChanges:function(){var a=this.store.getModifiedRecords();if(!a.length){Ext.Msg.alert(this.nadaHacerText,this.noRegistroModificadoText);return}var b=[];var d=[];var c;Ext.each(a,function(f,e){c=f.get("oid");b.push(c);d.push(f)},this);serverDatabaseActions.updateGrid(this.gridMetaData.formItem.form,b,d,this.updateRecordCallback,this)},rejectChanges:function(){var b=this.store.getModifiedRecords();if(!b.length){Ext.Msg.alert(this.nadaHacerText,this.noRegistroModificadoText);return}var a=this.store;Ext.Msg.show({title:this.pregCancelarTodoText,msg:this.cancelarTodoMsgText,icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,scope:this,fn:function(c){if("yes"!==c){return}a.rejectChanges();this.batchButtons()}})},deleteRecord:function(a){Ext.Msg.show({title:this.borrarRegistroTxt,msg:Ext.String.format(this.borrarSeguroTxt,"<b>"+a.data.oid+"</b>"),icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,scope:this,fn:function(b){if("yes"!==b){return}var c=a.data.oid;if(c==0){a.commit();this.store.remove(a)}else{serverDatabaseActions.deleteForm(this.gridMetaData.formItem.form,c,this.deleteRecordCallback,this)}}})},updateRecordCallback:function(b,c){if(c.correcto){var f="";var a=b.length;for(var d=0;d<a;d++){b[d].commit()}if(a>0){if(a>1){f+=Ext.String.format(this.modificadosElementosText,a)}else{f+=this.modificadoElementoText}}this.statusBar.setStatus({text:f,clear:true})}else{var e=c.message;Ext.Msg.alert("Error:",e)}this.batchButtons()},deleteRecordCallback:function(e,b){if(b.correcto){var c=this.store.find("oid",e);if(c!=-1){var a=this.store.getAt(c);a.commit();this.store.remove(a);this.application.onDeleteRecordDone(this,{rowid:e,formName:this.gridMetaData.formItem.form});this.statusBar.setStatus({text:"Borrado 1 elemento",clear:true})}}else{var d=b.message;Ext.Msg.alert("Error:",d)}},mostrarMapa:function(a){mapwin=new Ext.Window({layout:"fit",title:"GMap Window",closeAction:"hide",width:400,height:400,x:40,y:60,items:{xtype:"gmappanel",zoomLevel:4,gmapType:"map",mapConfOpts:["enableScrollWheelZoom","enableDoubleClickZoom","enableDragging"],mapControls:["GSmallMapControl","GMapTypeControl","NonExistantControl"],setCenter:{geoCodeAddr:a.data.codiPais,marker:{title:"Pais"}}}});mapwin.show()},actualizarPosicion:function(a,c){var b=a.get("oid");serverDatabaseActions.actualizarPosicion(this.gridMetaData.formItem.form,b,c,this.actualizarPosicionCallback,this)},actualizarPosicionCallback:function(a){if(a.correcto){var d=this.gridMetaData.formItem.form+"-list";var c=this.application.getTab(d);if(c){c.store.reload();c.show()}}else{var b=a.message;Ext.Msg.alert("Error:",b)}},getListeners:function(a){return{beforeload:function(m,g,f){var n="";var c="";var d=g.filters||[];var b=[];var l=g.sorters||null;for(i in l){if(l.hasOwnProperty(i)){if(i>0){n+=",";c+=","}if(i>=0){n+=l[i]._property;c+=l[i]._direction}}}for(i in a){if(a.hasOwnProperty(i)){b.push(a[i])}}for(i in d){if(d.hasOwnProperty(i)){var h=d[i].serialize();var e="";if(typeof h.value=="object"){for(x in h.value){if(typeof h.value[x]=="string"){if(x==0){e=h.value[x]}else{e+=","+h.value[x]}}}}else{e=h.value}var k=(h.type=="multiList")?"list":h.type;var j={type:k,value:e,};if(h.type=="number"||h.type=="numeric"||h.type=="date"){j.comparison=h.operator}if(typeof j.value!=="undefined"){b.push({field:h.property,data:j})}}}g.currentPage=g.page?g.page:1;g.pageSize=g.limit?g.limit:30;if(g&&g.grouper){g.groupBy=g.grouper._property}g[m.loadArgsKey]=[f[0],b,{start:g.start,limit:g.pageSize,sort:n,direction:c,groupBy:g.groupBy}]},exception:function(d,c,b){Ext.Msg.alert("Error:",c.message?c.message:c)},endprocessresponse:function(f,c,b){if(c.aggregates){var e,h="";var g=false;for(var d=0;d<this.gridMetaData.columns.length;d++){e=this.gridMetaData.columns[d].dataIndex;if(c.aggregates[e]){g=true;h+=" "+this.gridMetaData.columns[d].header+": "+this.gridMetaData.columns[d].renderer(c.aggregates[e])}}if(g){Ext.fly(this.displaySummaryItem.getEl()).update(h);this.doLayout()}}}.bind(this)}},resetStateFn:function(){console.log("Reseteando estado de: "+this.stateId);var a=Ext.state.Manager.getProvider();if(a){a.clear(this.stateId)}this.statusBar.setStatus({text:this.resetListadoTexto+this.title,clear:true})},myPageSize:30,stateful:true,showResetStateButton:false,rowActionsDefaults:{draggable:false,groupable:false,resizable:false,sortable:false,hideable:false,},});At4FrameworkIntranet.ListadoGridConfig=function(b,a){this.editMode=true;this.useFilters=true;this.sortField="";this.sortDirection="";this.useGrouping=true;this.groupField=null;this.groupActions=false;Ext.apply(this,a);this.grid=b};Ext.namespace("At4FrameworkIntranet");Ext.define("At4FrameworkIntranet.BasicPanel",{extend:"Ext.panel.Panel",disabled:true,addEnabled:true,editEnabled:true,modifyEnabled:true,deleteEnabled:true,extraPanel:{hidden:true},extraButtons:[],constructor:function(f,c){this.listeners={activate:{fn:function(h){h.isActiveTab=true;if(h.parentFormPanel.dataId&&h.deferredLoad&&!h.dataLoaded){h.parentFormPanel.loadSubpanelData(h.parentFormPanel.dataId,h.name);h.dataLoaded=true}}},deactivate:{fn:function(h){h.isActiveTab=false}}};Ext.apply(this.listeners,c.listeners);delete c.listeners;Ext.apply(this,c);this.parentFormPanel=f;if(this.deferredLoad){this.dataLoaded=false}else{this.dataLoaded=true}this.isActiveTab=false;this.statusBar=Ext.getCmp("At4Framework-status");var b="At4FrameworkPanel"+this.id+"Model";var a=[];this.reader=Ext.create("Ext.data.reader.Json",{type:"json",totalProperty:"totalNumRecords",rootProperty:"resultados",model:this.dataRecord});var e={remoteSort:true,model:this.dataRecord};Ext.apply(e,this.extraStoreCfg);this.store=Ext.create("Ext.data.Store",e);if(this.editForm){this.editForm.id=this.editForm.id+"-SubForm";this.formWindow=Ext.create({xtype:"at4window",title:this.editarTxt,closable:true,modal:true,closeAction:"hide",width:this.windowWidth,height:this.windowHeight,deferredRender:false,plain:true,layout:"fit",items:this.editForm});this.editForm.setParentPanel(this)}var g={id:this.getId()+"-dataview",itemSelector:this.itemSelector,store:this.store,tpl:this.tpl,listeners:{selectionchange:{fn:function(j,h){if(h.length>0){this.enableRecordEdit()}else{this.disableRecordEdit()}},scope:this},itemdblclick:{fn:function(n,h,l,j,m,k){this.doEditRecord(h)},scope:this},viewready:{fn:this.onRenderDragZoneFunction,scope:this},recordsOrdered:{fn:this.onRecordsOrdered,scope:this}}};Ext.apply(g,this.dataViewDefaultConfig);this.dataView=Ext.create("Ext.view.View",g);this.newButton=new Ext.Button({id:this.getId()+"-newButton",text:this.nuevoTxt,iconCls:At4util.icons.add,scope:this,disabled:!this.addEnabled,hidden:false,style:"margin: 0px 5px 0px 10px;",handler:function(){this.doNewRecord()}});this.editButton=new Ext.Button({id:this.getId()+"-editButton",text:this.editarTxt,iconCls:At4util.icons.editar,scope:this,disabled:!this.modifyEnabled,hidden:false,style:"margin: 0px 5px 0px 10px;",handler:function(){var j=this.dataView.getSelectedNodes()[0];var h=this.dataView.getRecord(j);this.doEditRecord(h)}});this.deleteButton=new Ext.Button({id:this.getId()+"-deleteButton",text:this.borrarTxt,iconCls:At4util.icons.remove,scope:this,disabled:!this.deleteEnabled,hidden:false,style:"margin: 0px 5px 0px 10px;",handler:function(){Ext.Msg.show({title:this.borrarRegistroTxt,msg:this.seguroTxt,icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,scope:this,fn:function(k){if("yes"!==k){return}var h=this.dataView.getRecord(this.dataView.getSelectedNodes()[0]);var j=h.data.oid;if(this.parentFormPanel.formName!=null){serverDatabaseActions.runAction(FormDataService.deleteSubForm,[this.parentFormPanel.formName,this.parentFormPanel.dataId,this.editForm.subFormName,j],this.afterDeleteForm,serverDatabaseActions.exceptionHandler,this)}else{serverDatabaseActions.runAction(FormDataService.deleteSubForm,[this.parentFormPanel.subFormName,this.parentFormPanel.dataId,this.editForm.subFormName,j],this.afterDeleteForm,serverDatabaseActions.exceptionHandler,this)}}})}});var d=[];if(this.showNewButton){d.push(this.newButton)}if(this.showEditButton){d.push(this.editButton)}if(this.showDeleteButton){d.push(this.deleteButton)}if(this.orderField){this.acceptChanges=new Ext.Button({id:this.getId()+"-acceptChanges",text:this.aplicarReorden,iconCls:At4util.icons.order,scope:this,hidden:true,style:"margin: 0px 5px 0px 10px;",handler:function(){this.sendUpdatedFields()}});this.rejectChanges=new Ext.Button({id:this.getId()+"-rejectChanges",text:this.cancelarReorden,iconCls:At4util.icons.close,scope:this,hidden:true,style:"margin: 0px 5px 0px 10px;",handler:function(){this.cancelUpdatedFields()}});d.push(this.acceptChanges);d.push(this.rejectChanges)}if(this.extraButtons&&this.extraButtons.length>0){Ext.each(this.extraButtons,function(h){d.push(h)}.bind(this))}this.callParent([{deferredRender:false,tbar:{xtype:"toolbar",id:this.getId()+"-toolbar",hidden:false,items:d},listeners:{activate:{fn:function(h){h.isActiveTab=true;if(h.parentFormPanel.dataId&&h.deferredLoad&&!h.dataLoaded){h.parentFormPanel.loadSubpanelData(h.parentFormPanel.dataId,h.name);h.dataLoaded=true}}},deactivate:{fn:function(h){h.isActiveTab=false}}},items:[this.extraPanel,this.dataView]}])},updateRecordCallback:function(b,c){if(c.correcto){var f="";var a=b.length;for(var d=0;d<a;d++){b[d].commit()}if(a>0){if(a>1){f+=Ext.String.format(this.modificadosElementosText,a)}else{f+=this.modificadoElementoText}}this.statusBar.setStatus({text:f,clear:true})}else{var e=c.message;Ext.Msg.alert("Error:",e)}this.checkUpdatedFelds()},dataViewDefaultConfig:{bodyStyle:"padding: 0px 0px 0px 0px",width:"99%",autoHeight:true,autoScroll:true,layout:"fit",multiSelect:false,singleSelect:true,overItemCls:"x-view-over",selectedItemCls:"x-view-selected",},showNewButton:true,showEditButton:true,showDeleteButton:true,scrollable:"x",layout:"fit",width:"100%",nuevoTxt:"Nuevo",borrarTxt:"Borrar",editarTxt:"Editar",eliminadoTxt:"Eliminado 1 elemento",ejecutandoTxt:"Ejecutando...",espereTxt:"espere...",borrarRegistroTxt:"¿Borrar registro?",seguroTxt:"¿está seguro?<br/>Esta acción no se puede deshacer.",eliminadoTxt:"Eliminado 1 elemento",windowWidth:750,windowHeight:400,editable:false,deferredLoad:false,isActiveTab:false,tpl:null,itemSelector:"tr.filaListadoPanel",dataRecord:null,editForm:null,setValues:function(b){this.store.removeAll();var a=this.reader.readRecords({resultados:b,totalNumRecords:b.length});this.store.loadRecords(a.records)},getTotalCount:function(){return this.store.getCount()},disableRecordEdit:function(){this.editButton.disable();this.deleteButton.disable()},enableRecordEdit:function(){if(this.editable){this.editButton.enable();this.deleteButton.enable()}},closeForm:function(){this.formWindow.hide()},onNewRecordDone:function(b,a){var c=this.reader.readRecords({resultados:[a],totalNumRecords:1});this.store.loadRecords(c.records,{addRecords:true});this.updateParent();return c.records[0]},unload:function(){this.store.removeAll();this.dataLoaded=false},updateParent:function(){if(this.parentFormPanel.parentPanel!=null){var a=Ext.ux.util.clone(this.parentFormPanel.currentRecord.data);a[this.name]=[];for(var b=0;b<this.store.getCount();b++){a[this.name][b]=this.store.getAt(b).data}this.parentFormPanel.parentPanel.onUpdateRecordDone(this.parentFormPanel,a,this.parentFormPanel.currentRecord)}},afterDeleteForm:function(b){if(b.success){var a=this.dataView.getRecord(this.dataView.getSelectedNodes()[0]);this.store.remove(a);this.statusBar.setStatus({text:this.eliminadoTxt,clear:true});this.updateParent()}else{Ext.Msg.alert("Error:",b.message)}},onUpdateRecordDone:function(d,b,a){var e=this.reader.readRecords({resultados:[b],totalNumRecords:1});var c=this.store.indexOf(a);this.store.remove(a);this.store.insert(c,e.records);d.currentRecord=this.store.getAt(c);this.updateParent();return e.records[0]},setEditable:function(a){this.editable=a;this.newButton.setVisible(a&&this.addEnabled);this.editButton.setVisible(a);this.deleteButton.setVisible(a);if(this.editForm){this.editForm.setEditable(a)}},doNewRecord:function(){if(!this.addEnabled){return}this.formWindow.show();this.editForm.emptyForm()},doEditRecord:function(a){if(!this.editEnabled){return}this.formWindow.show();this.editForm.loadData(a)},checkUpdatedFelds:function(){console.log("Checking if records...");var a=this.store.getModifiedRecords().length>0;var c=this.acceptChanges;var b=this.rejectChanges;if(c&&b){if(a){c.show();b.show()}else{c.hide();b.hide()}}},sendUpdatedFields:function(){console.log("Records sent!");var b=this.editForm.application.formName;var e=this.editForm.application.dataId;var c=this.editForm.subFormName;var a=this.store.getModifiedRecords();var d=a;serverDatabaseActions.updateSubFormList(b,c,e,d,this.updateRecordCallback,this)},cancelUpdatedFields:function(){console.log("Records changes rejected.");this.store.rejectChanges();this.checkUpdatedFelds()},onRenderDragZoneFunction:function(a,b){if(this.orderField&&this.store.getModel().getField(this.orderField)){this.dragZone=new Ext.view.DragZone({view:a,ddGroup:"reorder",dragText:this.reorderTxt});this.dropZone=new Ext.view.DropZone({view:a,ddGroup:"reorder",handleNodeDrop:function(d,f,g){var k=this.view;var l=k.getStore();var j;var c;var e;var h;if(d.copy){c=d.records;d.records=[];for(e=0,h=c.length;e<h;e++){d.records.push(c[e].copy(c[e].getId()))}}else{d.view.store.remove(d.records,d.view===k)}j=l.indexOf(f);if(g!=="before"){j++}l.insert(j,d.records);k.getSelectionModel().select(d.records);k.fireEvent("recordsOrdered",k,d)}})}},onRecordsOrdered:function(b,e){var c=b.store.getData().items;for(i in c){if(c.hasOwnProperty(i)){var d=(parseInt(i)+1);var a=c[i];if(c[i].data[this.orderField]!=d){a.set(this.orderField,d)}}}this.checkUpdatedFelds()}});Ext.namespace("At4FrameworkIntranet");Ext.define("At4FrameworkIntranet.FilePanel",{extend:"Ext.form.FieldSet",width:320,xtype:"at4-filepanel",style:"margin-top: 20px",collapsible:false,disableUpload:false,disableDownlowd:false,disableDelete:false,mostrarDescargar:function(a){if(a&&!this.disableDownlowd){this.descarregarArxiu.setVisible(true)}else{this.descarregarArxiu.setVisible(false)}},mostrarEliminar:function(a){if(a&&!this.disableDelete){this.eliminarArxiu.setVisible(true)}else{this.eliminarArxiu.setVisible(false)}},mostrarEnviar:function(a){if(a&&!this.disableUpload){this.afegirArxiuBoto.uploadButton.setVisible(true)}else{this.afegirArxiuBoto.uploadButton.setVisible(false)}},constructor:function(c,b){Ext.apply(this,b);this.parentFormPanel=c;this.inSubForm=(!!c.subFormName);this.descarregarArxiu=new Ext.Button({style:"margin: 0 5px 0 5px",text:this.descargarArchivoTxt,hidden:true,disabled:this.disableDownlowd,tabIndex:this.tabIndex+20,handler:function(){var f=Ext.DomHelper.append(document.body,{tag:"form",method:"post",action:this.urlDescarga,target:this.id});var g=document.createElement("input");g.type="hidden";g.name="objectId";g.value=this.parentFormPanel.dataId;f.appendChild(g);var d=document.createElement("input");d.type="hidden";d.name="docname";d.value=this.docname;f.appendChild(d);if(this.isImage){var e=document.createElement("input");e.type="hidden";e.name="mode";e.value="inline";f.appendChild(e)}f.submit()},scope:this});this.eliminarArxiu=new Ext.Button({style:"margin: 0 5px 0 5px",text:this.eliminarArchivoTxt,hidden:true,disabled:this.disableDelete,tabIndex:this.tabIndex+30,handler:function(){Ext.Msg.show({title:this.eliminarArchivoInformacionTxt,msg:this.eliminarArchivoConfirmacionTxt,icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,scope:this,fn:function(d){if("yes"!==d){return}serverDatabaseActions.runAction(FormDataService.eliminarDocumento,[this.docname,this.parentFormPanel.dataId],function(e){if(e.correcto){if(this.isImage){this.imagePreview.setVisible(false)}else{Ext.MessageBox.alert(this.eliminarArchivoInformacionTxt,this.eliminarArchivoCorrectoTxt)}this.mostrarDescargar(false);this.mostrarEliminar(false);if(this.inSubForm){this.parentFormPanel.parentPanel.onUpdateRecordDone(this.parentFormPanel,e.updatedElement,this.parentFormPanel.currentRecord)}}else{Ext.Msg.show({title:this.eliminarArchivoErrorTxt,msg:e.message,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})}},serverDatabaseActions.exceptionHandler,this)}})},scope:this});this.afegirArxiuBoto=new Ext.enableDWRUploadFile({style:"padding: 0px 0px 7px 0px; margin: 0 5px 0 5px",name:"arxiu",buttonText:this.subirArchivoTxt,buttonIcon:"",tabIndex:this.tabIndex+10,check:function(){return true},submit:function(){var d=this.afegirArxiuBoto.getFileInput();console.log(d.value);serverDatabaseActions.runAction(FormDataService.guardarDocumento,[this.docname,d,this.parentFormPanel.dataId],function(e){if(e.correcto){this.mostrarDescargar(true);if(this.isImage){this.imagePreview.doPreview()}else{Ext.MessageBox.alert(this.subirArchivoInformacionTxt,this.subirArchivoCorrectoTxt)}this.mostrarEliminar(true);if(this.inSubForm){this.parentFormPanel.parentPanel.onUpdateRecordDone(this.parentFormPanel,e.updatedElement,this.parentFormPanel.currentRecord)}if(e.warnings.length>0){for(i in e.warnings){if(e.warnings.hasOwnProperty(i)){Ext.toast({html:e.warnings[i],header:false,autoCloseDelay:5000,align:"bl"})}}}}else{Ext.Msg.show({title:this.subirArchivoErrorTxt,msg:e.message,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})}},serverDatabaseActions.exceptionHandler,this)}.bind(this)});var a=[];this.dataConstrains=new Ext.Component({value:"",border:0,minHeight:0,editable:false,});if(this.isImage){this.imagePreview=new Ext.Img({style:"max-height: 99%; max-width:99%; border:1px solid black; margin-bottom: 5px",doPreview:function(){var d=this.urlDescarga;d+="?objectId="+this.parentFormPanel.dataId;d+="&docname="+this.docname;d+="&mode=inline";d+="&random="+Math.random();this.imagePreview.setSrc(d);this.imagePreview.setVisible(true)}.bind(this),listeners:{load:{element:"el",scope:this,fn:function(){if(this.imagePreview.src){this.parentFormPanel.doLayout()}}}}});a.push({xtype:"container",style:"text-align: center",items:[this.imagePreview]})}this.infoConstrains=new Ext.Button({name:this.fieldName,text:this.comprobarConstrainsTxt,buttonIcon:"",parentFormPanel:c,constrainsModel:this.constrainsModel,tabIndex:this.tabIndex+40,disabled:false,hidden:!!this.disableConstrains,scope:this,handler:this.onInfoConstrainsClick,});a=a.concat([{xtype:"container",layout:"hbox",margin:"5px 0 5px 0",width:"100%",defaults:{width:"33%"},items:[this.afegirArxiuBoto.uploadButton,this.descarregarArxiu,this.eliminarArxiu]},{xtype:"container",margin:"10px 0 10px 0",items:[this.infoConstrains]},{xtype:"container",minHeight:0,height:"auto",items:[this.dataConstrains]}]);this.callParent([{xtype:"fieldset",style:"margin-top: 0 ;",padding:15,title:this.titleTxt,border:true,labelAlign:"top",autoHeight:true,hidden:true,items:a}]);b.listeners={afterload:Ext.bind(this.afterLoadRecord,this),afteremptyform:Ext.bind(this.afteremptyform,this)};this.mostrarDescargar(true);this.mostrarEliminar(true);this.mostrarEnviar(true)},docname:null,titleTxt:"Archivo",descargarArchivoTxt:"Descargar",eliminarArchivoTxt:"Eliminar",eliminarArchivoInformacionTxt:"Información",eliminarArchivoConfirmacionTxt:"¿Eliminar archivo?<br/>Esta acción no se puede deshacer.",eliminarArchivoCorrectoTxt:"Archivo eliminado correctamente.",eliminarArchivoErrorTxt:"Error eliminando archivo.",subirArchivoTxt:"Añadir",subirArchivoInformacionTxt:"Información",subirArchivoCorrectoTxt:"Archivo añadido correctamente",subirArchivoErrorTxt:"Error añadiendo archivo",urlDescarga:"./export/descarregar",fieldName:null,isImage:false,afterEmptyForm:function(a){this.setVisible(false);this.mostrarDescargar(false);this.mostrarEliminar(false)},afterLoadRecord:function(b,a){var c=false;var d=false;if(this.inSubForm){b=a.data.oid;c=this.parentFormPanel.editable;d=this.parentFormPanel.editable}else{c=a.canUpdate;d=a.canUpdate}var e=false;if(a.data[this.fieldName]!=null&&a.data[this.fieldName]!=""){if(c){this.mostrarEliminar(true)}else{this.mostrarEliminar(false)}if(d){this.mostrarEnviar(true)}else{this.mostrarEnviar(false)}this.descarregarArxiu.setVisible(true);if(this.canDownload){this.descarregarArxiu.enable()}if(this.isImage){this.imagePreview.doPreview()}e=true}else{this.descarregarArxiu.setVisible(false);this.mostrarEliminar(false);if(this.isImage){this.imagePreview.setVisible(false)}if(d){this.mostrarEnviar(true);e=true}else{this.mostrarEnviar(false)}}if(b&&e){this.setVisible(true)}},createTitleCmp:function(){var b=this,a={xtype:"component",html:b.title,ui:b.ui,cls:b.baseCls+"-header-text",id:b.id+"-legendTitle"};if(b.collapsible&&b.toggleOnTitleClick){a.listeners={click:{element:"el",scope:b,fn:b.toggle}};a.cls+=" "+b.baseCls+"-header-text-collapsible"}if(!a.listeners){a.listeners={}}if(b.qtip){a.listeners.afterrender={scope:b,fn:function(c,d){c.getEl().set({"data-qtip":this.qtip})}}}return(b.titleCmp=Ext.widget(a))},initEvents:function(){At4FrameworkIntranet.FilePanel.superclass.initEvents.call(this);this.parentFormPanel.addListener("afterload",this.afterLoadRecord.bind(this));this.parentFormPanel.addListener("afteremptyform",this.afterEmptyForm.bind(this))},showConstrainMessage:function(b,c){var a="";if(c){a=b}else{if(this.isImage){a=At4util.formatConstrains(b)}else{a=At4util.formatFileConstrains(b)}}this.dataConstrains.update(a)},onInfoConstrainsClick:function(a,e){var f=a.parentFormPanel.formName?a.parentFormPanel.formName:a.parentFormPanel.subFormName;var d;if(this.formItem){d=this.formItem}else{Ext.log.warn("No formItem set, using docname.");d=this.docname}var c=At4FrameworkIntranet.app.cache.constrains[d];if(c&&(new Date()-c.date<7200000)){this.showConstrainMessage(c.data)}else{this.showConstrainMessage(this.cargandoConstrainsTxt,true);var b=this.isImage?"obtenerConstraints":"obtenerFileConstraints";serverDatabaseActions.runSilentAction(FormDataService[b],[d],function(g){var h={data:g,date:new Date()};At4FrameworkIntranet.app.cache.constrains[this.formItem]=h;this.scope.showConstrainMessage(h.data)}.bind({formItem:d,scope:this}),function(){this.scope.showConstrainMessage(this.scope.errorConstrainsTxt,true)}.bind({formItem:d,scope:this}))}}});Ext.namespace("At4FrameworkIntranet");Ext.define("At4FrameworkIntranet.ImagePreviewPanel",{extend:"At4FrameworkIntranet.BasicPanel",cls:"at4imagePanel",itemSelector:"div.thumb-wrap",constructor:function(b,a){this.isFotoGrande=true;this.aumentaTamano={xtype:"button",text:"Cambiar tamaño",handler:this.toggleSize,scope:this};this.extraButtons=[this.aumentaTamano];this.callParent(arguments)},toggleSize:function(){if(!this.isFotoGrande){this.setSize(true);this.isFotoGrande=true}else{this.setSize(false);this.isFotoGrande=false}},setSize:function(a){if(this.el){if(a){this.el.select(".fotoPanel").addCls("grande")}else{this.el.select(".fotoPanel").removeCls("grande")}this.doLayout()}},onRenderDragZoneFunction:function(b,d){this.setSize(this.isFotoGrande);if(this.orderField&&this.store.getModel().getField(this.orderField)){var f=b.getEl().query(".thumb-wrap");var a=b.getEl().query(".drop-before");var g=b.getEl().query(".drop-after");var c={view:b,};var e={startDrag:function(j){Ext.each(f,function(k){if(this.el==k){return}Ext.fly(k).addCls("noEventsPls")});var h=this.el.getXY();this.initialPosition=h},onDrag:function(h){this.el.setXY([h.getX()-32,h.getY()-32])},onDragEnter:function(j,l){var k=l.split("Foto");var h={idElemento:this.id.split("foto")[1],targetPos:k[0],targetId:k[1]};if(h.idElemento!=h.targetId){Ext.fly(l).addCls("valid-zone")}},onDragOver:function(h,j){},onDragOut:function(h,j){Ext.fly(j).removeCls("valid-zone")},onDragDrop:function(j,l){Ext.each(f,function(m){Ext.fly(m).removeCls("noEventsPls")});var k=l.split("Foto");var h={idElemento:this.id.split(j.target.dataset.nombre)[1],targetPos:k[0],targetId:k[1]};if(h.idElemento==h.targetId){return this.onInvalidDrop()}b.fireEvent("recordsOrdered",b,h)},onInvalidDrop:function(){this.el.setXY(this.initialPosition);Ext.each(f,function(h){Ext.fly(h).removeCls("noEventsPls")})},endDrag:function(h,j){}};Ext.each(f,function(j){var h=Ext.create("Ext.dd.DD",j,"fotoDDGroup",{isTarget:false});Ext.apply(h,e)});Ext.each(a,function(k){var h=k.getAttribute("id");var j=Ext.create("Ext.dd.DDTarget",h,"fotoDDGroup",{ignoreSelf:false})});Ext.each(g,function(k){var h=k.getAttribute("id");var j=Ext.create("Ext.dd.DDTarget",h,"fotoDDGroup",{ignoreSelf:false})})}},onRecordsOrdered:function(h,e){var k=h.getStore();var g=k.getData().items;var a=k.getById(e.idElemento);var c=g.indexOf(a);var f=k.getById(e.targetId);k.beginUpdate();k.remove(a);var b=g.indexOf(f);var b=e.targetPos=="before"?b:b+1;k.insert(b,a);var j=0;var d=this.orderField;k.each(function(l){j++;l.set(d,j)});k.endUpdate();k.loadData(k.getData().items);this.isBussy=true;this.onRenderDragZoneFunction(h);this.sendUpdatedFields()},sendUpdatedFields:function(){var b=this.editForm.application.formName;var e=this.editForm.application.dataId;var c=this.editForm.subFormName;var a=this.store.getData().items;var d=this.dataView.getEl().query(".thumb-wrap");Ext.each(d,function(f){Ext.fly(f).addCls("noEventsPls")});serverDatabaseActions.updateSubFormList(b,c,e,a,this.updateRecordCallback,this)},updateRecordCallback:function(){this.callParent(arguments);this.isBussy=false;this.onRenderDragZoneFunction(this.dataView)},cancelUpdatedFields:function(){var a=this.dataView.store;a.rejectChanges();this.checkUpdatedFelds();a.loadData(a.getData().items);this.onRenderDragZoneFunction(this.dataView)},dataViewDefaultConfig:{bodyStyle:"padding: 0px 0px 0px 0px",autoHeight:true,autoScroll:false,layout:"fit",multiSelect:false,singleSelect:true,overItemCls:"x-view-over",selectedItemCls:"x-view-selected",},onUpdateRecordDone:function(d,c,a){if(!c){return}var b=this.dataView.getStore();b.remove(b.findRecord("id",a.id));return this.onNewRecordDone(d,c)},onNewRecordDone:function(d,c){var b=this.dataView.getStore();var e=this.reader.readRecords({resultados:[c],totalNumRecords:1});var a=e.records[0];b.add(a);b.loadData(b.getData().items);this.onRenderDragZoneFunction(this.dataView);return a},afterDeleteForm:function(c){var b=this.dataView.getStore();if(c.success){var a=this.dataView.getRecord(this.dataView.getSelectedNodes()[0]);b.remove(a);this.statusBar.setStatus({text:this.eliminadoTxt,clear:true});b.loadData(b.getData().items);this.onRenderDragZoneFunction(this.dataView)}else{Ext.Msg.alert("Error:",c.message)}},setValues:function(){this.callParent(arguments);this.onRenderDragZoneFunction(this.dataView)},autoScroll:false,});Ext.namespace("At4FrameworkIntranet");Ext.define("At4FrameworkIntranet.RelationPopupPanel",{extend:"Ext.form.FieldSet",constructor:function(d,c,a){console.log("Se esta llamando al constructor de RelationPopupPanel");Ext.apply(this,a);this.parentFormPanel=d;this.combo=c;if(d.subFormName){this.inSubForm=true}else{this.inSubForm=false}this.getApplication=function(){var e=this.parentFormPanel;while(e.subFormName){e=e.parentPanel}return e.application};this.viewRelated=new Ext.Button({text:">",tooltip:"Pulse para ver el registro",hidden:true,handler:function(e,f){if(this.combo.getValue()){this.parentFormPanel.application.openRecordForm({form:this.relatedFormName},{oid:this.combo.getValue()})}},style:"margin-top:18px",scope:this});var b=null;if(a.width>0){this.combo.setWidth(a.width-30);b=a.width}else{if((this.combo.width+0)>0){b=this.combo.width+30}}this.callParent(this,{xtype:"fieldset",layout:"column",border:false,labelAlign:"top",autoHeight:true,hidden:false,collapsible:false,style:"margin-bottom: 0px;padding: 0px;",width:b,defaults:{msgTarget:"under",validationEvent:true,border:false,labelAlign:"top",autoHeight:true,autoWidth:true,collapsible:false},items:[{xtype:"fieldset",items:[this.combo]},{items:[this.viewRelated]}]})},relatedFormName:null,verTxt:"ver",onChange:function(){if(this.combo.getValue()){this.viewRelated.setVisible(true)}else{this.viewRelated.setVisible(false)}},initEvents:function(){At4FrameworkIntranet.RelationPopupPanel.superclass.initEvents.call(this);var a=true;if(this.inSubForm){var b=this.parentFormPanel;while(b.subFormName){b=b.parentPanel;if(b.formName&&b.formName==this.relatedFormName){a=false}}}if(a){this.combo.addListener("change",this.onChange.createDelegate(this));this.parentFormPanel.addListener("afterload",this.onChange.createDelegate(this))}}});Ext.namespace("Ext.form.Action");Ext.define("Ext.form.Action.DWRLoad",{extend:"Ext.form.Action",type:"load",waitMsg:"cargando...",setValuesFunction:null,run:function(){var d=[];var c=this.dwrArgs||[];if(c instanceof Array){for(var b=0;b<c.length;b++){d.push(c[b])}}else{for(var a in c){d.push(c[a])}}d.push({callback:Ext.bind(this.dwrsuccess,this,this.createCallback(),1),exceptionHandler:Ext.bind(this.dwrfailure,this,this.createCallback(),1)});this.dwrFunction.apply(Object,d)},dwrfailure:function(a,b){if(b.failureType===Ext.form.action.Action.CONNECT_FAILURE){Ext.Msg.alert("Error","Status:"+b.response.status+": "+b.response.statusText);return}if(b.failureType===Ext.form.action.Action.SERVER_INVALID){Ext.Msg.alert("Invalid",b.result.errormsg);return}if(b.javaClassName&&b.message){Ext.Msg.alert("Error genérico",b.message);return}},dwrsuccess:function(b){var a=this.handleResponse(b);if(a===true||!a.success||!a.data){this.failureType=Ext.form.Action.LOAD_FAILURE;this.form.form.afterAction(this,false);return}this.form.form.clearInvalid();if(this.setValuesFunction){this.setValuesFunction(a.data)}else{this.form.form.setValues(a.data)}this.form.form.afterAction(this,true)},handleResponse:function(b){if(this.form.reader){var a=this.form.reader.readRecords([b]);var c=a.records&&a.records[0]?a.records[0].data:null;this.result={success:a.success,data:c};return this.result}this.result=b;return this.result},constructor:function(b,a){this.setValuesFunction=a.setValuesFunction;this.form=b;this.callParent([a])}});Ext.form.action.Action.dwrload=Ext.form.Action.DWRLoad;Ext.define("Ext.ux.DwrProxy",{requires:["Ext.util.MixedCollection","Ext.data.Request"],extend:"Ext.data.proxy.Direct",alias:"proxy.dwr",alternateClassName:["Ext.data.dwrProxy"],passDwrStoreParams:false,appendId:true,timeout:undefined,loadArgsKey:"dwrFunctionArgs",constructor:function(a){var b=this;a=a||{};b.callParent([a]);b.extraParams=a.extraParams||{}},create:function(){return this.doRequest.apply(this,arguments)},read:function(b){var d=this;var g=b.config;if(d.fireEvent("beforeload",d,g,this.dwrParams)!==false){var f=g[this.loadArgsKey];var e=[];if(f instanceof Array){for(var c=0;c<f.length;c++){e.push(f[c])}}else{for(var a in f){e.push(f[a])}}this.dwrParams=e;return this.doRequest.apply(this,arguments)}else{callback.call(scope||this,null,arg,false)}},update:function(){return this.doRequest.apply(this,arguments)},destroy:function(){return this.doRequest.apply(this,arguments)},doRequest:function(a,f,b){var c=this;var e=this.getWriter();request=this.buildRequest(a,f,b);if(a.allowWrite()){request=e.write(request)}var d=[];if(typeof(c.dwrParams)==="object"){d=d.concat(c.dwrParams)}d.push({callback:function(g){c.processResponse(true,a,request,g,f,b)},scope:b,timeout:this.timeout,errorHandler:function(h,g){if(!h){h=JSON.stringify(g)}if(console!=undefined){console.log(h)}else{if(windows!=undefined){if(windows.console!=undefined){windows.console.log(h)}}}c.processResponse(false,a,request,h,f,b)}});if(Ext.isFunction(c.dwrFunction)){c.dwrFunction.apply(null,d)}else{switch(a.action){case"read":c.dwrFunction.read.apply(null,d);break;case"create":c.dwrFunction.create.apply(null,d);break;case"update":c.dwrFunction.create.apply(null,d);break;case"destroy":c.dwrFunction["delete"].apply(null,d);break;default:c.processResponse(false,a,request,'operation "'+a.action+'" not available',f,b)}}return request},processResponse:function(h,c,g,b){var f=this,d,a,e;f.fireEvent("beginprocessresponse",f,b,c);if(h===true){a=f.getReader();if(b.status===204){e=a.getNullResultSet()}else{e=a.readRecords(b)}c.process(e,g,b);d=!c.wasSuccessful()}else{f.setException(c,b);d=true}if(d){f.fireEvent("exception",f,b,c)}f.afterRequest(g,h);f.fireEvent("endprocessresponse",f,b,c)},buildRequest:function(a){var c=Ext.applyIf(a.params||{},this.extraParams||{}),b;c=Ext.applyIf(c,this.getParams(a));if(a.id&&!c.id){c.id=a.id}b=Ext.create("Ext.data.Request",{params:c,records:a.records,operation:a});a.request=b;return b},getParams:function(b){var d=this,g={},a=Ext.isDefined,e=b.groupers,f=b.sorters,c=b.filters;Ext.apply(g,{page:b.page,start:b.start,limit:b.limit});if(e&&e.length>0){Ext.apply(g,{groupers:d.encodeSorters(e)})}if(f&&f.length>0){Ext.apply(g,{sorters:d.encodeSorters(f)})}if(c&&c.length>0){Ext.apply(g,{filters:d.encodeFilters(c)})}return g},encodeSorters:function(d){var b=[],c=d.length,a=0;for(;a<c;a++){b[a]={property:d[a].getProperty(),direction:d[a].direction()}}return this.applyEncoding(b)},applyEncoding:function(a){return a},encodeFilters:function(d){var b=[],c=d.length,a=0;for(;a<c;a++){b[a]={property:d[a].property?d[a].property:d[a].getProperty(),value:d[a].value?d[a].value:d[a].getValue()}}return this.applyEncoding(b)},setException:function(c,b){var a=(b!=null?b.status:"Error");var d=(b!=null?b.statusText:"No se ha obtenido respuesta del servidor");c.setException({status:a,statusText:d})},afterRequest:Ext.emptyFn,listeners:{exception:function(c,b,a){Ext.Msg.alert("Error",b)}}},function(){});Ext.namespace("Ext.form.Action");Ext.define("Ext.form.Action.DWRSubmit",{extend:"Ext.form.Action",type:"submit",constructor:function(b,a){this.form=b.getForm();this.callParent([a])},run:function(){var e=this;if(e.clientValidation===false||this.form.isValid()){var d=[];var c=e.dwrArgs||[];if(c instanceof Array){for(var b=0;b<c.length;b++){d.push(c[b])}}else{for(var a in c){d.push(c[a])}}d.push(this.getValues());d.push({callback:Ext.bind(this.dwrsuccess,this,this.createCallback(),1),exceptionHandler:Ext.bind(this.dwrexceptionHandler,this,this.createCallback(),1)});e.dwrFunction.apply(Object,d)}else{if(e.clientValidation!==false){this.failureType=Ext.form.Action.CLIENT_INVALID;this.form.afterAction(this,false)}}},dwrsuccess:function(b){var a=this.dwrhandleResponse(b);if(a===true||a.success){this.form.afterAction(this,true);return}if(a.errors){this.form.markInvalid(a.errors);this.failureType=Ext.form.Action.SERVER_INVALID}this.form.afterAction(this,false)},dwrhandleResponse:function(c){if(this.form.errorReader){var b=this.form.errorReader.read([c]);var f=[];if(b.records){for(var d=0,a=b.records.length;d<a;d++){var e=b.records[d];f[d]=e.data}}if(f.length<1){f=null}this.result={success:b.success,errors:f};return this.result}this.result=c;return this.result},getValues:function(){var a=this.form.getValues();var c,d;var b={};for(d in a){if(typeof a[d]!="function"&&(c=this.form.findField(d))){if(c.xtype=="At4Framework-combobox"){b[d]=c.getValue()}else{b[d]=a[d]}}}return b},dwrexceptionHandler:function(b,a){serverDatabaseActions.exceptionHandler(b,a)}});Ext.form.action.Action.dwrsubmit=Ext.form.Action.DWRSubmit;serverDatabaseActions=new function ServerDatabaseActions(){this.ejecutandoTxt="Ejecutando...";this.espereTxt="espere...";this.createRelationPopupProxy=function(f,c,a,b){if(!a){a={type:"json",totalProperty:"totalNumRecords",rootProperty:"resultados",model:c}}var d=b||FormDataService.getRelationPopupData;var e={type:"dwr",dwrFunction:d,listeners:{beforeload:function(h,g){var j=g.params?g.params:[];g[h.loadArgsKey]=[f,j.query?(typeof(j.query)!="function"?j.query:null):null,g.filters?(typeof(g.filters)!="function"?h.encodeFilters(g.filters):null):null]},loadexception:function(j,k,g,h){Ext.Msg.alert("Error:",k)}},reader:a};return e};this.exceptionHandler=function(c,b){var a=c;if(!a){a=b.javaClassName}Ext.Msg.alert("Error:",a)},this.genericFormFailureHandler=function(a,b){if(b.failureType===Ext.form.Action.CONNECT_FAILURE){Ext.Msg.alert("Error",b.response.statusText?b.response.statusText:b.response)}else{if(b.failureType===Ext.form.Action.SERVER_INVALID){if(b.result.errormsg){Ext.Msg.alert("Invalid",b.result.errormsg)}else{if(b.result.message){Ext.Msg.alert("Invalid",b.result.message)}else{Ext.Msg.alert("Invalid",b.result)}}}else{Ext.Msg.alert("Invalid","Error no reconocido")}}},this.createListadoProxy=function(b,c,a){return Ext.create("Ext.ux.DwrProxy",{dwrFunction:FormDataService.getListado,dwrParams:[b],listeners:{beforeload:function(d,e){filters=e.filter;if(c){filters=c.concat(filters)}e[d.loadArgsKey]=[b,filters,{start:e.start?e.start:0,limit:e.limit?e.limit:30,sort:e.sort,direction:e.dir,groupBy:e.groupBy?e.groupBy:null}]},loadexception:function(f,g,d,e){Ext.Msg.alert("Error:",g)},load:function(h,e,d){if(e.aggregates){var g,j="";for(var f=0;f<this.colModel.getColumnCount();f++){g=this.gridMetaData.columns[f].dataIndex;if(e.aggregates[g]){j+=" "+this.gridMetaData.columns[f].header+": "+this.gridMetaData.columns[f].renderer(e.aggregates[g])}}Ext.fly(this.displaySummaryItem.getEl()).update(j)}}.bind(a)}})};this.updateRecord=function(b,e,d,a,c){FormDataService.updateForm(b,e,d,{callback:function(f){a.call(c,f)}})};this.clone=function(d){if(!d||"object"!==typeof d){return d}var e="[object Array]"===Object.prototype.toString.call(d)?[]:{};var b,a;for(b in d){if(d.hasOwnProperty(b)){a=d[b];if(a&&"object"===typeof a){if(a.clone&&typeof a.clone=="function"){e[b]=a.clone()}else{e[b]=this.clone(a)}}else{e[b]=a}}}return e};this.updateGrid=function(e,c,g,n,b){var f=new Array();var d;for(var l=0;l<g.length;l++){d=Ext.clone(g[l].data);for(var k in d){if(d[k]){if((typeof(d[k])==="date")?true:(typeof(d[k])==="object")?d[k].constructor.toString().match(/date/i)!==null:false){var p=/hora/;if(k.match(p)){d[k]=Ext.Date.format(d[k],"H:i")}else{d[k]=Ext.Date.format(d[k],"d-m-Y")}}else{if(typeof(d[k])=="object"&&d[k].asString){d[k]=d[k].asString}else{if(d[k] instanceof Array){var a="";var m=0;for(var h in d[k]){var o=d[k][h];if(!d[k].hasOwnProperty(h)){continue}if(m>0){a+=","}m++;a+=o.primaryKey}d[k]=a}}}}}f.push(d)}FormDataService.updateGrid(e,c,f,{callback:function(j){n.call(b,g,j)}})};this.updateSubFormList=function(m,l,k,d,h,a){var c=new Array();var g=new Array();var b;for(var f=0;f<d.length;f++){b=Ext.clone(d[f].data);for(var e in b){if(b[e]){if((typeof(b[e])==="date")?true:(typeof(b[e])==="object")?b[e].constructor.toString().match(/date/i)!==null:false){b[e]=Ext.Date.format(b[e],"d-m-Y")}else{if(typeof(b[e])=="object"&&b[e].asString){b[e]=b[e].asString}}}}g.push(b.oid);c.push(b)}FormDataService.updateSubFormList(m,l,k,g,c,{callback:function(j){h.call(a,d,j)}})};this.deleteForm=function(b,d,a,c){FormDataService.deleteForm(b,d,{callback:function(e){a.call(c,d,e)}})};this.runAction=function(f,a,g,b,d){Ext.MessageBox.wait(this.ejecutandoTxt,this.espereTxt);var e=[];for(var c=0;c<a.length;c++){e.push(a[c])}e.push({callback:function(h){Ext.MessageBox.updateProgress(1);Ext.MessageBox.hide();g.call(d,h)},exceptionHandler:function(j,h){Ext.MessageBox.updateProgress(1);Ext.MessageBox.hide();b.call(d,j,h)}});f.apply(Object,e)};this.runSilentAction=function(f,a,g,b,d){var e=[];for(var c=0;c<a.length;c++){e.push(a[c])}e.push({callback:function(h){g.call(d,h)},exceptionHandler:function(j,h){b.call(d,j,h)}});f.apply(Object,e)};this.actualizarPosicion=function(b,e,d,a,c){FormDataService.actualizarPosicion(b,e,d,{callback:function(f){a.call(c,f)}})};this.getExpedientPerCodiCorreos=function(c,a,b){FormDataService.getExpedientPerCodiCorreos(c,{callback:function(d){a.call(b,d)}})};this.deleteAuditedValues=function(a,b){FormDataService.deleteAuditedValues({callback:function(c){a.call(b,c)}})};this.generateInspection=function(b,e,c,a,d){FormDataService.generateInspection(b,e,c,{callback:function(f){a.call(d,f)}})}};serverGui=new function ServerGui(){this.getToolBarElements=function(a,b){GuiService.getToolBarElements({callback:function(c){a.call(b,c)}})};this.getListMetadata=function(b,a,d,e){var c={id:b.id,text:b.text,href:b.href,form:b.form,mode:b.mode,iconCls:b.iconCls,parameters:b.parameters};FormDataService.getListMetadata(c,{callback:function(f){a.call(d,c,f,e)}})}};
Ext.define("Ext.ux.statusbar.StatusBar",{extend:"Ext.toolbar.Toolbar",alternateClassName:"Ext.ux.StatusBar",alias:"widget.statusbar",requires:["Ext.toolbar.TextItem"],cls:"x-statusbar",busyIconCls:"x-status-busy",busyText:"Loading...",autoClear:5000,emptyText:"&#160;",activeThreadId:0,initComponent:function(){var a=this.statusAlign==="right";this.callParent(arguments);this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=Ext.create("Ext.toolbar.TextItem",{cls:"x-status-text "+(this.currIconCls||""),text:this.text||this.defaultText||""});if(a){this.cls+=" x-status-right";this.add("->");this.add(this.statusEl)}else{this.insert(0,this.statusEl);this.insert(1,"->")}},setStatus:function(e){var a=this;e=e||{};Ext.suspendLayouts();if(Ext.isString(e)){e={text:e}}if(e.text!==undefined){a.setText(e.text)}if(e.iconCls!==undefined){a.setIcon(e.iconCls)}if(e.clear){var f=e.clear,d=a.autoClear,b={useDefaults:true,anim:true};if(Ext.isObject(f)){f=Ext.applyIf(f,b);if(f.wait){d=f.wait}}else{if(Ext.isNumber(f)){d=f;f=b}else{if(Ext.isBoolean(f)){f=b}}}f.threadId=this.activeThreadId;Ext.defer(a.clearStatus,d,a,[f])}Ext.resumeLayouts(true);return a},clearStatus:function(e){e=e||{};var c=this,b=c.statusEl;if(e.threadId&&e.threadId!==c.activeThreadId){return c}var d=e.useDefaults?c.defaultText:c.emptyText,a=e.useDefaults?(c.defaultIconCls?c.defaultIconCls:""):"";if(e.anim){b.el.puff({remove:false,useDisplay:true,callback:function(){b.el.show();c.setStatus({text:d,iconCls:a})}})}else{c.setStatus({text:d,iconCls:a})}return c},setText:function(b){var a=this;a.activeThreadId++;a.text=b||"";if(a.rendered){a.statusEl.setText(a.text)}return a},getText:function(){return this.text},setIcon:function(a){var b=this;b.activeThreadId++;a=a||"";if(b.rendered){if(b.currIconCls){b.statusEl.removeCls(b.currIconCls);b.currIconCls=null}if(a.length>0){b.statusEl.addCls(a);b.currIconCls=a}}else{b.currIconCls=a}return b},showBusy:function(a){if(Ext.isString(a)){a={text:a}}a=Ext.applyIf(a||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(a)}});Ext.define("Ext.ux.form.MultiSelect",{extend:"Ext.form.FieldContainer",mixins:["Ext.util.StoreHolder","Ext.form.field.Field"],alternateClassName:"Ext.ux.Multiselect",alias:["widget.multiselectfield","widget.multiselect"],requires:["Ext.panel.Panel","Ext.view.BoundList","Ext.layout.container.Fit"],uses:["Ext.view.DragZone","Ext.view.DropZone"],layout:"anchor",ddReorder:false,appendOnly:false,displayField:"text",allowBlank:true,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:"This field is required",minSelectionsText:"Minimum {0} item(s) required",maxSelectionsText:"Maximum {0} item(s) required",delimiter:",",dragText:"{0} Item{1}",ignoreSelectChange:0,initComponent:function(){var a=this;a.items=a.setupItems();a.bindStore(a.store,true);if(a.store.autoCreated){a.valueField=a.displayField="field1";if(!a.store.expanded){a.displayField="field2"}}if(!Ext.isDefined(a.valueField)){a.valueField=a.displayField}a.callParent();a.initField()},setupItems:function(){var a=this;a.boundList=Ext.create("Ext.view.BoundList",Ext.apply({anchor:"none 100%",border:1,multiSelect:true,store:a.store,displayField:a.displayField,disabled:a.disabled},a.listConfig));a.boundList.getSelectionModel().on("selectionchange",a.onSelectChange,a);a.boundList.pickerField=a;if(!a.title){return a.boundList}a.boundList.border=false;return{border:true,anchor:"none 100%",layout:"anchor",title:a.title,tbar:a.tbar,items:a.boundList}},onSelectChange:function(a,b){if(!this.ignoreSelectChange){this.setValue(b)}},getSelected:function(){return this.boundList.getSelectionModel().getSelection()},isEqual:function(e,d){var b=Ext.Array.from,c=0,a;e=b(e);d=b(d);a=e.length;if(a!==d.length){return false}for(;c<a;c++){if(d[c]!==e[c]){return false}}return true},afterRender:function(){var b=this,a;b.callParent();if(b.disableDD){return}if(b.selectOnRender){a=b.getRecordsForValue(b.value);if(a.length){++b.ignoreSelectChange;b.boundList.getSelectionModel().select(a);--b.ignoreSelectChange}delete b.toSelect}if(b.ddReorder&&!b.dragGroup&&!b.dropGroup){b.dragGroup=b.dropGroup="MultiselectDD-"+Ext.id()}if(b.draggable||b.dragGroup){b.dragZone=Ext.create("Ext.view.DragZone",{view:b.boundList,ddGroup:b.dragGroup,dragText:b.dragText})}if(b.droppable||b.dropGroup){b.dropZone=Ext.create("Ext.view.DropZone",{view:b.boundList,ddGroup:b.dropGroup,handleNodeDrop:function(i,h,c){var d=this.view,f=d.getStore(),e=i.records,g;i.view.store.remove(e);g=f.indexOf(h);if(c==="after"){g++}f.insert(g,e);d.getSelectionModel().select(e);b.fireEvent("drop",b,e)}})}},isValid:function(){var b=this,a=b.disabled,c=b.forceValidation||!a;return c?b.validateValue(b.value):a},validateValue:function(b){var a=this,d=a.getErrors(b),c=Ext.isEmpty(d);if(!a.preventMark){if(c){a.clearInvalid()}else{a.markInvalid(d)}}return c},markInvalid:function(c){var b=this,a=b.getActiveError();b.setActiveErrors(Ext.Array.from(c));if(a!==b.getActiveError()){b.updateLayout()}},clearInvalid:function(){var b=this,a=b.hasActiveError();b.unsetActiveError();if(a){b.updateLayout()}},getSubmitData:function(){var a=this,b=null,c;if(!a.disabled&&a.submitValue&&!a.isFileUpload()){c=a.getSubmitValue();if(c!==null){b={};b[a.getName()]=c}}return b},getSubmitValue:function(){var b=this,a=b.delimiter,c=b.getValue();return Ext.isString(a)?c.join(a):c},getValue:function(){return this.value||[]},getRecordsForValue:function(g){var f=this,a=[],h=f.store.getRange(),l=f.valueField,d=0,k=h.length,b,c,e;for(e=g.length;d<e;++d){for(c=0;c<k;++c){b=h[c];if(b.get(l)==g[d]){a.push(b)}}}return a},setupValue:function(g){var b=this.delimiter,d=this.valueField,e=0,c,a,f;if(Ext.isDefined(g)){if(b&&Ext.isString(g)){g=g.split(b)}else{if(!Ext.isArray(g)){g=[g]}}for(a=g.length;e<a;++e){f=g[e];if(f&&f.isModel){g[e]=f.get(d)}}c=Ext.Array.unique(g)}else{c=[]}return c},setValue:function(d){var c=this,b=c.boundList.getSelectionModel(),a=c.store;if(!a.getCount()){a.on({load:Ext.Function.bind(c.setValue,c,[d]),single:true});return}d=c.setupValue(d);c.mixins.field.setValue.call(c,d);if(c.rendered){++c.ignoreSelectChange;b.deselectAll();if(d.length){b.select(c.getRecordsForValue(d))}--c.ignoreSelectChange}else{c.selectOnRender=true}},clearValue:function(){this.setValue([])},onEnable:function(){var a=this.boundList;this.callParent();if(a){a.enable()}},onDisable:function(){var a=this.boundList;this.callParent();if(a){a.disable()}},getErrors:function(b){var a=this,c=Ext.String.format,e=[],d;b=Ext.Array.from(b||a.getValue());d=b.length;if(!a.allowBlank&&d<1){e.push(a.blankText)}if(d<a.minSelections){e.push(c(a.minSelectionsText,a.minSelections))}if(d>a.maxSelections){e.push(c(a.maxSelectionsText,a.maxSelections))}return e},onDestroy:function(){var a=this;a.bindStore(null);Ext.destroy(a.dragZone,a.dropZone);a.callParent()},onBindStore:function(a){var b=this.boundList;if(b){b.bindStore(a)}},setOwnerCmp:function(b,a){var c=this;c.parentMenu=b.isMenuItem?b:null;c.ownerCmp=b;c.registerWithOwnerCt();delete c.hierarchicallyHidden;if(c.inheritedState&&a){c.invalidateInheritedState()}if(c.reference){c.fixReference()}if(a){Ext.ComponentManager.markReferencesDirty()}}});if("function"!==typeof RegExp.escape){RegExp.escape=function(a){if("string"!==typeof a){return a}return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}}Ext.ns("Ext.ux.grid");Ext.define("Ext.ux.grid.RowActions",{extend:"Ext.util.Observable",actionEvent:"click",isColumn:true,autoWidth:true,dataIndex:"",header:"",menuDisabled:true,sortable:false,tplGroup:'<tpl for="actions"><div class="ux-grow-action-item<tpl if="\'right\'===align"> ux-action-right</tpl> {cls}" style="{style}" qtip="{qtip}">{text}</div></tpl>',tplRow:'<div class="ux-row-action"><tpl for="actions"><div class="ux-row-action-item {cls} <tpl if="text">ux-row-action-text</tpl>" style="{hide}{style}" qtip="{qtip}"><tpl if="text"><span qtip="{qtip}">{text}</span></tpl></div></tpl></div>',hideMode:"visiblity",widthIntercept:4,widthSlope:21,init:function(c){this.grid=c;if(!this.tpl){this.tpl=this.processActions(this.actions)}if(this.autoWidth){this.width=this.widthSlope*this.actions.length+this.widthIntercept;this.fixed=true}var b=c.getView();var a={scope:this};a[this.actionEvent]=this.onClick;c.afterRender=c.afterRender.createSequence(function(){b.mainBody.on(a)},this);if(!this.renderer){this.renderer=function(h,d,e,i,g,f){d.css+=(d.css?" ":"")+"ux-row-action-cell";return this.tpl.apply(this.getData(h,d,e,i,g,f))}.createDelegate(this)}if(b.groupTextTpl&&this.groupActions){b.interceptMouse=b.interceptMouse.createInterceptor(function(d){if(d.getTarget(".ux-grow-action-item")){return false}});b.groupTextTpl='<div class="ux-grow-action-text">'+b.groupTextTpl+"</div>"+this.processActions(this.groupActions,this.tplGroup).apply()}},getData:function(e,a,b,f,d,c){return b?(b.data||{}):{}},processActions:function(d,c){var a=[];Ext.each(d,function(e,f){if(e.iconCls&&"function"===typeof(e.callback||e.cb)){this.callbacks=this.callbacks||{};this.callbacks[e.iconCls]=e.callback||e.cb}var g={cls:e.iconIndex?"{"+e.iconIndex+"}":(e.iconCls?e.iconCls:""),qtip:e.qtipIndex?"{"+e.qtipIndex+"}":(e.tooltip||e.qtip?e.tooltip||e.qtip:""),text:e.textIndex?"{"+e.textIndex+"}":(e.text?e.text:""),hide:e.hideIndex?'<tpl if="'+e.hideIndex+'">'+("display"===this.hideMode?"display:none":"visibility:hidden")+";</tpl>":(e.hide?("display"===this.hideMode?"display:none":"visibility:hidden;"):""),align:e.align||"right",style:e.style?e.style:""};a.push(g)},this);var b=new Ext.XTemplate(c||this.tplRow);return new Ext.XTemplate(b.apply({actions:a}))},onClick:function(h,i){var j=this.grid.getView();var d=false;var n=h.getTarget(".x-grid3-row");var a=j.findCellIndex(i.parentNode.parentNode);var m=h.getTarget(".ux-row-action-item");if(m){d=m.className.replace(/ux-row-action-item /,"");if(d){d=d.replace(/ ux-row-action-text/,"");d=d.trim()}}if(false!==n&&false!==a&&false!==d){var g=this.grid.store.getAt(n.rowIndex);if(this.callbacks&&"function"===typeof this.callbacks[d]){this.callbacks[d](this.grid,g,d,n.rowIndex,a)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeaction",this.grid,g,d,n.rowIndex,a)){return}else{if(true!==this.eventsSuspended){this.fireEvent("action",this.grid,g,d,n.rowIndex,a)}}}m=h.getTarget(".ux-grow-action-item");if(m){var k=j.findGroup(i);var f=k?k.id.replace(/ext-gen[0-9]+-gp-/,""):null;var c;if(f){var b=Ext.util.Format.htmlEncode(f);var l=new RegExp(RegExp.escape(b));c=this.grid.store.queryBy(function(e){return e._groupId.match(l)});c=c?c.items:[]}d=m.className.replace(/ux-grow-action-item (ux-action-right )*/,"");if(this.callbacks&&"function"===typeof this.callbacks[d]){this.callbacks[d](this.grid,c,d,f)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforegroupaction",this.grid,c,d,f)){return false}this.fireEvent("groupaction",this.grid,c,d,f)}},constructor:function(a){Ext.apply(this,a);this.addEvents("beforeaction","action","beforegroupaction","groupaction");Ext.ux.grid.RowActions.superclass.constructor.call(this)}});Ext.define("Ext.ux.form.ItemSelector",{extend:"Ext.ux.form.MultiSelect",alias:["widget.itemselectorfield","widget.itemselector"],alternateClassName:["Ext.ux.ItemSelector"],requires:["Ext.button.Button","Ext.ux.form.MultiSelect"],hideNavIcons:false,buttons:["top","up","add","remove","down","bottom"],buttonsText:{top:"Move to Top",up:"Move Up",add:"Add to Selected",remove:"Remove from Selected",down:"Move Down",bottom:"Move to Bottom"},layout:{type:"hbox",align:"stretch"},initComponent:function(){var a=this;a.ddGroup=a.id+"-dd";a.callParent();a.bindStore(a.store)},createList:function(b){var a=this;return Ext.create("Ext.ux.form.MultiSelect",{submitValue:false,getSubmitData:function(){return null},getModelData:function(){return null},flex:1,dragGroup:a.ddGroup,dropGroup:a.ddGroup,title:b,disableDD:a.disableDD,store:{model:a.store.model,data:[]},displayField:a.displayField,valueField:a.valueField,ddReorder:a.ddReorder,disabled:a.disabled,listeners:{boundList:{scope:a,itemdblclick:a.onItemDblClick,drop:a.syncValue}}})},setupItems:function(){var a=this;a.fromField=a.createList(a.fromTitle);a.toField=a.createList(a.toTitle);return[a.fromField,{xtype:"container",margin:"0 4",layout:{type:"vbox",pack:"center"},items:a.createButtons()},a.toField]},createButtons:function(){var b=this,a=[];if(!b.hideNavIcons){Ext.Array.forEach(b.buttons,function(c){a.push({xtype:"button",tooltip:b.buttonsText[c],handler:b["on"+Ext.String.capitalize(c)+"BtnClick"],cls:Ext.baseCSSPrefix+"form-itemselector-btn",iconCls:Ext.baseCSSPrefix+"form-itemselector-"+c,navBtn:true,scope:b,margin:"4 0 0 0"})})}return a},getSelections:function(b){var a=b.getStore();return Ext.Array.sort(b.getSelectionModel().getSelection(),function(d,c){d=a.indexOf(d);c=a.indexOf(c);if(d<c){return -1}else{if(d>c){return 1}}return 0})},onTopBtnClick:function(){var c=this.toField.boundList,a=c.getStore(),b=this.getSelections(c);a.suspendEvents();a.remove(b,true);a.insert(0,b);a.resumeEvents();c.refresh();this.syncValue();c.getSelectionModel().select(b)},onBottomBtnClick:function(){var c=this.toField.boundList,a=c.getStore(),b=this.getSelections(c);a.suspendEvents();a.remove(b,true);a.add(b);a.resumeEvents();c.refresh();this.syncValue();c.getSelectionModel().select(b)},onUpBtnClick:function(){var f=this.toField.boundList,b=f.getStore(),e=this.getSelections(f),g,d=0,a=e.length,c=0;b.suspendEvents();for(;d<a;++d,c++){g=e[d];c=Math.max(c,b.indexOf(g)-1);b.remove(g,true);b.insert(c,g)}b.resumeEvents();f.refresh();this.syncValue();f.getSelectionModel().select(e)},onDownBtnClick:function(){var e=this.toField.boundList,a=e.getStore(),d=this.getSelections(e),f,c=d.length-1,b=a.getCount()-1;a.suspendEvents();for(;c>-1;--c,b--){f=d[c];b=Math.min(b,a.indexOf(f)+1);a.remove(f,true);a.insert(b,f)}a.resumeEvents();e.refresh();this.syncValue();e.getSelectionModel().select(d)},onAddBtnClick:function(){var b=this,a=b.getSelections(b.fromField.boundList);b.moveRec(true,a);b.toField.boundList.getSelectionModel().select(a)},onRemoveBtnClick:function(){var b=this,a=b.getSelections(b.toField.boundList);b.moveRec(false,a);b.fromField.boundList.getSelectionModel().select(a)},moveRec:function(f,e){var c=this,g=c.fromField,a=c.toField,b=f?g.store:a.store,d=f?a.store:g.store;b.suspendEvents();d.suspendEvents();b.remove(e);d.add(e);b.resumeEvents();d.resumeEvents();g.boundList.refresh();a.boundList.refresh();c.syncValue()},syncValue:function(){var a=this;a.mixins.field.setValue.call(a,a.setupValue(a.toField.store.getRange()))},onItemDblClick:function(a,b){this.moveRec(a===this.fromField.boundList,b)},setValue:function(f){var d=this,g=d.fromField,a=d.toField,b=g.store,e=a.store,c;if(!d.fromStorePopulated){d.fromField.store.on({load:Ext.Function.bind(d.setValue,d,[f]),single:true});return}f=d.setupValue(f);d.mixins.field.setValue.call(d,f);c=d.getRecordsForValue(f);b.suspendEvents();e.suspendEvents();b.removeAll();e.removeAll();d.populateFromStore(d.store);Ext.Array.forEach(c,function(h){if(b.indexOf(h)>-1){b.remove(h)}e.add(h)});b.resumeEvents();e.resumeEvents();Ext.suspendLayouts();g.boundList.refresh();a.boundList.refresh();Ext.resumeLayouts(true)},onBindStore:function(a,b){var c=this;if(c.fromField){c.fromField.store.removeAll();c.toField.store.removeAll();if(a.getCount()){c.populateFromStore(a)}else{c.store.on("load",c.populateFromStore,c)}}},populateFromStore:function(a){var b=this.fromField.store;this.fromStorePopulated=true;b.add(a.getRange());b.fireEvent("load",b)},onEnable:function(){var a=this;a.callParent();a.fromField.enable();a.toField.enable();Ext.Array.forEach(a.query("[navBtn]"),function(b){b.enable()})},onDisable:function(){var a=this;a.callParent();a.fromField.disable();a.toField.disable();Ext.Array.forEach(a.query("[navBtn]"),function(b){b.disable()})},onDestroy:function(){this.bindStore(null);this.callParent()}});Ext.ns("Ext.ux.state");Ext.define("Ext.ux.state.HttpProvider",{extend:"Ext.state.Provider",saveSuccessText:"Save Success",saveFailureText:"Save Failure",readSuccessText:"Read Success",readFailureText:"Read Failure",dataErrorText:"Data Error",constructor:function(a){this.callParent(arguments);Ext.apply(this,a,{delay:750,dirty:false,started:false,autoStart:true,autoRead:true,user:"user",id:1,session:"session",logFailure:false,logSuccess:false,queue:[],url:".",readUrl:undefined,saveUrl:undefined,method:"post",saveBaseParams:{},readBaseParams:{},paramNames:{id:"id",name:"name",value:"value",user:"user",session:"session",data:"data"}});if(this.autoRead){this.readState()}this.dt=new Ext.util.DelayedTask(this.submitState,this);if(this.autoStart){this.start()}},initState:function(a){if(a instanceof Array){Ext.each(a,function(b){this.state[b.name]=this.decodeValue(b[this.paramNames.value])},this)}else{this.state=a?a:{}}},set:function(a,b){if(!a){return}this.queueChange(a,b)},start:function(){this.dt.delay(this.delay);this.started=true},stop:function(){this.dt.cancel();this.started=false},queueChange:function(a,d){var f=undefined===this.state[a]||this.state[a]!==d;var e={};var b;var c=false;if(f){e[this.paramNames.name]=a;e[this.paramNames.value]=this.encodeValue(d);for(b=0;b<this.queue.length;b++){if(this.queue[b].name===e.name){this.queue[b]=e;c=true}}if(false===c){this.queue.push(e)}this.dirty=true}if(this.started){this.start()}return f},submitState:function(){if(!this.dirty){this.dt.delay(this.delay);return}this.dt.cancel();var b={url:this.saveUrl||this.url,method:this.method,scope:this,success:this.onSaveSuccess,failure:this.onSaveFailure,queue:Ext.clone(this.queue),params:{}};var a=Ext.apply({},this.saveBaseParams);a[this.paramNames.id]=this.id;a[this.paramNames.user]=this.user;a[this.paramNames.session]=this.session;a[this.paramNames.data]=Ext.encode(b.queue);Ext.apply(b.params,a);this.dirty=false;Ext.Ajax.request(b)},clear:function(a){this.set(a,undefined)},onSaveSuccess:function(a,c){var h={};try{h=Ext.decode(a.responseText)}catch(g){if(true===this.logFailure){this.log(this.saveFailureText,g,a)}this.dirty=true;return}if(true!==h.success){if(true===this.logFailure){this.log(this.saveFailureText,h,a)}this.dirty=true}else{Ext.each(c.queue,function(i){if(!i){return}var e=i[this.paramNames.name];var j=this.decodeValue(i[this.paramNames.value]);if(undefined===j||null===j){Ext.ux.state.HttpProvider.superclass.clear.call(this,e)}else{Ext.ux.state.HttpProvider.superclass.set.call(this,e,j)}},this);if(false===this.dirty){this.queue=[]}else{var d,b,f;for(d=0;d<c.queue.length;d++){f=false;for(b=0;b<this.queue.length;b++){if(c.queue[d].name===this.queue[b].name){f=true;break}}if(true===f&&this.encodeValue(c.queue[d].value)===this.encodeValue(this.queue[b].value)){this.queue.remove(this.queue[b])}}}if(true===this.logSuccess){this.log(this.saveSuccessText,h,a)}this.fireEvent("savesuccess",this)}},onSaveFailure:function(a,b){if(true===this.logFailure){this.log(this.saveFailureText,a)}this.dirty=true;this.fireEvent("savefailure",this)},onReadFailure:function(a,b){if(true===this.logFailure){this.log(this.readFailureText,a)}this.fireEvent("readfailure",this)},onReadSuccess:function(a,b){var f={},c;try{f=Ext.decode(a.responseText)}catch(d){if(true===this.logFailure){this.log(this.readFailureText,d,a)}return}if(true!==f.success){if(true===this.logFailure){this.log(this.readFailureText,f,a)}}else{c=f[this.paramNames.data];if(!(c instanceof Array)&&true===this.logFailure){this.log(this.dataErrorText,c,a);return}Ext.each(c,function(e){this.state[e[this.paramNames.name]]=this.decodeValue(e[this.paramNames.value])},this);this.queue=[];this.dirty=false;if(true===this.logSuccess){this.log(this.readSuccessText,c,a)}this.fireEvent("readsuccess",this)}},readState:function(){var b={url:this.readUrl||this.url,method:this.method,scope:this,success:this.onReadSuccess,failure:this.onReadFailure,params:{}};var a=Ext.apply({},this.readBaseParams);a[this.paramNames.id]=this.id;a[this.paramNames.user]=this.user;a[this.paramNames.session]=this.session;Ext.apply(b.params,a);Ext.Ajax.request(b)},log:function(){if(console){console.log.apply(console,arguments)}}});Ext.ns("Ext.ux.util");Ext.ux.util.MD5=function(m){var k=0;var h=8;function f(n,q){var p=(n&65535)+(q&65535);var o=(n>>16)+(q>>16)+(p>>16);return(o<<16)|(p&65535)}function j(n,o){return(n<<o)|(n>>>(32-o))}function b(v,p,o,n,u,r){return f(j(f(f(p,v),f(n,r)),u),o)}function g(p,o,v,u,n,r,q){return b((o&v)|((~o)&u),p,o,n,r,q)}function c(p,o,v,u,n,r,q){return b((o&u)|(v&(~u)),p,o,n,r,q)}function i(p,o,v,u,n,r,q){return b(o^v^u,p,o,n,r,q)}function e(p,o,v,u,n,r,q){return b(v^(o|(~u)),p,o,n,r,q)}function d(y,s){y[s>>5]|=128<<((s)%32);y[(((s+64)>>>9)<<4)+14]=s;var w=1732584193;var v=-271733879;var u=-1732584194;var t=271733878;for(var p=0;p<y.length;p+=16){var r=w;var q=v;var o=u;var n=t;w=g(w,v,u,t,y[p+0],7,-680876936);t=g(t,w,v,u,y[p+1],12,-389564586);u=g(u,t,w,v,y[p+2],17,606105819);v=g(v,u,t,w,y[p+3],22,-1044525330);w=g(w,v,u,t,y[p+4],7,-176418897);t=g(t,w,v,u,y[p+5],12,1200080426);u=g(u,t,w,v,y[p+6],17,-1473231341);v=g(v,u,t,w,y[p+7],22,-45705983);w=g(w,v,u,t,y[p+8],7,1770035416);t=g(t,w,v,u,y[p+9],12,-1958414417);u=g(u,t,w,v,y[p+10],17,-42063);v=g(v,u,t,w,y[p+11],22,-1990404162);w=g(w,v,u,t,y[p+12],7,1804603682);t=g(t,w,v,u,y[p+13],12,-40341101);u=g(u,t,w,v,y[p+14],17,-1502002290);v=g(v,u,t,w,y[p+15],22,1236535329);w=c(w,v,u,t,y[p+1],5,-165796510);t=c(t,w,v,u,y[p+6],9,-1069501632);u=c(u,t,w,v,y[p+11],14,643717713);v=c(v,u,t,w,y[p+0],20,-373897302);w=c(w,v,u,t,y[p+5],5,-701558691);t=c(t,w,v,u,y[p+10],9,38016083);u=c(u,t,w,v,y[p+15],14,-660478335);v=c(v,u,t,w,y[p+4],20,-405537848);w=c(w,v,u,t,y[p+9],5,568446438);t=c(t,w,v,u,y[p+14],9,-1019803690);u=c(u,t,w,v,y[p+3],14,-187363961);v=c(v,u,t,w,y[p+8],20,1163531501);w=c(w,v,u,t,y[p+13],5,-1444681467);t=c(t,w,v,u,y[p+2],9,-51403784);u=c(u,t,w,v,y[p+7],14,1735328473);v=c(v,u,t,w,y[p+12],20,-1926607734);w=i(w,v,u,t,y[p+5],4,-378558);t=i(t,w,v,u,y[p+8],11,-2022574463);u=i(u,t,w,v,y[p+11],16,1839030562);v=i(v,u,t,w,y[p+14],23,-35309556);w=i(w,v,u,t,y[p+1],4,-1530992060);t=i(t,w,v,u,y[p+4],11,1272893353);u=i(u,t,w,v,y[p+7],16,-155497632);v=i(v,u,t,w,y[p+10],23,-1094730640);w=i(w,v,u,t,y[p+13],4,681279174);t=i(t,w,v,u,y[p+0],11,-358537222);u=i(u,t,w,v,y[p+3],16,-722521979);v=i(v,u,t,w,y[p+6],23,76029189);w=i(w,v,u,t,y[p+9],4,-640364487);t=i(t,w,v,u,y[p+12],11,-421815835);u=i(u,t,w,v,y[p+15],16,530742520);v=i(v,u,t,w,y[p+2],23,-995338651);w=e(w,v,u,t,y[p+0],6,-198630844);t=e(t,w,v,u,y[p+7],10,1126891415);u=e(u,t,w,v,y[p+14],15,-1416354905);v=e(v,u,t,w,y[p+5],21,-57434055);w=e(w,v,u,t,y[p+12],6,1700485571);t=e(t,w,v,u,y[p+3],10,-1894986606);u=e(u,t,w,v,y[p+10],15,-1051523);v=e(v,u,t,w,y[p+1],21,-2054922799);w=e(w,v,u,t,y[p+8],6,1873313359);t=e(t,w,v,u,y[p+15],10,-30611744);u=e(u,t,w,v,y[p+6],15,-1560198380);v=e(v,u,t,w,y[p+13],21,1309151649);w=e(w,v,u,t,y[p+4],6,-145523070);t=e(t,w,v,u,y[p+11],10,-1120210379);u=e(u,t,w,v,y[p+2],15,718787259);v=e(v,u,t,w,y[p+9],21,-343485551);w=f(w,r);v=f(v,q);u=f(u,o);t=f(t,n)}return[w,v,u,t]}function a(q){var p=[];var n=(1<<h)-1;for(var o=0;o<q.length*h;o+=h){p[o>>5]|=(q.charCodeAt(o/h)&n)<<(o%32)}return p}function l(p){var o=k?"0123456789ABCDEF":"0123456789abcdef";var q="";for(var n=0;n<p.length*4;n++){q+=o.charAt((p[n>>2]>>((n%4)*8+4))&15)+o.charAt((p[n>>2]>>((n%4)*8))&15)}return q}return l(d(a(m),m.length*h))};Ext.ux.util.clone=function(d){if(!d||"object"!==typeof d){return d}if("function"===typeof d.clone){return d.clone()}var e="[object Array]"===Object.prototype.toString.call(d)?[]:{};var b,a;for(b in d){if(d.hasOwnProperty(b)){a=d[b];if(a&&"object"===typeof a){e[b]=Ext.ux.util.clone(a)}else{e[b]=a}}}return e};Ext.ux.util.applyMatching=function(a,b){var b=b||this;for(var c in a){if(a.hasOwnProperty(c)&&undefined!==b[c]){a[c]=b[c]}}return a};Ext.overrideIf="function"===typeof Ext.overrideIf?Ext.overrideIf:function(a,c){if(c){var b=a.prototype;for(var d in c){if(!b[d]){b[d]=c[d]}}}};if("function"!==typeof RegExp.escape){RegExp.escape=function(a){if("string"!==typeof a){return a}return a.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")}}Ext.overrideIf(RegExp,{clone:function(){return new RegExp(this)}});Ext.overrideIf(Array,{copy:function(){var c=[];for(var d=0,b=this.length;d<b;d++){c.push(this[d])}return c},indexOf:function(d,a){for(var e=+a||0,c=this.length;e<c;e++){if(this[e]===d){return e}}return -1},intersect:function(){if(!arguments.length){return[]}var e=this,b,d;for(var f=0,h=arguments.length;f<h;f++){d=[];b=arguments[f]||[];for(var g=0,c=e.length;g<c;g++){if(-1<b.indexOf(e[g])){d.push(e[g])}}e=d}return d.unique()},lastIndexOf:function(c,a){a=+a||0;var d=this.length;while(d-->a){if(this[d]===c){return d}}return -1},union:function(){var d=this.copy(),c;for(var e=0,g=arguments.length;e<g;e++){c=arguments[e]||[];for(var f=0,b=c.length;f<b;f++){d.push(c[f])}}return d.unique()},unique:function(){var c=[],d,b=this.length;for(d=0;d<b;d++){if(c.indexOf(this[d])<0){c.push(this[d])}}return c}});Ext.define("Ext.ux.form.XCheckbox",{extend:"Ext.form.Checkbox",inputValue:"true",uncheckedValue:"false",boxLabelAlign:"before",});Ext.ns("Ext.ux.form");Ext.define("Ext.ux.form.VCheckbox",{extend:"Ext.ux.form.XCheckbox",checkedCls:"v-form-check-checked",focusCls:"v-form-check-focus",overCls:"v-form-check-over",mouseDownCls:"v-form-check-down",baseCls:"v-form-check"});Ext.define("Ext.ux.colorpick.ColorUtils",function(a){var b=Ext.isIE&&Ext.ieVersion<10;return{singleton:true,constructor:function(){a=this},backgroundTpl:b?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr='#{alpha}{hex}', endColorstr='#{alpha}{hex}');":"background: {rgba};",setBackground:b?function(e,c){if(e){var d=Ext.XTemplate.getTpl(a,"backgroundTpl"),f={hex:a.rgb2hex(c.r,c.g,c.b),alpha:Math.floor(c.a*255).toString(16)},g=d.apply(f);e.applyStyles(g)}}:function(e,c){if(e){var d=Ext.XTemplate.getTpl(a,"backgroundTpl"),f={rgba:a.getRGBAString(c)},g=d.apply(f);e.applyStyles(g)}},formats:{HEX6:function(c){return a.rgb2hex(c.r,c.g,c.b)},HEX8:function(c){var e=a.rgb2hex(c.r,c.g,c.b),d=Math.round(c.a*255).toString(16);if(d.length<2){e+="0"}e+=d.toUpperCase();return e}},hexRe:/#?([0-9a-f]{3,8})/i,rgbaAltRe:/rgba\(\s*([\w#\d]+)\s*,\s*([\d\.]+)\s*\)/,rgbaRe:/rgba\(\s*([\d\.]+)\s*,\s*([\d\.]+)\s*,\s*([\d\.]+)\s*,\s*([\d\.]+)\s*\)/,rgbRe:/rgb\(\s*([\d\.]+)\s*,\s*([\d\.]+)\s*,\s*([\d\.]+)\s*\)/,parseColor:function(c){if(!c){return null}var h=this,g=h.colorMap[c],f,e,d;if(g){e={r:g[0],g:g[1],b:g[2],a:1}}else{if(c==="transparent"){e={r:0,g:0,b:0,a:0}}else{f=h.hexRe.exec(c);if(f){f=f[1];switch(f.length){default:return null;case 3:e={r:parseInt(f[0]+f[0],16),g:parseInt(f[1]+f[1],16),b:parseInt(f[2]+f[2],16),a:1};break;case 6:case 8:e={r:parseInt(f.substr(0,2),16),g:parseInt(f.substr(2,2),16),b:parseInt(f.substr(4,2),16),a:parseInt(f.substr(6,2)||"ff",16)/255};break}}else{f=h.rgbaRe.exec(c);if(f){e={r:parseFloat(f[1]),g:parseFloat(f[2]),b:parseFloat(f[3]),a:parseFloat(f[4])}}else{f=h.rgbaAltRe.exec(c);if(f){e=h.parseColor(f[1]);e.a=parseFloat(f[2]);return e}f=h.rgbRe.exec(c);if(f){e={r:parseFloat(f[1]),g:parseFloat(f[2]),b:parseFloat(f[3]),a:1}}else{return null}}}}}d=this.rgb2hsv(e.r,e.g,e.b);return Ext.apply(e,d)},getRGBAString:function(c){return"rgba("+c.r+","+c.g+","+c.b+","+c.a+")"},getRGBString:function(c){return"rgb("+c.r+","+c.g+","+c.b+")"},hsv2rgb:function(k,j,g){k=k*360;if(k===360){k=0}var l=g*j;var f=k/60;var e=l*(1-Math.abs(f%2-1));var i=[0,0,0];switch(Math.floor(f)){case 0:i=[l,e,0];break;case 1:i=[e,l,0];break;case 2:i=[0,l,e];break;case 3:i=[0,e,l];break;case 4:i=[e,0,l];break;case 5:i=[l,0,e];break;default:console.error("unknown color "+k+" "+j+" "+g);break}var d=g-l;i[0]+=d;i[1]+=d;i[2]+=d;i[0]=Math.round(i[0]*255);i[1]=Math.round(i[1]*255);i[2]=Math.round(i[2]*255);return{r:i[0],g:i[1],b:i[2]}},rgb2hsv:function(d,i,l){d=d/255;i=i/255;l=l/255;var j=Math.max(d,i,l);var e=Math.min(d,i,l);var k=j-e;var o=0;if(k!==0){if(j===d){o=((i-l)/k)%6}else{if(j===i){o=((l-d)/k)+2}else{if(j===l){o=((d-i)/k)+4}}}}var f=o*60;if(f===360){f=0}var n=j;var p=0;if(k!==0){p=k/n}f=f/360;if(f<0){f=f+1}return{h:f,s:p,v:n}},rgb2hex:function(e,d,c){e=e.toString(16);d=d.toString(16);c=c.toString(16);if(e.length<2){e="0"+e}if(d.length<2){d="0"+d}if(c.length<2){c="0"+c}return(e+d+c).toUpperCase()},colorMap:{aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]}}},function(c){var a=c.formats,b={};a["#HEX6"]=function(d){return"#"+a.HEX6(d)};a["#HEX8"]=function(d){return"#"+a.HEX8(d)};Ext.Object.each(a,function(d,e){b[d.toLowerCase()]=function(f){var g=e(f);return g.toLowerCase()}});Ext.apply(a,b)});Ext.define("Ext.ux.colorpick.Selection",{mixinId:"colorselection",config:{format:"hex6",value:"FF0000",color:null,previousColor:null},applyColor:function(a){var b=a;if(Ext.isString(b)){b=Ext.ux.colorpick.ColorUtils.parseColor(a)}return b},applyValue:function(a){var b=Ext.ux.colorpick.ColorUtils.parseColor(a);return this.formatColor(b)},formatColor:function(a){return Ext.ux.colorpick.ColorUtils.formats[this.getFormat()](a)},updateColor:function(a){var b=this;if(!b.syncing){b.syncing=true;b.setValue(b.formatColor(a));b.syncing=false}},updateValue:function(c,a){var b=this;if(!b.syncing){b.syncing=true;b.setColor(c);b.syncing=false}this.fireEvent("change",b,c,a)}});Ext.define("Ext.ux.colorpick.ColorMapController",{extend:"Ext.app.ViewController",alias:"controller.colorpickercolormapcontroller",requires:["Ext.ux.colorpick.ColorUtils"],onFirstBoxReady:function(){var d=this,c=d.getView(),b=c.down("#dragHandle"),a=b.dd;a.constrain=true;a.constrainTo=c.getEl();a.initialConstrainTo=a.constrainTo;a.on("drag",Ext.bind(d.onHandleDrag,d));d.mon(c.getEl(),{mousedown:d.onMouseDown,dragstart:d.onDragStart,scope:d})},onHandleDrag:function(c,g){var i=this,a=i.getView(),h=a.down("#dragHandle"),l=h.getX()-a.getX(),j=h.getY()-a.getY(),f=a.getEl(),k=f.getWidth(),m=f.getHeight(),b=l/k,d=j/m;if(b>0.99){b=1}if(d>0.99){d=1}a.fireEvent("handledrag",b,d)},onMouseDown:function(d){var c=this,b=c.getView(),a=b.down("#dragHandle");a.setY(d.getY());a.setX(d.getX());c.onHandleDrag();a.dd.onMouseDown(d,a.dd.el)},onDragStart:function(d){var c=this,b=c.getView(),a=b.down("#dragHandle");a.dd.onDragStart(d,a.dd.el)},onMapClick:function(h){var d=this,c=d.getView(),a=c.down("#dragHandle"),i=c.getXY(),b=h.getXY(),g,f;g=b[0]-i[0];f=b[1]-i[1];a.getEl().setStyle({left:g+"px",top:f+"px"});d.onHandleDrag()},onColorBindingChanged:function(a){var k=this,d=k.getViewModel(),f=d.get("selectedColor"),g,b=k.getView(),j=b.down("#dragHandle"),i=b.getEl(),m=i.getWidth(),n=i.getHeight(),c,h,e,l;g=Ext.ux.colorpick.ColorUtils.rgb2hsv(f.r,f.g,f.b);c=g.s;e=m*c;h=1-g.v;l=n*h;j.getEl().setStyle({left:e+"px",top:l+"px"})},onHueBindingChanged:function(b){var e=this,c=e.getViewModel(),a,d;a=Ext.ux.colorpick.ColorUtils.hsv2rgb(b,1,1);d=Ext.ux.colorpick.ColorUtils.rgb2hex(a.r,a.g,a.b);e.getView().getEl().applyStyles({"background-color":"#"+d})}});Ext.define("Ext.ux.colorpick.ColorMap",{extend:"Ext.container.Container",alias:"widget.colorpickercolormap",controller:"colorpickercolormapcontroller",requires:["Ext.ux.colorpick.ColorMapController"],cls:Ext.baseCSSPrefix+"colorpicker-colormap",items:[{xtype:"component",cls:Ext.baseCSSPrefix+"colorpicker-colormap-draghandle-container",itemId:"dragHandle",width:1,height:1,draggable:true,html:'<div class="'+Ext.baseCSSPrefix+'colorpicker-colormap-draghandle"></div>'}],listeners:{boxready:{single:true,fn:"onFirstBoxReady",scope:"controller"},colorbindingchanged:{fn:"onColorBindingChanged",scope:"controller"},huebindingchanged:{fn:"onHueBindingChanged",scope:"controller"}},afterRender:function(){var b=this,c=b.mapGradientUrl,a=b.el;b.callParent();if(!c){c=a.getStyle("background-image");c=c.substring(4,c.length-1);if(c.indexOf('"')===0){c=c.substring(1,c.length-1)}Ext.ux.colorpick.ColorMap.prototype.mapGradientUrl=c}a.setStyle("background-image","none");a=b.layout.getElementTarget();a.createChild({tag:"img",cls:Ext.baseCSSPrefix+"colorpicker-colormap-blender",src:c})},setPosition:function(c){var b=this,a=b.down("#dragHandle");if(!a.dd||!a.dd.constrain){return}if(typeof a.dd.dragEnded!=="undefined"&&!a.dd.dragEnded){return}b.fireEvent("colorbindingchanged",c)},setHue:function(a){var b=this;if(!b.getEl()){return}b.fireEvent("huebindingchanged",a)}});Ext.define("Ext.ux.colorpick.SelectorModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.colorpick-selectormodel",requires:["Ext.ux.colorpick.ColorUtils"],data:{selectedColor:{r:255,g:255,b:255,h:0,s:1,v:1,a:1},previousColor:{r:0,g:0,b:0,h:0,s:1,v:1,a:1}},formulas:{hex:{get:function(d){var f=d("selectedColor.r").toString(16),e=d("selectedColor.g").toString(16),c=d("selectedColor.b").toString(16),a;a=Ext.ux.colorpick.ColorUtils.rgb2hex(f,e,c);return"#"+a},set:function(b){var a=Ext.ux.colorpick.ColorUtils.hex2rgb(b);this.changeRGB(a)}},red:{get:function(a){return a("selectedColor.r")},set:function(a){this.changeRGB({r:a})}},green:{get:function(a){return a("selectedColor.g")},set:function(a){this.changeRGB({g:a})}},blue:{get:function(a){return a("selectedColor.b")},set:function(a){this.changeRGB({b:a})}},hue:{get:function(a){return a("selectedColor.h")*360},set:function(a){this.changeHSV({h:a/360})}},saturation:{get:function(a){return a("selectedColor.s")*100},set:function(a){this.changeHSV({s:a/100})}},value:{get:function(b){var a=b("selectedColor.v");return a*100},set:function(a){this.changeHSV({v:a/100})}},alpha:{get:function(c){var b=c("selectedColor.a");return b*100},set:function(a){this.set("selectedColor",Ext.applyIf({a:a/100},this.data.selectedColor))}}},changeHSV:function(b){Ext.applyIf(b,this.data.selectedColor);var a=Ext.ux.colorpick.ColorUtils.hsv2rgb(b.h,b.s,b.v);b.r=a.r;b.g=a.g;b.b=a.b;this.set("selectedColor",b)},changeRGB:function(b){Ext.applyIf(b,this.data.selectedColor);var a=Ext.ux.colorpick.ColorUtils.rgb2hsv(b.r,b.g,b.b);b.h=a.h;b.s=a.s;b.v=a.v;this.set("selectedColor",b)}});Ext.define("Ext.ux.colorpick.SelectorController",{extend:"Ext.app.ViewController",alias:"controller.colorpick-selectorcontroller",requires:["Ext.ux.colorpick.ColorUtils"],initViewModel:function(){var b=this,a=b.getView();a.childViewModel.bind("{selectedColor}",function(c){a.setColor(c)})},destroy:function(){var c=this,b=c.getView(),a=b.childViewModel;if(a){a.destroy();b.childViewModel=null}c.callParent()},changeHSV:function(d){var a=this.getView(),b=a.getColor(),c;Ext.applyIf(d,b);c=Ext.ux.colorpick.ColorUtils.hsv2rgb(d.h,d.s,d.v);Ext.apply(d,c);a.setColor(d)},onColorMapHandleDrag:function(b,a){this.changeHSV({s:b,v:1-a})},onValueSliderHandleDrag:function(a){this.changeHSV({v:1-a})},onSaturationSliderHandleDrag:function(a){this.changeHSV({s:1-a})},onHueSliderHandleDrag:function(a){this.changeHSV({h:1-a})},onAlphaSliderHandleDrag:function(c){var a=this.getView(),b=a.getColor(),d=Ext.applyIf({a:1-c},b);a.setColor(d);a.el.repaint()},onPreviousColorSelected:function(c,b){var a=this.getView();a.setColor(b)},onOK:function(){var b=this,a=b.getView();a.fireEvent("ok",a,a.getValue())},onCancel:function(){this.fireViewEvent("cancel",this.getView())},onResize:function(){var j=this,c=j.getView(),i=c.childViewModel,e=j.getReferences(),g,f,d,b;if(!j.hasResizedOnce){j.hasResizedOnce=true;return}g=i.get("hue");f=i.get("saturation");d=i.get("value");b=i.get("alpha");console.log("h="+g);e.colorMap.setPosition(i.getData());e.hueSlider.setHue(g);e.satSlider.setSaturation(f);e.valueSlider.setValue(d);e.alphaSlider.setAlpha(b)}});Ext.define("Ext.ux.colorpick.ColorPreview",{extend:"Ext.Component",alias:"widget.colorpickercolorpreview",requires:["Ext.util.Format"],style:"position: relative",html:'<div class="filter" style="height:100%; width:100%; position: absolute;"></div><a class="btn" style="height:100%; width:100%; position: absolute;"></a>',cls:"x-colorpreview",height:256,onRender:function(){var a=this;a.callParent(arguments);a.mon(a.el.down(".btn"),"click",a.onClick,a)},onClick:function(){this.fireEvent("click",this,this.color)},setColor:function(a){var c=this,b=c.getEl();if(!b){return}c.color=a;c.applyBgStyle(a)},bgStyleTpl:Ext.create("Ext.XTemplate",Ext.isIE&&Ext.ieVersion<10?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr='#{hexAlpha}{hex}', endColorstr='#{hexAlpha}{hex}');":"background: {rgba};"),applyBgStyle:function(a){var e=this,g=Ext.ux.colorpick.ColorUtils,c=e.getEl().down(".filter"),d,f,b,h;d=g.rgb2hex(a.r,a.g,a.b);f=Ext.util.Format.hex(Math.floor(a.a*255),2);b=g.getRGBAString(a);h=this.bgStyleTpl.apply({hex:d,hexAlpha:f,rgba:b});c.applyStyles(h)}});Ext.define("Ext.ux.colorpick.SliderController",{extend:"Ext.app.ViewController",alias:"controller.colorpick-slidercontroller",boxReady:function(d){var e=this,c=e.getDragContainer(),b=e.getDragHandle(),a=b.dd;a.constrain=true;a.constrainTo=c.getEl();a.initialConstrainTo=a.constrainTo;a.on("drag",e.onHandleDrag,e)},getDragHandle:function(){return this.view.lookupReference("dragHandle")},getDragContainer:function(){return this.view.lookupReference("dragHandleContainer")},onHandleDrag:function(d){var g=this,i=g.getView(),a=g.getDragContainer(),f=g.getDragHandle(),h=f.getY()-a.getY(),c=a.getEl(),j=c.getHeight(),b=h/j;if(b>0.99){b=1}i.fireEvent("handledrag",b)},onMouseDown:function(c){var b=this,a=b.getDragHandle(),d=c.getY();a.setY(d);b.onHandleDrag();a.el.repaint();a.dd.onMouseDown(c,a.dd.el)},onDragStart:function(c){var b=this,a=b.getDragHandle();a.dd.onDragStart(c,a.dd.el)},onMouseUp:function(){var a=this.getDragHandle();a.dd.dragEnded=true}});Ext.define("Ext.ux.colorpick.Slider",{extend:"Ext.container.Container",xtype:"colorpickerslider",controller:"colorpick-slidercontroller",baseCls:Ext.baseCSSPrefix+"colorpicker-slider",layout:"center",requires:["Ext.layout.container.Center","Ext.ux.colorpick.SliderController"],referenceHolder:true,listeners:{element:"el",mousedown:"onMouseDown",mouseup:"onMouseUp",dragstart:"onDragStart"},items:{xtype:"container",cls:Ext.baseCSSPrefix+"colorpicker-draghandle-container",reference:"dragHandleContainer",height:"100%",items:{xtype:"component",cls:Ext.baseCSSPrefix+"colorpicker-draghandle-outer",reference:"dragHandle",width:"100%",height:1,draggable:true,html:'<div class="'+Ext.baseCSSPrefix+'colorpicker-draghandle"></div>'}},setHue:function(){Ext.Error.raise("Must implement setHue() in a child class!")},getDragHandle:function(){return this.lookupReference("dragHandle")},getDragContainer:function(){return this.lookupReference("dragHandleContainer")}});Ext.define("Ext.ux.colorpick.SliderAlpha",{extend:"Ext.ux.colorpick.Slider",alias:"widget.colorpickerslideralpha",cls:Ext.baseCSSPrefix+"colorpicker-alpha",requires:["Ext.XTemplate"],gradientStyleTpl:Ext.create("Ext.XTemplate",Ext.isIE&&Ext.ieVersion<10?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr='#FF{hex}', endColorstr='#00{hex}');":"background: -mox-linear-gradient(top, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);background: -webkit-linear-gradient(top,rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);background: -o-linear-gradient(top, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);background: -ms-linear-gradient(top, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);background: linear-gradient(to bottom, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);"),setAlpha:function(g){var d=this,b=d.getDragContainer(),a=d.getDragHandle(),f=b.getEl(),e=f.getHeight(),c,h;if(!a.dd||!a.dd.constrain){return}if(typeof a.dd.dragEnded!=="undefined"&&!a.dd.dragEnded){return}h=e*(1-(g/100));c=a.getEl();c.setStyle({top:h})},setColor:function(b){var e=this,a=e.getDragContainer(),d,c;if(!e.getEl()){return}d=Ext.ux.colorpick.ColorUtils.rgb2hex(b.r,b.g,b.b);c=a.getEl().down(".x-autocontainer-innerCt");c.applyStyles(e.gradientStyleTpl.apply({hex:d,r:b.r,g:b.g,b:b.b}))}});Ext.define("Ext.ux.colorpick.SliderSaturation",{extend:"Ext.ux.colorpick.Slider",alias:"widget.colorpickerslidersaturation",cls:Ext.baseCSSPrefix+"colorpicker-saturation",gradientStyleTpl:Ext.create("Ext.XTemplate",Ext.isIE&&Ext.ieVersion<10?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr='#{hex}', endColorstr='#ffffff');":"background: -mox-linear-gradient(top, #{hex} 0%, #ffffff 100%);background: -webkit-linear-gradient(top, #{hex} 0%,#ffffff 100%);background: -o-linear-gradient(top, #{hex} 0%,#ffffff 100%);background: -ms-linear-gradient(top, #{hex} 0%,#ffffff 100%);background: linear-gradient(to bottom, #{hex} 0%,#ffffff 100%);"),setSaturation:function(e){var d=this,b=d.getDragContainer(),a=d.getDragHandle(),g=b.getEl(),f=g.getHeight(),c,h;if(!a.dd||!a.dd.constrain){return}if(typeof a.dd.dragEnded!=="undefined"&&!a.dd.dragEnded){return}c=1-(e/100);h=f*c;a.getEl().setStyle({top:h+"px"})},setHue:function(b){var e=this,a=e.getDragContainer(),c,d;if(!e.getEl()){return}c=Ext.ux.colorpick.ColorUtils.hsv2rgb(b,1,1);d=Ext.ux.colorpick.ColorUtils.rgb2hex(c.r,c.g,c.b);a.getEl().applyStyles(e.gradientStyleTpl.apply({hex:d}))}});Ext.define("Ext.ux.colorpick.SliderValue",{extend:"Ext.ux.colorpick.Slider",alias:"widget.colorpickerslidervalue",cls:Ext.baseCSSPrefix+"colorpicker-value",requires:["Ext.XTemplate"],gradientStyleTpl:Ext.create("Ext.XTemplate",Ext.isIE&&Ext.ieVersion<10?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr='#{hex}', endColorstr='#000000');":"background: -mox-linear-gradient(top, #{hex} 0%, #000000 100%);background: -webkit-linear-gradient(top, #{hex} 0%,#000000 100%);background: -o-linear-gradient(top, #{hex} 0%,#000000 100%);background: -ms-linear-gradient(top, #{hex} 0%,#000000 100%);background: linear-gradient(to bottom, #{hex} 0%,#000000 100%);"),setValue:function(g){var d=this,b=d.getDragContainer(),a=d.getDragHandle(),f=b.getEl(),e=f.getHeight(),c,h;if(!a.dd||!a.dd.constrain){return}if(typeof a.dd.dragEnded!=="undefined"&&!a.dd.dragEnded){return}c=1-(g/100);h=e*c;a.getEl().setStyle({top:h+"px"})},setHue:function(b){var e=this,a=e.getDragContainer(),c,d;if(!e.getEl()){return}c=Ext.ux.colorpick.ColorUtils.hsv2rgb(b,1,1);d=Ext.ux.colorpick.ColorUtils.rgb2hex(c.r,c.g,c.b);a.getEl().applyStyles(e.gradientStyleTpl.apply({hex:d}))}});Ext.define("Ext.ux.colorpick.SliderHue",{extend:"Ext.ux.colorpick.Slider",alias:"widget.colorpickersliderhue",cls:Ext.baseCSSPrefix+"colorpicker-hue",afterRender:function(){var b=this,c=b.gradientUrl,a=b.el;b.callParent();if(!c){c=a.getStyle("background-image");c=c.substring(4,c.length-1);if(c.indexOf('"')===0){c=c.substring(1,c.length-1)}Ext.ux.colorpick.SliderHue.prototype.gradientUrl=c}a.setStyle("background-image","none");a=b.getDragContainer().layout.getElementTarget();a.createChild({tag:"img",cls:Ext.baseCSSPrefix+"colorpicker-hue-gradient",src:c})},setHue:function(c){var e=this,b=e.getDragContainer(),a=e.getDragHandle(),g=b.getEl(),f=g.getHeight(),d,h;if(!a.dd||!a.dd.constrain){return}if(typeof a.dd.dragEnded!=="undefined"&&!a.dd.dragEnded){return}h=f*(360-c)/360;d=a.getEl();d.setStyle({top:h+"px"})}});Ext.define("Ext.ux.colorpick.Selector",{extend:"Ext.container.Container",xtype:"colorselector",mixins:["Ext.ux.colorpick.Selection"],controller:"colorpick-selectorcontroller",requires:["Ext.layout.container.HBox","Ext.form.field.Text","Ext.form.field.Number","Ext.ux.colorpick.ColorMap","Ext.ux.colorpick.SelectorModel","Ext.ux.colorpick.SelectorController","Ext.ux.colorpick.ColorPreview","Ext.ux.colorpick.Slider","Ext.ux.colorpick.SliderAlpha","Ext.ux.colorpick.SliderSaturation","Ext.ux.colorpick.SliderValue","Ext.ux.colorpick.SliderHue"],width:580,height:337,cls:Ext.baseCSSPrefix+"colorpicker",padding:10,layout:{type:"hbox",align:"stretch"},defaultBindProperty:"value",twoWayBindable:["value"],fieldWidth:50,fieldPad:5,showPreviousColor:false,showOkCancelButtons:false,listeners:{resize:"onResize"},constructor:function(b){var c=this,a=Ext.Factory.viewModel("colorpick-selectormodel");c.childViewModel=a;c.items=[c.getMapAndHexRGBFields(a),c.getSliderAndHField(a),c.getSliderAndSField(a),c.getSliderAndVField(a),c.getSliderAndAField(a),c.getPreviewAndButtons(a,b)];c.callParent(arguments)},updateColor:function(a){var b=this;b.mixins.colorselection.updateColor.call(b,a);b.childViewModel.set("selectedColor",a)},updatePreviousColor:function(a){this.childViewModel.set("previousColor",a)},getMapAndHexRGBFields:function(a){var c=this,d={top:0,right:c.fieldPad,bottom:0,left:0},b=c.fieldWidth;return{xtype:"container",viewModel:a,cls:Ext.baseCSSPrefix+"colorpicker-escape-overflow",flex:1,layout:{type:"vbox",align:"stretch"},margin:"0 10 0 0",items:[{xtype:"colorpickercolormap",reference:"colorMap",flex:1,bind:{position:{bindTo:"{selectedColor}",deep:true},hue:"{selectedColor.h}"},listeners:{handledrag:"onColorMapHandleDrag"}},{xtype:"container",layout:"hbox",defaults:{labelAlign:"top",labelSeparator:"",allowBlank:false,onChange:function(){if(this.isValid()){Ext.form.field.Base.prototype.onChange.apply(this,arguments)}}},items:[{xtype:"textfield",fieldLabel:"HEX",flex:1,bind:"{hex}",margin:d,readOnly:true},{xtype:"numberfield",fieldLabel:"R",bind:"{red}",width:b,hideTrigger:true,maxValue:255,minValue:0,margin:d},{xtype:"numberfield",fieldLabel:"G",bind:"{green}",width:b,hideTrigger:true,maxValue:255,minValue:0,margin:d},{xtype:"numberfield",fieldLabel:"B",bind:"{blue}",width:b,hideTrigger:true,maxValue:255,minValue:0,margin:0}]}]}},getSliderAndHField:function(a){var b=this;return{xtype:"container",viewModel:a,cls:Ext.baseCSSPrefix+"colorpicker-escape-overflow",width:b.fieldWidth,layout:{type:"vbox",align:"stretch"},items:[{xtype:"colorpickersliderhue",reference:"hueSlider",flex:1,bind:{hue:"{selectedColor.h}"},listeners:{handledrag:"onHueSliderHandleDrag"}},{xtype:"numberfield",fieldLabel:"H",labelAlign:"top",width:b.fieldWidth,labelSeparator:"",bind:"{hue}",hideTrigger:true,maxValue:360,minValue:0,allowBlank:false,margin:0}]}},getSliderAndSField:function(a){var b=this;return{xtype:"container",viewModel:a,cls:Ext.baseCSSPrefix+"colorpicker-escape-overflow",width:b.fieldWidth,layout:{type:"vbox",align:"stretch"},margin:{right:b.fieldPad,left:b.fieldPad},items:[{xtype:"colorpickerslidersaturation",reference:"satSlider",flex:1,bind:{saturation:"{saturation}",hue:"{selectedColor.h}"},listeners:{handledrag:"onSaturationSliderHandleDrag"}},{xtype:"numberfield",fieldLabel:"S",labelAlign:"top",labelSeparator:"",bind:"{saturation}",hideTrigger:true,maxValue:100,minValue:0,allowBlank:false,margin:0}]}},getSliderAndVField:function(a){var b=this;return{xtype:"container",viewModel:a,cls:Ext.baseCSSPrefix+"colorpicker-escape-overflow",width:b.fieldWidth,layout:{type:"vbox",align:"stretch"},items:[{xtype:"colorpickerslidervalue",reference:"valueSlider",flex:1,bind:{value:"{value}",hue:"{selectedColor.h}"},listeners:{handledrag:"onValueSliderHandleDrag"}},{xtype:"numberfield",fieldLabel:"V",labelAlign:"top",labelSeparator:"",bind:"{value}",hideTrigger:true,maxValue:100,minValue:0,allowBlank:false,margin:0}]}},getSliderAndAField:function(a){var b=this;return{xtype:"container",viewModel:a,cls:Ext.baseCSSPrefix+"colorpicker-escape-overflow",width:b.fieldWidth,layout:{type:"vbox",align:"stretch"},margin:{left:b.fieldPad},items:[{xtype:"colorpickerslideralpha",reference:"alphaSlider",flex:1,bind:{alpha:"{alpha}",color:{bindTo:"{selectedColor}",deep:true}},listeners:{handledrag:"onAlphaSliderHandleDrag"}},{xtype:"numberfield",fieldLabel:"A",labelAlign:"top",labelSeparator:"",bind:"{alpha}",hideTrigger:true,maxValue:100,minValue:0,allowBlank:false,margin:0}]}},getPreviewAndButtons:function(a,c){var b=[{xtype:"colorpickercolorpreview",flex:1,bind:{color:{bindTo:"{selectedColor}",deep:true}}}];if(c.showPreviousColor){b.push({xtype:"colorpickercolorpreview",flex:1,bind:{color:{bindTo:"{previousColor}",deep:true}},listeners:{click:"onPreviousColorSelected"}})}if(c.showOkCancelButtons){b.push({xtype:"button",text:"OK",margin:"10 0 0 0",handler:"onOK"},{xtype:"button",text:"Cancel",margin:"10 0 0 0",handler:"onCancel"})}return{xtype:"container",viewModel:a,width:70,margin:"0 0 0 10",items:b,layout:{type:"vbox",align:"stretch"}}}});Ext.define("Ext.ux.colorpick.Field",{extend:"Ext.form.field.Picker",xtype:"colorfield",mixins:["Ext.ux.colorpick.Selection"],requires:["Ext.window.Window","Ext.ux.colorpick.Selector","Ext.ux.colorpick.ColorUtils","Ext.layout.container.Fit"],editable:false,matchFieldWidth:false,beforeBodyEl:['<div class="'+Ext.baseCSSPrefix+'colorpicker-field-swatch"><div id="{id}-swatchEl" data-ref="swatchEl" class="'+Ext.baseCSSPrefix+'colorpicker-field-swatch-inner"></div></div>'],cls:Ext.baseCSSPrefix+"colorpicker-field",childEls:["swatchEl"],config:{popup:{lazy:true,$value:{xtype:"window",referenceHolder:true,minWidth:540,minHeight:200,layout:"fit",header:false,resizable:true,items:{xtype:"colorselector",reference:"selector",showPreviousColor:true,showOkCancelButtons:true}}}},afterRender:function(){this.callParent();this.updateValue(this.value)},createPicker:function(){var c=this,a=c.getPopup(),b;c.colorPickerWindow=a=Ext.create(a);c.colorPicker=b=a.lookupReference("selector");b.setFormat(c.getFormat());b.setColor(c.getColor());b.on({ok:"onColorPickerOK",cancel:"onColorPickerCancel",scope:c});return c.colorPickerWindow},onColorPickerOK:function(a){this.setColor(a.getColor());this.collapse()},onColorPickerCancel:function(){this.collapse()},onExpand:function(){var a=this.getColor();this.colorPicker.setPreviousColor(a)},setValue:function(a){var b=this,d=b.applyValue(a);b.callParent([d]);b.updateValue(d)},updateFormat:function(b){var a=this.colorPicker;if(a){a.setFormat(b)}},updateValue:function(a){var b=this,d;if(!b.syncing){b.syncing=true;b.setColor(a);b.syncing=false}d=b.getColor();Ext.ux.colorpick.ColorUtils.setBackground(b.swatchEl,d);if(b.colorPicker){b.colorPicker.setColor(d)}}});Ext.define("Ext.ux.TabCloseMenu",{extend:"Ext.plugin.Abstract",alias:"plugin.tabclosemenu",mixins:{observable:"Ext.util.Observable"},closeTabText:"Close Tab",showCloseOthers:true,closeOthersTabsText:"Close Other Tabs",showCloseAll:true,closeAllTabsText:"Close All Tabs",extraItemsHead:null,extraItemsTail:null,constructor:function(a){this.callParent([a]);this.mixins.observable.constructor.call(this,a)},init:function(a){this.tabPanel=a;this.tabBar=a.down("tabbar");this.mon(this.tabPanel,{scope:this,afterlayout:this.onAfterLayout,single:true})},onAfterLayout:function(){this.mon(this.tabBar.el,{scope:this,contextmenu:this.onContextMenu,delegate:".x-tab"})},destroy:function(){this.callParent();Ext.destroy(this.menu)},onContextMenu:function(d,f){var c=this,g=c.createMenu(),e=true,h=true,b=c.tabBar.getChildByElement(f),a=c.tabBar.items.indexOf(b);c.item=c.tabPanel.getComponent(a);g.child("#close").setDisabled(!c.item.closable);if(c.showCloseAll||c.showCloseOthers){c.tabPanel.items.each(function(i){if(i.closable){e=false;if(i!==c.item){h=false;return false}}return true});if(c.showCloseAll){g.child("#closeAll").setDisabled(e)}if(c.showCloseOthers){g.child("#closeOthers").setDisabled(h)}}d.preventDefault();c.fireEvent("beforemenu",g,c.item,c);g.showAt(d.getXY())},createMenu:function(){var b=this;if(!b.menu){var a=[{itemId:"close",text:b.closeTabText,scope:b,handler:b.onClose}];if(b.showCloseAll||b.showCloseOthers){a.push("-")}if(b.showCloseOthers){a.push({itemId:"closeOthers",text:b.closeOthersTabsText,scope:b,handler:b.onCloseOthers})}if(b.showCloseAll){a.push({itemId:"closeAll",text:b.closeAllTabsText,scope:b,handler:b.onCloseAll})}if(b.extraItemsHead){a=b.extraItemsHead.concat(a)}if(b.extraItemsTail){a=a.concat(b.extraItemsTail)}b.menu=Ext.create("Ext.menu.Menu",{items:a,listeners:{hide:b.onHideMenu,scope:b}})}return b.menu},onHideMenu:function(){var a=this;a.fireEvent("aftermenu",a.menu,a)},onClose:function(){this.tabPanel.remove(this.item)},onCloseOthers:function(){this.doClose(true)},onCloseAll:function(){this.doClose(false)},doClose:function(b){var a=[];this.tabPanel.items.each(function(c){if(c.closable){if(!b||c!==this.item){a.push(c)}}},this);Ext.suspendLayouts();Ext.Array.forEach(a,function(c){this.tabPanel.remove(c)},this);Ext.resumeLayouts(true)}});if(typeof CKEDITOR!=="undefined"){Ext.define("Ext.ux.CKEditor",{extend:"Ext.form.field.TextArea",alias:"widget.ckeditor",isReady:false,valueCache:null,initComponent:function(){this.callParent(arguments);this.on("afterrender",function(){var a={height:this.getHeight()+100,width:this.getWidth()};Ext.apply(this.CKConfig,a);this.editor=CKEDITOR.replace(this.inputEl.id,this.CKConfig);this.editor.name=this.name;this.editor.extField=this;this.dt=new Ext.util.DelayedTask(function(){this.extField.fireEvent("change")});this.editor.on("change",function(){this.extField.dt.delay(500,null,this)});this.editor.on("instanceReady",function(){this.fireEvent("instanceReady",this,this.editor);this.isReady=true;if(this.valueCache){this.setValue(this.valueCache)}},this);this.dtResize=new Ext.util.DelayedTask();this.editor.on("resize",function(b){this.extField.dtResize.delay(500,function(){this.fireEvent("resize",this,this.editor)},this.extField)})},this)},onRender:function(b,a){if(!this.el){this.defaultAutoCreate={tag:"textarea",autocomplete:"off"}}this.callParent(arguments)},setValue:function(b){var a=this;if(this.isReady){if(this.editor){this.editor.setData(b)}else{}this.callParent(arguments)}else{}this.valueCache=b},getValue:function(){if(this.editor){return this.editor.getData()}else{return""}}});(function(){CKEDITOR.plugins.add("multilang",{init:function(b){var d="multilang";b.ui.addButton("multilang",{label:"Cambiar idioma",command:"OpenWindow",toolbar:"multilanggroup",icon:"langimg/multilang-icon-Es.png"});var c=b.addCommand("OpenWindow",{exec:a})}});function a(g){var c=g.extField;var k=c.seleccionarIdioma.call(c,c.currentLang+1);var b=Ext.select("#"+g.id+"_toolbox .cke_button__multilang_icon").elements[0];var h=window.location.protocol+"//"+window.location.host;var f=window.location.pathname;var m="";f=f.split("/");if(f.length>3){for(var d=1;d<f.length-1;d++){m="/"+f[d]}}else{m="/"+f[f.length-2]}var l=h+m+"/ext5/uxAt4/ckeditor/ckeditor/langimg/"+k+".png";var j='url("'+l+'")';b.style.backgroundImage=j}})()}Ext.define("At4FrameworkIntranet.MultiList",{extend:"Ext.grid.filters.filter.SingleFilter",alias:"grid.filter.multiList",type:"multiList",operator:"in",itemDefaults:{checked:false,hideOnClick:false,maxWidth:300},menuDefaults:{xtype:"menu",maxHeight:450,minWidth:250,cls:"at4-multilist",maxWidth:300},multiConfigDefaults:{xtype:"multiselect",displayField:"DISPLAY",valueField:"ID",minWidth:250,dock:"top"},idField:"id",labelField:"text",labelIndex:null,loadingText:"Loading...",filterText:"Search...",elemSelec:"{0} elementos seleccionados.",loadOnShow:true,single:false,plain:true,constructor:function(c){var d=this,b,a;d.callParent([c]);if(d.itemDefaults.checked){Ext.Error.raise("The itemDefaults.checked config is not supported, use the value config instead.")}b=d.options;a=d.store;if(!b&&!a){d.getGridStore().on({scope:d,add:d.onDataChanged,refresh:d.onDataChanged,remove:d.onDataChanged,update:d.onDataChanged})}d.labelIndex=d.labelIndex||d.column.dataIndex},destroy:function(){return;var c=this,a=c.store,b=c.autoStore;if(a){if(b||a.autoDestroy){a.destroy()}else{a.un("load",c.bindMenuStore,c)}c.store=null}if(b){c.getGridStore().un({scope:c,add:c.onDataChanged,refresh:c.onDataChanged,remove:c.onDataChanged,update:c.onDataChanged})}c.callParent()},activateMenu:function(){console.log("MultilistFilter activateMenu");var e=this,f=e.filter.getValue(),c,d,a,b;if(!f||!f.length){return}c=e.menu.items;for(d=0,a=c.length;d<a;d++){b=c.getAt(d);if(Ext.Array.indexOf(f,b.value)>-1){b.setChecked(true,true)}}},bindMenuStore:function(a){console.log("MultilistFilter bindMenuStore");return;var b=this;if(b.grid.isDestroyed||b.preventFilterRemoval){return}b.createListStore(a);b.createMenuItems(b.store);b.loaded=true},createListStore:function(p){console.log("MultilistFilter createListStore");return;var j=this,n=j.store,k=p.isStore,c=j.idField,e=j.labelField,l=false,a,d,g,f,h,m,b;if(k){if(p!==j.getGridStore()){l=true;n=j.store=p}else{j.autoStore=true;a=j.getOptionsFromStore(p)}}else{a=[];for(f=0,h=p.length;f<h;f++){m=p[f];switch(Ext.typeOf(m)){case"array":a.push(m);break;case"object":a.push(m);break;default:if(m!=null){d={};d[c]=m;d[e]=m;a.push(d)}}}}if(!l){if(n){n.destroy()}n=j.store=new Ext.data.Store({fields:[c,e],data:a});j.loaded=true}j.setStoreFilter(n)},createMenu:function(d){console.log("MultilistFilter createMenu");var f=this,e=f.getGridStore(),b=f.store,c=f.options,h;if(b){f.store=b=Ext.StoreManager.lookup(b)}f.store.setRemoteFilter(false);f.callParent([d]);h=f.menu;f.resumenFilter=Ext.create({xtype:"box",dock:"bottom",style:"padding: 2px; background-color: white;",html:Ext.String.format(this.elemSelec,0)});f.vaciosFilter=Ext.create({xtype:"checkbox",boxLabel:"Vacios",style:"padding-left: 2px; background-color: white;",resumenMsg:"Viendo solo los vacios",listeners:{change:{fn:function(l,k,i,j){if(k){f.onCheckChange(l,["cosa"],i,j)}else{f.onCheckChange(l,[],i,j)}f.checkCheckBoxes(l,k)},scope:f}}});f.noVaciosFilter=Ext.create({xtype:"checkbox",boxLabel:"No vacios",style:"padding-left: 2px; background-color: white;",resumenMsg:"Viendo solo los no vacios",listeners:{change:{fn:function(l,k,i,j){if(k){f.onCheckChange(l,["cosa"],i,j)}else{f.onCheckChange(l,[],i,j)}f.checkCheckBoxes(l,k)},scope:f}}});f.multiselectFilter=Ext.create({xtype:"textfield",listeners:{change:{scope:f,fn:function(i,k,m,j){var l=this;l.filterMultiSelect({property:"DISPLAY",value:k,anyMatch:true})}}},emptyText:At4FrameworkIntranet.At4FrameworkIntranet.prototype.filterText,minWidth:150});var a=Ext.apply(this.multiConfigDefaults,{listeners:{change:function(k,j,i,l){f.resumenFilter.setHtml(Ext.String.format(this.elemSelec,j.length));return f.onCheckChange(k,j,i,l)},scope:f},store:b,});f.multiselect=Ext.create(a);var g=false;if(g){h.addDocked(f.vaciosFilter);h.addDocked(f.noVaciosFilter)}h.addDocked(f.multiselectFilter);h.addDocked(f.resumenFilter);h.add(f.multiselect);f.store.load()},createMenuItems:function(p){console.log("MultilistFilter createMenuItems");return;var n=this,c=n.menu,m=p.getCount(),g=Ext.Array.contains,o,d,k,l,b,a,h,f,j,q,e;if(m&&c){o={checkchange:n.onCheckChange,scope:n};d=n.getItemDefaults();c.suspendLayouts();c.removeAll(true);l=n.single?Ext.id():null;a=n.idField;f=n.labelField;e=[];for(j=0;j<m;j++){k=p.getAt(j);b=k.get(a);h=k.get(f);if(h==null||g(e,b)){continue}e.push(h);q=c.add(Ext.apply({text:h,group:l,value:b,listeners:o},d))}c.resumeLayouts(true)}},getFilterConfig:function(a,b){a.value=a.value||[];return this.callParent([a,b])},getOptionsFromStore:function(m){var k=this,g=m.getData(),b={},h=[],l=k.dataIndex,a=k.labelIndex,j,f,d,n,c,e;if(m.isFiltered()){g=g.getSource()}j=g.items;d=j.length;for(f=0;f<d;++f){n=j[f].data;c=n[l];e=n[a];if(e===undefined){e=c}if(!b[c]){b[c]=1;h.push([c,e])}}return h},onCheckChange:function(){var b=this,a=b.updateBuffer;if(a){b.task.delay(a,null,null)}else{b.setValue()}},onDataChanged:function(a){if(!this.preventDefault){this.bindMenuStore(a)}},setStoreFilter:function(j){var g=this,h=g.value,a=g.filter,c,d,e,b,f;if(h){if(!Ext.isArray(h)){h=[h]}a.setValue(h)}if(g.active){g.preventFilterRemoval=true;g.addStoreFilter(a);g.preventFilterRemoval=false}},setValue:function(){var a=this;var b=a.multiselect.getValue();a.filter.setValue(b);len=b.length;if(len&&a.active){a.updateStoreFilter()}else{a.setActive(!!len)}a.preventDefault=false},show:function(){var a=this.store;if(this.loadOnShow&&!this.loaded&&!a.hasPendingLoad()){a.load()}},filterMultiSelect:function(a){var b=this;if(b.taskFilterMultiselect){clearTimeout(b.taskFilterMultiselect)}b.taskFilterMultiselect=setTimeout(function(){var c=this;c.multiselect.store.filter([a]);c.taskFilterMultiselect=null}.bind(b),500)},checkCheckBoxes:function(d,e){var c=this;var a=[c.vaciosFilter,c.noVaciosFilter,c.multiselectFilter,c.multiselect];var b={};if(e){b=function(h,f,g){if(d==h){return}h.hide()};c.resumenFilter.setHtml(d.resumenMsg)}else{b=function(h,f,g){h.show()};c.resumenFilter.setHtml(Ext.String.format(this.elemSelec,0))}Ext.each(a,b)}});Ext.define("Ext.ux.GMapPanel",{extend:"Ext.panel.Panel",alias:"widget.gmappanel",requires:["Ext.window.MessageBox"],initComponent:function(){Ext.applyIf(this,{plain:true,gmapType:"map",border:false});this.callParent()},onBoxReady:function(){var a=this.center;this.callParent(arguments);if(a){if(a.geoCodeAddr){this.lookupCode(a.geoCodeAddr,a.marker)}else{this.createMap(a)}}else{Ext.Error.raise("center is required")}},createMap:function(a,b){var c=Ext.apply({},this.mapOptions);c=Ext.applyIf(c,{zoom:14,center:a,mapTypeId:google.maps.MapTypeId.HYBRID});this.gmap=new google.maps.Map(this.body.dom,c);if(b){this.addMarker(Ext.applyIf(b,{position:a}))}Ext.each(this.markers,this.addMarker,this);this.fireEvent("mapready",this,this.gmap)},addMarker:function(a){a=Ext.apply({map:this.gmap},a);if(!a.position){a.position=new google.maps.LatLng(a.lat,a.lng)}var b=new google.maps.Marker(a);Ext.Object.each(a.listeners,function(c,d){google.maps.event.addListener(b,c,d)});return b},lookupCode:function(b,a){this.geocoder=new google.maps.Geocoder();this.geocoder.geocode({address:b},Ext.Function.bind(this.onLookupComplete,this,[a],true))},onLookupComplete:function(c,b,a){if(b!="OK"){Ext.MessageBox.alert("Error",'An error occured: "'+b+'"');return}this.createMap(c[0].geometry.location,a)},afterComponentLayout:function(a,b){this.callParent(arguments);this.redraw()},redraw:function(){var a=this.gmap;if(a){google.maps.event.trigger(a,"resize")}}});Ext.define("At4FrameworkIntranet.BaseGMapField",{extend:"Ext.form.FieldContainer",mixins:["Ext.form.Labelable","Ext.form.field.Field"],width:"100%",height:650,layout:"vbox",gmapsReady:false,isEditing:false,name:"at4mapfield",fieldLabel:"at4mapfield",labelAlign:"top",markerIcon:"ext5/uxAt4/gmapsfield/img/pinxito.png",showEditButton:false,showHelpButton:false,showCancelButton:false,valueCache:null,constructor:function(a){var b=this;window.test=b;Ext.apply(this,a);this.callParent();var c=false;if(b.showEditButton){c=true;b.button=new Ext.button.Button({xtype:"button",text:b.editPolytxt,btnID:"edit",listeners:{click:{fn:b.buttonHandler,scope:b}}})}if(b.showCancelButton){c=true;b.cancelButton=new Ext.button.Button({xtype:"button",btnID:"cancel",text:b.cancelButtonTxt,listeners:{click:{fn:b.cancelButtonHandler,scope:b}}})}if(b.showHelpButton){c=true;b.helpButton=new Ext.button.Button({xtype:"button",text:b.buttonHelpTxt,margin:"0 0 0 20",btnID:"help",listeners:{click:{fn:b.buttonHelpHandler,scope:b}}})}b.map=Ext.create("Ext.panel.Panel",{closeAction:"hide",layout:"fit",width:b.width,height:b.height-60,items:{xtype:"gmappanel",gmapType:"map",border:true,center:{lat:39.570718,lng:2.650641},mapOptions:{streetViewControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{featureType:"poi",elementType:"labels.text",stylers:[{visibility:"off"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]}]},listeners:{mapready:{fn:function(d,e){b.gmaps=e;b.gmapsReady=true;b.onMapReady()}}}}});if(c){b.panelSuperior=new Ext.panel.Panel({height:35,defaults:{margin:"0 5px 0px 5px"},margin:"7px 0px 7px 0px",items:[b.button,b.helpButton,b.cancelButton]});b.items.add(b.panelSuperior)}b.items.add(b.map);b.border=true;b.addCls("at4-gmapField")},onMapClick:function(d){var c=this;if(!c.isEditing){return}var e=d.latLng.lat();var a=d.latLng.lng();var b=new google.maps.LatLng(e,a);c.addMarker(b)},onMapReady:function(){var a=this;if(a.valueCache){a.mapReadySetValue(a.valueCache)}a.gmaps.addListener("click",function(b){a.onMapClick(b)})},getValue:function(){console.log("getValue");console.warn("Not implemented yet");return"Not implemented"},getSubmitData:function(){console.log("getSubmitData");console.warn("Not implemented yet");return"Not implemented"},setValue:function(b){var a=this;if(a.gmapsReady){a.mapReadySetValue(b)}else{a.valueCache=b}},mapReadySetValue:function(a){console.log(a);console.log("setValue");console.warn("Not implemented yet")},centerMap:function(e,d){var c=this;var b;if(typeof(e)=="object"){b=e}else{var f=e,a=d;b=new google.maps.LatLng(f,a)}c.gmaps.setCenter(b)}});if(typeof google!=="undefined"){google.maps.Polygon.prototype.my_getBounds=function(){var a=new google.maps.LatLngBounds();this.getPath().forEach(function(c,b){a.extend(c)});return a}}Ext.define("At4FrameworkIntranet.PointGMapField",{extend:"At4FrameworkIntranet.BaseGMapField",xtype:"At4PointGMapField",showEditButton:false,showHelpButton:false,isEditing:true,marker:null,addMarker:function(b){var a=this;if(a.marker){a.marker.setMap(null)}a.marker=new google.maps.Marker({position:b,title:"#Localizacion",icon:a.markerIcon,map:a.gmaps})},getValue:function(){var b=this;if(!b.marker){return null}var a=b.marker.getPosition();var c={y:a.lat(),x:a.lng()};return JSON.stringify(c)},getSubmitData:function(){var a=this;var b={};b[a.name]=a.getValue();return b},});Ext.define("At4FrameworkIntranet.PolyGMapField",{extend:"At4FrameworkIntranet.BaseGMapField",xtype:"At4PolyGMapField",editPolytxt:"Redibujar",savePolytxt:"Aceptar",buttonHelpTxt:"Ayuda",cancelButtonTxt:"Cancelar",helpWindowTitle:"Ayuda: Editor de poligonos sobre mapa",helpHtml:"<div>Test</div>",showEditButton:true,showHelpButton:false,showCancelButton:true,constructor:function(a){var b=this;Ext.apply(this,a);this.callParent();b.cancelButton.hide();b.store=new Ext.data.SimpleStore({fields:["id","lat","lng"],});b.coords=[];b.markers=[]},buttonHandler:function(a){var b=this;if(a.btnID=="edit"){if(b.isEditing){b.isEditing=false;b.map.mask();b.button.setText(b.editPolytxt);return b.guardarPolHandler(a)}else{b.isEditing=true;b.map.unmask();b.button.setText(b.savePolytxt);return b.editarPolHandler(a)}}else{b.isEditing=false;b.map.mask();b.button.setText(b.editPolytxt);b.cancelButton.hide();b.showPoly()}},editarPolHandler:function(a){var b=this;b.cancelButton.show();if(b.polygon){b.polygon.setMap(null)}b.store.clearData();return},cancelButtonHandler:function(a){var b=this;b.buttonHandler(a)},showPoly:function(){var b=this;b.poly.getPath().clear();Ext.each(b.markers,function(c){c.setMap(null)});if(b.polygon){b.polygon.setMap(null)}b.polygon=new google.maps.Polygon({paths:b.coords,strokeColor:"#FF0000",strokeOpacity:0.5,strokeWeight:3,fillColor:"#FF0000",fillOpacity:0.15});b.polygon.setMap(b.gmaps);var a=b.polygon.my_getBounds();b.gmaps.fitBounds(a);b.centerMap(a.getCenter())},buttonHelpHandler:function(){var a=this;Ext.create("Ext.window.Window",{title:a.helpWindowTitle,closeAction:"destroy",height:200,width:400,html:a.helpHtml}).show()},guardarPolHandler:function(){var a=this;a.cancelButton.hide();a.coords=[];a.store.each(function(b){coord={lat:b.get("lat"),lng:b.get("lng")};a.coords.push(coord)});a.showPoly()},onMapReady:function(){this.callParent();var a=this;a.poly=new google.maps.Polyline({strokeColor:"#000000",strokeOpacity:1,strokeWeight:3});a.poly.setMap(a.gmaps)},addMarker:function(c){var b=this;b.saveMark(c);var d=b.poly.getPath();d.push(c);var a=new google.maps.Marker({position:c,title:"#"+d.getLength()+c.lat()+":"+c.lng(),icon:b.markerIcon,map:b.gmaps});a.addListener("click",function(e){b.onMarkerClick(e,a)});b.markers.push(a)},saveMark:function(c){var b=this;var d=c.lat();var a=c.lng();var e=d+":"+a;if(b.store.getById(e)){return}b.store.add({lat:d,lng:a,id:e})},onMarkerClick:function(c,a){var b=this;b.poly.getPath().forEach(function(e,d){if(e==c.latLng){b.poly.getPath().removeAt(d);a.setMap(null);b.store.removeAt(d,1)}});console.log(arguments)},getValue:function(){var a=this;return a.coords},getSubmitData:function(){var a=this;var b={};b[a.name]=JSON.stringify(a.getValue());return b},mapReadySetValue:function(d){var c=this;if(!d||!d.points){console.warn("El formato de los datos recibidos es erroneo");return}var a=d.points;var b=new google.maps.LatLngBounds();Ext.each(a,function(e){var g=e.y;var f=e.x;var h={lat:g,lng:f};c.coords.push(h)});c.showPoly();c.map.mask()}});Ext.define("At4FrameworkIntranet.ZonaPointGMapField",{extend:"At4FrameworkIntranet.PointGMapField",xtype:"At4ZonaPointGMapField",editPolytxt:"Editar",savePolytxt:"Aceptar",buttonHelpTxt:"Ayuda",helpWindowTitle:"Ayuda: Selector de ubicacion sobre mapa",helpHtml:"<div>Test</div>",showEditButton:true,showHelpButton:false,isEditing:false,constructor:function(){this.callParent(arguments);var a=this;a.zonas=[]},disable:function(){var a=this;a.disabled=true;a.button.disable()},enable:function(){var a=this;a.disabled=false;a.button.enable()},buttonHandler:function(a){var b=this;if(b.isEditing){return b.stopEdit(a)}else{a.setText(b.savePolytxt);return b.startEdit(a)}},onMapReady:function(){this.callParent();var a=this;a.map.mask()},mostrarZonas:function(){var a=this;a.store.each(function(b){console.log(b)})},mapReadySetValue:function(c){var a=this;if(c&&c.x&&c.y){var b=new google.maps.LatLng({lat:c.y,lng:c.x});a.centerMap(b);a.addMarker(b)}else{if(a.marker){a.marker.setMap(null);a.marker=null}}},startEdit:function(){var a=this;a.isEditing=true;a.button.setText(a.savePolytxt);a.map.unmask()},stopEdit:function(){var a=this;a.isEditing=false;a.button.setText(a.editPolytxt);a.map.mask();if(a.marker){a.centerMap(a.marker.getPosition())}},setValue:function(){this.stopEdit();return this.callParent(arguments)},getValue:function(){this.stopEdit();return this.callParent()}});Ext.define("Ext.ux.form.TriCheckbox",{extend:"Ext.form.field.Checkbox",alias:["widget.xtricheckbox","widget.tri-checkbox"],triState:true,cls:"triStateCBX",values:["desconocido","1","0"],checkedClasses:["x-checkbox-null",Ext.baseCSSPrefix+"form-cb-checked",""],currentCheck:0,value:"desconocido",getSubmitValue:function(){return this.value},getRawValue:function(){return this.value},getValue:function(){return this.value},initValue:function(){var a=this;a.originalValue=a.lastValue=a.value;a.suspendCheckChange++;a.setValue(a.value);a.suspendCheckChange--},setRawValue:function(a){var b=this;if(a===false){a="0"}if(a===true){a="1"}if(a==null||a==""||a===undefined){if(!this.triState){a="0"}else{a="desconocido"}}b.oldCheck=b.currentCheck;b.currentCheck=b.getCheckIndex(a);b.value=b.rawValue=b.values[b.currentCheck]},setValue:function(){var a=this;a.callParent(arguments);var b=a.inputEl;if(b){b.dom.setAttribute("aria-checked",a.value=="1"?true:false);a.removeCls(a.checkedClasses[a.oldCheck]);a.addCls(a.checkedClasses[a.currentCheck])}else{a.addCls(a.checkedClasses[a.currentCheck])}},getCheckIndex:function(b){for(var a=0;a<this.values.length;a++){if(b===this.values[a]){return a}}return 0},onBoxClick:function(a){this.toggle()},toggle:function(){var b=this;if(!b.disabled&&!b.readOnly){var a=b.currentCheck;a++;if(a>=b.values.length){a=0}this.setValue(b.values[a])}},enableTriState:function(a){if(a==undefined){a=true}this.triState=a;if(!this.triState){this.setValue(this.value)}},toggleTriState:function(){this.enableTriState(!this.triState)}});Ext.define("At4FrameworkIntranet.FilterItemSelector",{extend:"Ext.form.FieldContainer",mixins:["Ext.form.field.Field"],layout:"vbox",padding:0,constructor:function(a){this.fieldLabel=a.fieldLabel;this.hidden=a.hidden;delete a.hidden;delete a.fieldLabel;if(!a.listeners){a.listeners={}}a.listeners.resize={scope:this,fn:function(f,e,c,d,h,g){if(c<h){f.setHeight(h)}}};this.selectorInput=Ext.create("At4FrameworkIntranet.ItemSelector",a);this.filterInput=Ext.create({xtype:"textfield",width:200,emptyText:"Filtrar...",tabIndex:-1,enableKeyEvents:true,width:At4FrameworkIntranet.FormDefaults.HALF_TEXT_FIELD_WIDTH,listeners:{change:{scope:this,fn:function(c,f,e){if(f){var d={property:"DISPLAY",id:"searchFilter",operator:"like",type:"string",value:f};this.selectorInput.fromStore.remoteFilter=false;this.selectorInput.fromField.store.addFilter(d)}else{this.selectorInput.fromField.store.clearFilter()}}},keypress:{scope:this,fn:function(c,d,f){if(d.keyCode==13){var e=this.selectorInput.fromField.store.getRange();this.selectorInput.moveRec(true,e);c.blur();c.setValue("")}}}}});var b=this.filterInput;if(a.extraFilter){a.extraFilter.margin="0 0 0 15";b={xtype:"container",layout:"hbox",margin:"2 0 7 0",items:[this.filterInput,a.extraFilter]}}this.items=[b,this.selectorInput];this.callParent()},setValue:function(a){this.selectorInput.setValue(a)},getValue:function(){return this.selectorInput.getValue()}});Ext.define("Ext.ux.IFrame",{extend:"Ext.Component",alias:"widget.uxiframe",loadMask:"Loading...",src:"about:blank",renderTpl:['<iframe src="{src}" id="{id}-iframeEl" data-ref="iframeEl" name="{frameName}" width="100%" height="100%" frameborder="0"></iframe>'],childEls:["iframeEl"],initComponent:function(){this.callParent();this.frameName=this.frameName||this.id+"-frame"},initEvents:function(){var a=this;a.callParent();a.iframeEl.on("load",a.onLoad,a)},initRenderData:function(){return Ext.apply(this.callParent(),{src:this.src,frameName:this.frameName})},getBody:function(){var a=this.getDoc();return a.body||a.documentElement},getDoc:function(){try{return this.getWin().document}catch(a){return null}},getWin:function(){var b=this,a=b.frameName,c=Ext.isIE?b.iframeEl.dom.contentWindow:window.frames[a];return c},getFrame:function(){var a=this;return a.iframeEl.dom},beforeDestroy:function(){this.cleanupListeners(true);this.callParent()},cleanupListeners:function(c){var b,d;if(this.rendered){try{b=this.getDoc();if(b){Ext.get(b).un(this._docListeners);if(c){for(d in b){if(b.hasOwnProperty&&b.hasOwnProperty(d)){delete b[d]}}}}}catch(a){}}},onLoad:function(){var b=this,d=b.getDoc(),a=b.onRelayedEvent;if(d){try{Ext.get(d).on(b._docListeners={mousedown:a,mousemove:a,mouseup:a,click:a,dblclick:a,scope:b})}catch(c){}Ext.get(this.getWin()).on("beforeunload",b.cleanupListeners,b);this.el.unmask();this.fireEvent("load",this)}else{if(b.src){this.el.unmask();this.fireEvent("error",this)}}},onRelayedEvent:function(c){var b=this.iframeEl,d=b.getTrueXY(),e=c.getXY(),a=c.getTrueXY();c.xy=[d[0]+a[0],d[1]+a[1]];c.injectEvent(b);c.xy=e},load:function(d){var a=this,c=a.loadMask,b=a.getFrame();if(a.fireEvent("beforeload",a,d)!==false){if(c&&a.el){a.el.mask(c)}b.src=a.src=(d||a.src)}}});Ext.define("Ext.ux.Image",{extend:"Ext.Component",autoEl:{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"tng-managed-image"},onRender:function(){Ext.ux.Image.superclass.onRender.apply(this,arguments);this.el.on("load",this.onLoad,this);if(this.url){this.setSrc(this.url)}},onLoad:function(){this.fireEvent("load",this)},setSrc:function(a){if(this.rendered){this.el.dom.src=a}else{this.url=a}}});Ext.define("Ext.ux.grid.PageSize",{extend:"Ext.form.field.ComboBox",alias:"plugin.pagesize",beforeText:"Show",afterText:"rows/page",mode:"local",displayField:"text",valueField:"value",allowBlank:false,triggerAction:"all",width:65,editable:false,maskRe:/[0-9]/,init:function(a){a.on("afterrender",this.onInitView,this)},store:new Ext.data.SimpleStore({fields:["text","value"],data:[["10",10],["20",20],["30",30],["50",50],["100",100],["500",500],["1000",1000]]}),onInitView:function(a){this.setValue(a.store.pageSize);a.add("-",this.beforeText,this,this.afterText);this.on("select",this.onPageSizeChanged,a);this.on("specialkey",function(c,b){if(13===b.getKey()){this.onPageSizeChanged.call(a,this)}})},onPageSizeChanged:function(a){this.store.pageSize=parseInt(a.getRawValue(),10);this.store.currentPage=1;this.doRefresh()}});Ext.define("Ext.ux.panel.PDF",{extend:"Ext.panel.Panel",alias:"widget.pdfpanel",extraBaseCls:Ext.baseCSSPrefix+"pdf",extraBodyCls:Ext.baseCSSPrefix+"pdf-body",autoScroll:true,xtype:"uxPanelPdf",src:"",pageScale:1,disableWorker:true,disableTextLayer:true,loadingMessage:"Loading PDF, please wait...",beforePageText:"Page",afterPageText:"of {0}",firstText:"First Page",prevText:"Previous Page",nextText:"Next Page",lastText:"Last Page",inputItemWidth:30,scaleWidth:60,getPagingItems:function(){var a=this;return[{itemId:"first",tooltip:a.firstText,overflowText:a.firstText,iconCls:Ext.baseCSSPrefix+"tbar-page-first",disabled:true,handler:a.moveFirst,scope:a},{itemId:"prev",tooltip:a.prevText,overflowText:a.prevText,iconCls:Ext.baseCSSPrefix+"tbar-page-prev",disabled:true,handler:a.movePrevious,scope:a},"-",a.beforePageText,{xtype:"numberfield",itemId:"inputItem",name:"inputItem",cls:Ext.baseCSSPrefix+"tbar-page-number",allowDecimals:false,minValue:1,hideTrigger:true,enableKeyEvents:true,keyNavEnabled:false,selectOnFocus:true,submitValue:false,isFormField:false,width:a.inputItemWidth,margins:"-1 2 3 2",disabled:true,listeners:{scope:a,keydown:a.onPagingKeyDown,blur:a.onPagingBlur}},{xtype:"tbtext",itemId:"afterTextItem",text:Ext.String.format(a.afterPageText,1),margins:"0 5 0 0"},"-",{itemId:"next",tooltip:a.nextText,overflowText:a.nextText,iconCls:Ext.baseCSSPrefix+"tbar-page-next",disabled:true,handler:a.moveNext,scope:a},{itemId:"last",tooltip:a.lastText,overflowText:a.lastText,iconCls:Ext.baseCSSPrefix+"tbar-page-last",disabled:true,handler:a.moveLast,scope:a},"->",{itemId:"scaleCombo",xtype:"combobox",editable:false,keyNavEnabled:true,selectOnFocus:false,submitValue:false,isFormField:false,autoSelect:true,disabled:true,width:a.scaleWidth,store:new Ext.data.SimpleStore({id:0,fields:["scale","text"],data:[[0.5,"50%"],[0.75,"75%"],[1,"100%"],[1.25,"125%"],[1.5,"150%"],[2,"200%"]]}),valueField:"scale",displayField:"text",mode:"local",listeners:{scope:a,change:a.onScaleChange,blur:a.onScaleBlur}}]},initComponent:function(){var c=this,e=c.getPagingItems(),b=c.items||[],a=c.dockedItems||[];c.bodyCls=c.bodyCls||"";c.bodyCls+=(" "+c.extraBodyCls);c.cls=c.cls||"";c.cls+=(" "+c.extraBaseCls);PDFJS.disableTextLayer=c.disableTextLayer;a.push({itemId:"pagingToolbar",xtype:"toolbar",dock:"bottom",items:e});c.dockedItems=a;var d="";if(!PDFJS.disableTextLayer){d='<div class="pdf-text-layer"></div>'}b.push({itemId:"pdfPageContainer",xtype:"container",width:"100%",height:"100%",html:'<canvas class="pdf-page-container"></canvas>'+d,listeners:{afterrender:function(){c.pageContainer=this.el.query(".pdf-page-container")[0];c.pageContainer.mozOpaque=true;var f=c.pageContainer.getContext("2d");f.save();f.fillStyle="rgb(255, 255, 255)";f.fillRect(0,0,c.pageContainer.width,c.pageContainer.height);f.restore();if(!PDFJS.disableTextLayer){c.textLayerDiv=this.el.query(".pdf-text-layer")[0]}}}});c.items=b;c.callParent(arguments);c.on("boxready",function(){c.loader=new Ext.LoadMask(c.child("#pdfPageContainer"),{msg:c.loadingMessage});c.loader.show()},c,{single:true});if(c.disableWorker){PDFJS.disableWorker=true}c.getDocument()},onLoad:function(){try{var b=this,c;c=b.pdfDoc.numPages===0;b.currentPage=b.currentPage||(c?0:1);b.renderPage(b.currentPage)}catch(a){Ext.log({level:"warning"},"PDF: Can't render: "+a.message)}},renderPage:function(d){var f=this,e=f.child("#pagingToolbar"),g,c,b,a;if(f.isRendering){return}f.isRendering=true;f.currentPage=d;b=f.currentPage;c=f.pdfDoc.numPages;a=Ext.String.format(f.afterPageText,isNaN(c)?1:c);g=c===0;Ext.suspendLayouts();e.child("#afterTextItem").setText(a);e.child("#inputItem").setDisabled(g).setValue(b);e.child("#first").setDisabled(b===1||g);e.child("#prev").setDisabled(b===1||g);e.child("#next").setDisabled(b===c||g);e.child("#last").setDisabled(b===c||g);e.child("#scaleCombo").setDisabled(g).setValue(f.pageScale);f.pdfDoc.getPage(d).then(function(k){if(!f.pageContainer){Ext.log({level:"warning"},"PDF: pageContainer not ready to render page.");Ext.resumeLayouts(true);f.isRendering=false;return}var h=k.getViewport(f.pageScale);f.pageContainer.height=h.height;f.pageContainer.width=h.width;var i=f.pageContainer.getContext("2d");i.save();i.fillStyle="rgb(255, 255, 255)";i.fillRect(0,0,f.pageContainer.width,f.pageContainer.height);i.restore();var l=f.textLayerDiv?Ext.create("Ext.ux.util.PDF.TextLayerBuilder",{textLayerDiv:f.textLayerDiv}):null;var j={canvasContext:i,viewport:h,textLayer:l};k.render(j);Ext.resumeLayouts(true);f.isRendering=false;if(f.loader){f.loader.destroy()}if(f.rendered){f.fireEvent("change",f,{current:f.currentPage,total:f.pdfDoc.numPages})}})},moveFirst:function(){var a=this;if(a.fireEvent("beforechange",a,1)!==false){a.renderPage(1)}},movePrevious:function(){var b=this,a=b.currentPage-1;if(a>0){if(b.fireEvent("beforechange",b,a)!==false){b.renderPage(a)}}},moveNext:function(){var c=this,b=c.pdfDoc.numPages,a=c.currentPage+1;if(a<=b){if(c.fireEvent("beforechange",c,a)!==false){c.renderPage(a)}}},moveLast:function(){var b=this,a=b.pdfDoc.numPages;if(b.fireEvent("beforechange",b,a)!==false){b.renderPage(a)}},readPageFromInput:function(){var b=this,a=b.child("#pagingToolbar").child("#inputItem").getValue(),c=parseInt(a,10);if(!a||isNaN(c)){b.child("#pagingToolbar").child("#inputItem").setValue(b.currentPage);return false}return c},onPagingFocus:function(){this.child("#pagingToolbar").child("#inputItem").select()},onPagingBlur:function(b){var a=this.getPageData().currentPage;this.child("#pagingToolbar").child("#inputItem").setValue(a)},onPagingKeyDown:function(h,g){var d=this,b=g.getKey(),a=g.shiftKey?10:1,f,c=d.pdfDoc.numPages;if(b==g.RETURN){g.stopEvent();f=d.readPageFromInput();if(f!==false){f=Math.min(Math.max(1,f),c);if(d.fireEvent("beforechange",d,f)!==false){d.renderPage(f)}}}else{if(b==g.HOME||b==g.END){g.stopEvent();f=b==g.HOME?1:c;h.setValue(f)}else{if(b==g.UP||b==g.PAGE_UP||b==g.DOWN||b==g.PAGE_DOWN){g.stopEvent();f=d.readPageFromInput();if(f){if(b==g.DOWN||b==g.PAGE_DOWN){a*=-1}f+=a;if(f>=1&&f<=c){h.setValue(f)}}}}}},onScaleBlur:function(a){this.child("#pagingToolbar").child("#scaleCombo").setValue(this.pageScale)},onScaleChange:function(c,b){var a=this;a.pageScale=b;a.renderPage(a.currentPage)},setSrc:function(a){this.src=a;return this.getDocument()},getDocument:function(){var a=this;if(!!a.src){PDFJS.getDocument(a.src).then(function(b){a.pdfDoc=b;a.onLoad()})}return a}});Ext.define("Ext.ux.util.PDF.TextLayerBuilder",{textLayerDiv:null,constructor:function(a){this.textLayerDiv=a.textLayerDiv},beginLayout:function(){this.textDivs=[];this.textLayerQueue=[]},endLayout:function(){var h=this,i=h.textDivs,g=h.textLayerDiv,a=null,j=false,k=0,d=500,b=document.createElement("canvas"),l=b.getContext("2d");function c(){if(i.length===0){clearInterval(a);j=true;h.textLayerDiv=g=b=l=null;return}var o=i.shift();if(o.dataset.textLength>0){g.appendChild(o);if(o.dataset.textLength>1){l.font=o.style.fontSize+" sans-serif";var p=l.measureText(o.textContent).width;var n=o.dataset.canvasWidth/p;var q=(function(){if("result" in arguments.callee){return arguments.callee.result}var r=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/;var t=document.getElementsByTagName("script")[0];for(var s in t.style){if(r.test(s)){return arguments.callee.result=s.match(r)[0]}}if("WebkitOpacity" in t.style){return arguments.callee.result="Webkit"}if("KhtmlOpacity" in t.style){return arguments.callee.result="Khtml"}return arguments.callee.result=""})();var m=Ext.get(o);m.setStyle(q+"-transform","scale("+n+", 1)");m.setStyle(q+"-transformOrigin","0% 0%")}}}a=setInterval(c,k);var f=null;function e(){if(j){window.removeEventListener("scroll",e,false);return}clearInterval(a);clearTimeout(f);f=setTimeout(function m(){a=setInterval(c,k)},d)}window.addEventListener("scroll",e,false)},appendText:function(e,c,d){var a=document.createElement("div");var b=d*e.geom.vScale;a.dataset.canvasWidth=e.canvasWidth*e.geom.hScale;a.dataset.fontName=c;a.style.fontSize=b+"px";a.style.left=e.geom.x+"px";a.style.top=(e.geom.y-b)+"px";a.textContent=PDFJS.bidi(e,-1);a.dir=e.direction;a.dataset.textLength=e.length;this.textDivs.push(a)}});
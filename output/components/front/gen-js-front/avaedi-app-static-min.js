Ext.define("At4FrameworkIntranet.Application",{extend:"At4FrameworkIntranet.At4FrameworkIntranet",headerImageWidth:260,toolbarHeight:40,showUserLogoutButton:false,showTemaButton:false,showLangButton:false,responsiveMenu:false,availableLangs:["ca","es"],constructor:function(){this.customToolbarButton={tooltip:(this.idioma=="en"?"English":this.idioma=="es"?"Castellano":"Català"),cls:"at4-menuButton",text:"Inicio",iconCls:"glyphicons glyphicons-modal-window",menu:Ext.create("Ext.menu.Menu",{cls:"at4-headerMenu",items:[{text:"Idioma",iconCls:"glyphicons glyphicons-globe-af",menu:[{id:"langButtonEN",text:"English",checked:(this.idioma=="en"?true:false),group:"idioma",handler:null,scope:this,hidden:this.availableLangs.indexOf("en")==-1,checkHandler:this.onChangeLang},{id:"langButtonES",text:"Castellano",checked:(this.idioma=="es"?true:false),handler:null,group:"idioma",scope:this,hidden:this.availableLangs.indexOf("es")==-1,checkHandler:this.onChangeLang},{id:"langButtonCA",text:"Català",checked:(this.idioma=="ca"?true:false),handler:null,group:"idioma",scope:this,hidden:this.availableLangs.indexOf("ca")==-1,checkHandler:this.onChangeLang}]},{iconCls:"glyphicons glyphicons-server-ban",text:this.olvidarEstadosTexto,id:"stateResetButton",scope:this,handler:function(){Ext.Msg.show({title:this.borrarestadAplicacion,message:this.mensajeReset,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,scope:this,fn:function(a){if(a==="yes"){Ext.MessageBox.wait("Recargando","Espere..");var b=Ext.state.Manager.getProvider();for(var c in b.state){Ext.state.Manager.clear(c)}Ext.state.Manager.getProvider().on("savesuccess",function(){window.location.reload()},this)}}})},}]})};this.callParent(arguments)},openMenuFormItem:function(a){if(!a.link){if(a.mode==="plain"){if(a.form=="openImportForm"){var b=Ext.create("At4FrameworkIntranet.ImportIeeWindow");b.show();return}if(a.form=="openImportSubForm"){var b=Ext.create("At4FrameworkIntranet.SubsanacioWindow");b.show();return}if(a.form=="openImportIteForm"){var b=Ext.create("At4FrameworkIntranet.ImportIteWindow");b.show();return}}}this.callParent(arguments)}});Ext.namespace("At4FrameworkIntranet");Ext.apply(At4FrameworkIntranet.FormDefaults,{NUMBER_FIELD_WIDTH:59,VERY_LARGE_TEXT_FIELD_WIDTH:654,LARGE_TEXT_FIELD_WIDTH:487,TEXT_FIELD_WIDTH:320,YMEDIO_TEXT_FIELD_WIDTH:490,MEDIUM_TEXT_FIELD_WIDTH:208,SMALL_TEXT_FIELD_WIDTH:152,SMALL_TEXTAREA_FIELD_WIDTH:432,TEXTAREA_FIELD_WIDTH:654,TEXTAREA_FIELD_HEIGHT:150,ITEMSELECTOR_FIELD_WIDTH:318,DECIMAL_SEPARATOR:","});Ext.define("At4FrameworkIntranet.InspeccionBaseForm",{extend:"At4FrameworkIntranet.BasicForm",edificioHeaderLabel:"Edificio"});Ext.define("At4FrameworkIntranet.ImportIeeWindow",{extend:"At4FrameworkIntranet.Window",title:"Dar de alta una Inspección",closable:false,closeAction:"destroy",height:400,width:600,resizable:false,modal:true,cls:"importarieewindow",constructor:function(a){var c=this;var b=Ext.create("At4FrameworkIntranet.ImportIeeForm");b.cancelarButton=Ext.create({text:"Cancelar",xtype:"button",handler:function(d,e){b.cancelarClick(b,d,e,c)}});b.avanzarButton=Ext.create({xtype:"button",text:"Siguiente",scope:c,ventanaScope:c,handler:function(d,e){b.avanzarClick(b,d,e,c)}});b.cerrarButton=Ext.create({xtype:"button",text:"Cerrar",scope:c,ventanaScope:c,handler:function(d,e){b.cerrarClick(b,d,e,c)}});b.changeButtons(1);c.items=[b];c.buttons=[b.cancelarButton,b.avanzarButton,b.cerrarButton];c.callParent(arguments);b.ventanaScope=c}});Ext.define("At4FrameworkIntranet.ImportIeeForm",{extend:"Ext.panel.Panel",layout:"card",cls:"importariee",activeItem:0,requestactive:false,changeButtons:function(a){var e=this.cancelarButton;var c=this.avanzarButton;var b=this.cerrarButton;var d=["alert","info","done","warn"];e.removeCls(d);c.removeCls(d);b.removeCls(d);switch(a){case 1:e.setText("Cancelar");c.setText("Siguiente");e.addCls("alert");c.addCls("info");b.hide();break;case 2:e.setText("Cancelar");c.setText("Reintentar");e.addCls("alert");c.addCls("warn");b.hide();break;case 3:e.setText("Revertir");c.setText("Guardar y abrir informe");b.setText("Guardar y cerrar");e.addCls("alert");c.addCls("done");b.addCls("info");b.show();break}},acciones:{enviarImportacion:function(){var e=this.getLayout();var c=this.primerFormFields.documentoIee;var f=this.primerFormFields.documentoPdf;var g=c.isValid();var b=f.isValid();if(!g||!b){return}var a=c.getTrigger("filebutton").component.fileInputEl.dom;var d=f.getTrigger("filebutton").component.fileInputEl.dom;if(!this.requestactive){this.requestactive=true;serverDatabaseActions.runAction(FormDataService.importIee,[a,d],function(l,j){var i=1;this.requestactive=false;if(!l.correcto){this.changeButtons(2);var h="<div class='ko-invalid'><span class='glyphicons glyphicons-remove-circle'></span>{0}</div>";var k=h.replace("{0}",l.errorMsg);this.tercerFormItems.box.update(k);this.tercerFormItems.logField.setValue(l.errorHtml);i=2}else{i=1;this.loadIee(l);this.changeButtons(3)}this.activeItem=i;e.setActiveItem(i)}.bind(this))}else{console.info("Se han intentado enviar diversas solicitudes de importacion")}},guardarYCerrar:function(){if(!this.requestactive){this.submitSaveImport(function(a){this.requestactive=false;this.ventanaScope.destroy()})}else{console.info("Se han intentado enviar diversas solicitudes de guardar datos")}},guardarYAbrir:function(){if(!this.requestactive){this.submitSaveImport(function(a){this.ventanaScope.destroy();At4FrameworkIntranet.app.openRecordForm(this.formItem,{oid:a.claveInforme})})}else{console.info("Se han intentado enviar diversas solicitudes de guardar datos")}},errorReintentar:function(){var a=this.getLayout();this.changeButtons(1);this.activeItem=0;a.setActiveItem(0);this.primerFormFields.documentoIee.reset();this.primerFormFields.documentoPdf.reset()},cerrarVentana:function(){this.ventanaScope.destroy()},cancelarImportacionActiva:function(){serverDatabaseActions.runAction(FormDataService.cancelImport,[this.claveInforme],function(a){if(a){this.acciones.cerrarVentana.call(this);Ext.Msg.alert("Correcto","Importacion revertida")}else{this.acciones.cerrarVentana.call(this);Ext.Msg.alert("Advertencia","No se pudo revertir la importación, por favor contacte con un administrador")}},serverDatabaseActions.exceptionHandler,this)}},avanzarClick:function(d,a,c,b){if(this.activeItem==0){this.acciones.enviarImportacion.call(this)}else{if(this.activeItem==1){this.acciones.guardarYAbrir.call(this)}else{if(this.activeItem==2){this.acciones.errorReintentar.call(this)}}}},cerrarClick:function(d,a,c,b){if(this.activeItem==0){}else{if(this.activeItem==1){this.acciones.guardarYCerrar.call(this)}else{if(this.activeItem==2){}}}},cancelarClick:function(d,a,c,b){if(this.activeItem==0){this.acciones.cerrarVentana.call(this)}else{if(this.activeItem==1){this.acciones.cancelarImportacionActiva.call(this)}else{if(this.activeItem==2){this.acciones.cerrarVentana.call(this)}}}},submitSaveImport:function(d){if(!this.segundoFormItems.estadoInforme.validate()||(this.segundoFormItems.nuevoEdificioAction.isVisible()&&!this.segundoFormItems.nuevoEdificioAction.validate())||(this.segundoFormItems.numeroExtra.isVisible()&&!this.segundoFormItems.numeroExtra.validate())){return}this.requestactive=true;var b=this.segundoFormItems.estadoInforme.getValue();var a=this.segundoFormItems.numeroExtra.getValue();var c=this.segundoFormItems.nuevoEdificioAction.getValue();serverDatabaseActions.runAction(FormDataService.saveImport,[this.claveInforme,b,a,c],d.bind(this),this)},loadIee:function(e){this.claveInforme=e.primaryKey;var c=3;var f=e.estadoInformeDisponibles;var g=Ext.create("Ext.data.Store",{fields:["clave","nombreEs","nombreCa"],data:f});for(var h in f){if(f.hasOwnProperty(h)){var a=f[h];if(a.clave!=3){c=a.clave}}}var i=e.edificiosDisponibles;var d=e.edificiosDisponibles[0];i.unshift({clave:-1,primaryLabel:"[Crear un nuevo registro]",numeroExtra:d.numeroExtra,numeroCatastro:d.numeroCatastro,viaLabel:d.viaLabel,});var b=Ext.create("Ext.data.Store",{fields:["clave","primaryLabel","numeroExtra","numeroCatastro","viaLabel"],data:i});this.segundoFormItems.nuevoEdificioAction.setStore(b);this.segundoFormItems.estadoInforme.setStore(g);this.segundoFormItems.estadoInforme.setValue(c);this.segundoFormItems.nuevoEdificio.setHidden(!e.edificioExistia);this.segundoFormItems.nuevoEdificioAction.setHidden(!e.edificioExistia);this.segundoFormItems.nuevoEdificioAction.setValue(-1);this.segundoFormItems.numeroExtra.setHidden(!e.edificioExistia)},constructor:function(d){Ext.apply(this,d);var e=new At4util.tabIndexHelper(this.tabIndex);var a={};a.documentoIee=Ext.create({allowBlank:false,width:500,margin:"0 30px",xtype:"filefield",name:"fileIEE"});a.documentoPdf=Ext.create({allowBlank:false,margin:"0 30px",xtype:"filefield",width:500,name:"filePDF"});var b=Ext.create("Ext.data.Store",{fields:["abbr","name"],data:[{abbr:"0",name:"--"},{abbr:"30",name:"30"},{abbr:"50",name:"50"}]});a.tipusIee=Ext.create({allowBlank:false,width:500,margin:"0 30px",xtype:"combobox",store:b,queryMode:"local",displayField:"name",valueField:"abbr",autoSelect:true,editable:false,forceSelection:true,name:"tipusIee"});a.renovacio=Ext.create({margin:"0 30px",xtype:"checkbox",name:"renovacio",boxLable:"renovación"});this.primerFormFields=a;var c=[{xtype:"At4Framework-fieldmainpanel",items:[At4FrameworkIntranet.FormDefaults.rows([[{xtype:"container",margin:"15px 15px 0px 30px",html:"<span class='iee'><span class='icono iee'></span><span class='texto'>Documento IEE </span>(.iee)</span>"}],[a.documentoIee],[{xtype:"container",margin:"15px 15px 0px 30px",html:"<span class='iee'><span class='icono pdf'></span><span class='texto'>Documento PDF </span>(.pdf)</span>"}],[a.documentoPdf],[{xtype:"container",margin:"15px 15px 0px 30px",html:"<span class='iee'><span class='texto'>Tipo IEE </span></span>"}],[a.tipusIee],[{xtype:"container",margin:"15px 15px 0px 30px",html:"<span class='iee'><span class='texto'>Es renovación </span></span>"}],[a.renovacio],[{xtype:"container",margin:"15px 0 0 15px",width:500,html:"<span class='regimg'></span>"}]],{},{minWidth:null,})]}];var k={};k.numeroCatastro=new Ext.form.TextField({name:"numeroCatastro",fieldLabel:"Numero catastro",labelAttrTpl:" data-qtip='"+this.numeroCatastroDescriptionLabel+"'",tabIndex:e.getNext(),editable:false,width:At4FrameworkIntranet.FormDefaults.size(3,2,12),maxLength:64});k.via=new Ext.form.TextField({name:"viaId",fieldLabel:"Via",tabIndex:e.getNext(),editable:false,width:At4FrameworkIntranet.FormDefaults.size(4,2,12)});k.numeroExtra=new Ext.form.TextField({name:"numeroExtra",fieldLabel:"Numero extra",tabIndex:e.getNext(),allowBlank:false,width:At4FrameworkIntranet.FormDefaults.size(4,2,12),maxLength:64});k.estadoInforme=Ext.create("Ext.form.field.ComboBox",{name:"estadoInformeId",fieldLabel:"Estado del informe",tabIndex:e.getNext(),width:At4FrameworkIntranet.FormDefaults.size(3,2,12),allowBlank:false,valueField:"clave",displayField:At4FrameworkIntranet.app.idioma==="ca"?"nombreCa":"nombreEs",});k.resultado=Ext.create({xtype:"container",width:At4FrameworkIntranet.FormDefaults.size(7,0,12),height:"auto",html:'<div class="ok-valid"><span class="glyphicons glyphicons-ok-circle"></span><div class="mensaje"> Subida de informe realizada con éxito.<span class="block">Por favor, compruebe los siguientes datos:</span></div></div>'});k.nuevoEdificio=Ext.create({xtype:"container",height:"auto",hidden:true,width:At4FrameworkIntranet.FormDefaults.size(7,0,12),html:'<div class="edificio-existente"><span class="glyphicons glyphicons-warning-sign"></span>El edificio ya existia</span></div>'});k.nuevoEdificioAction=Ext.create("Ext.form.field.ComboBox",{name:"nuevoEdificioAction",tabIndex:e.getNext(),width:At4FrameworkIntranet.FormDefaults.size(7,0,12),allowBlank:false,queryMode:"local",hidden:true,displayField:"primaryLabel",valueField:"clave",listeners:{change:{fn:function(o,q,m,n){var l=o.getSelectedRecord();if(!l){return}var p=l.getData();if(p.clave===-1){this.segundoFormItems.numeroExtra.show()}else{this.segundoFormItems.numeroExtra.hide()}this.segundoFormItems.via.setValue(p.viaLabel);this.segundoFormItems.numeroCatastro.setValue(p.numeroCatastro)},scope:this}}});this.segundoFormItems=k;var g={xtype:"At4Framework-fieldmainpanel",items:[{xtype:"At4Framework-rowContainer",items:[k.resultado],margin:"10px 40px"},{xtype:"At4Framework-rowContainer",items:[k.estadoInforme,k.numeroExtra],margin:"10px 40px"},{xtype:"At4Framework-rowContainer",items:[k.nuevoEdificio],margin:"0 40px"},{xtype:"At4Framework-rowContainer",items:[k.nuevoEdificioAction],margin:"0 40px"},{xtype:"At4Framework-rowContainer",items:[k.via,k.numeroCatastro],margin:"10px 40px"}]};var i={};i.box=Ext.create({xtype:"container",width:"100%",html:"Step 3",margin:"10px 40px"});i.logField=Ext.create({xtype:"htmleditor",cls:"out log",editable:false,width:"100%",value:"<br>",readOnly:true,listeners:{render:{scope:this,fn:function(){i.logField.getToolbar().hide()}},initialize:function(l){var m={"font-family":"monospace","background-color":"#eeeeee"};Ext.DomHelper.applyStyles(l.getEditorBody(),m)}}});var j=Ext.create({xtype:"fieldset",width:"100%",border:true,collapsible:true,collapsed:true,title:"Traza del error",items:[i.logField],});this.tercerFormItems=i;var f=At4FrameworkIntranet.FormDefaults.rows([[this.tercerFormItems.box],[j]],{},{minWidth:null,});var h=[{items:c},{items:g},{items:f}];this.items=h;this.callParent()},formItem:{form:"informe",href:null,iconCls:"glyphicons glyphicons-newspaper",id:null,link:false,menu:null,mode:"list",parameters:null,text:"Informe"}});window.testIee={claveInforme:1607,correcto:true,creatorUser:null,dateCreation:null,edificioExistia:true,edificiosDisponibles:[{clave:-1,primaryLabel:"[Crear un nuevo registro]",numeroExtra:"Obligado",numeroCatastro:"79",viaLabel:"CONQUISTADOR",id:"extModel224-1"},{antiguedad:0,centroX:486776,centroY:4392639,clave:706,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1561,creatorUser:"admin",dateCreation:"2017-01-10T09:53:11.732Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:3,estadoInformeLabel:"En tramitación",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1562,ieeArxiuMime:"application/octet-stream",inspeccionId:1561,inspeccionLabel:"1561",lastModified:"2017-01-10T09:53:11.732Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1561,pdfArxiuMime:"application/pdf",primaryKey:1561,primaryLabel:"1561"},{clave:1544,creatorUser:"admin",dateCreation:"2017-01-10T09:28:23.898Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1548,ieeArxiuMime:"application/octet-stream",inspeccionId:1544,inspeccionLabel:"1544",lastModified:"2017-01-10T09:28:23.898Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1547,pdfArxiuMime:"application/pdf",primaryKey:1544,primaryLabel:"1544"},{clave:1604,creatorUser:"admin",dateCreation:"2017-01-10T11:39:09.504Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1588,ieeArxiuMime:"application/octet-stream",inspeccionId:1604,inspeccionLabel:"1604",lastModified:"2017-01-10T11:39:09.504Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1587,pdfArxiuMime:"application/pdf",primaryKey:1604,primaryLabel:"1604"},{clave:1605,creatorUser:"admin",dateCreation:"2017-01-10T11:41:24.947Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1590,ieeArxiuMime:"application/octet-stream",inspeccionId:1605,inspeccionLabel:"1605",lastModified:"2017-01-10T11:41:24.947Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1589,pdfArxiuMime:"application/pdf",primaryKey:1605,primaryLabel:"1605"},{clave:1606,creatorUser:"admin",dateCreation:"2017-01-10T11:45:15.687Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1592,ieeArxiuMime:"application/octet-stream",inspeccionId:1606,inspeccionLabel:"1606",lastModified:"2017-01-10T11:45:15.687Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1591,pdfArxiuMime:"application/pdf",primaryKey:1606,primaryLabel:"1606"},{clave:1602,creatorUser:"admin",dateCreation:"2017-01-10T11:24:39.466Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1584,ieeArxiuMime:"application/octet-stream",inspeccionId:1602,inspeccionLabel:"1602",lastModified:"2017-01-10T11:24:39.466Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1583,pdfArxiuMime:"application/pdf",primaryKey:1602,primaryLabel:"1602"},{clave:1521,creatorUser:"admin",dateCreation:"2017-01-10T08:50:26.479Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1522,ieeArxiuMime:"application/octet-stream",inspeccionId:1521,inspeccionLabel:"1521",lastModified:"2017-01-10T08:50:26.479Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1521,pdfArxiuMime:"application/pdf",primaryKey:1521,primaryLabel:"1521"},{clave:1522,creatorUser:"admin",dateCreation:"2017-01-10T08:56:35.920Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1524,ieeArxiuMime:"application/octet-stream",inspeccionId:1522,inspeccionLabel:"1522",lastModified:"2017-01-10T08:56:35.920Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1523,pdfArxiuMime:"application/pdf",primaryKey:1522,primaryLabel:"1522"},{clave:1523,creatorUser:"admin",dateCreation:"2017-01-10T08:57:08.424Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1526,ieeArxiuMime:"application/octet-stream",inspeccionId:1523,inspeccionLabel:"1523",lastModified:"2017-01-10T08:57:08.424Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1525,pdfArxiuMime:"application/pdf",primaryKey:1523,primaryLabel:"1523"},{clave:1601,creatorUser:"admin",dateCreation:"2017-01-10T11:13:47.550Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:3,estadoInformeLabel:"En tramitación",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1582,ieeArxiuMime:"application/octet-stream",inspeccionId:1601,inspeccionLabel:"1601",lastModified:"2017-01-10T11:13:47.550Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1581,pdfArxiuMime:"application/pdf",primaryKey:1601,primaryLabel:"1601"},{clave:1603,creatorUser:"admin",dateCreation:"2017-01-10T11:24:58.788Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1586,ieeArxiuMime:"application/octet-stream",inspeccionId:1603,inspeccionLabel:"1603",lastModified:"2017-01-10T11:24:58.788Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1585,pdfArxiuMime:"application/pdf",primaryKey:1603,primaryLabel:"1603"},{clave:1541,creatorUser:"admin",dateCreation:"2017-01-10T09:05:04.892Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1542,ieeArxiuMime:"application/octet-stream",inspeccionId:1541,inspeccionLabel:"1541",lastModified:"2017-01-10T09:05:04.892Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1541,pdfArxiuMime:"application/pdf",primaryKey:1541,primaryLabel:"1541"},{clave:1542,creatorUser:"admin",dateCreation:"2017-01-10T09:20:20.546Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1544,ieeArxiuMime:"application/octet-stream",inspeccionId:1542,inspeccionLabel:"1542",lastModified:"2017-01-10T09:20:20.546Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1543,pdfArxiuMime:"application/pdf",primaryKey:1542,primaryLabel:"1542"},{clave:1543,creatorUser:"admin",dateCreation:"2017-01-10T09:25:17.582Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1546,ieeArxiuMime:"application/octet-stream",inspeccionId:1543,inspeccionLabel:"1543",lastModified:"2017-01-10T09:25:17.582Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1545,pdfArxiuMime:"application/pdf",primaryKey:1543,primaryLabel:"1543"},{clave:1185,creatorUser:"admin",dateCreation:"2016-12-05T15:06:44.769Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2016-12-04T23:00:00.000Z",fechaInforme:"2016-12-04T23:00:00.000Z",ieeArxiu:1150,ieeArxiuMime:"application/octet-stream",inspeccionId:1185,inspeccionLabel:"1185",lastModified:"2016-12-05T15:06:44.769Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1149,pdfArxiuMime:"application/pdf",primaryKey:1185,primaryLabel:"1185"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:"Obligado",primaryKey:706,primaryLabel:"CONQUISTADOR, 79 (Obligado)",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-2"},{antiguedad:0,centroX:486776,centroY:4392639,clave:861,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1501,creatorUser:"admin",dateCreation:"2017-01-10T08:12:57.222Z",edificioId:861,edificioLabel:"CONQUISTADOR, 79",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1502,ieeArxiuMime:"application/octet-stream",inspeccionId:1501,inspeccionLabel:"1501",lastModified:"2017-01-10T08:12:57.222Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1501,pdfArxiuMime:"application/pdf",primaryKey:1501,primaryLabel:"1501"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:null,primaryKey:861,primaryLabel:"CONQUISTADOR, 79",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-3"},{antiguedad:0,centroX:486776,centroY:4392639,clave:663,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:null,primaryKey:663,primaryLabel:"CONQUISTADOR, 79",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-4"},{antiguedad:0,centroX:486776,centroY:4392639,clave:664,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1143,creatorUser:"admin",dateCreation:"2016-12-05T13:56:39.777Z",edificioId:664,edificioLabel:"CONQUISTADOR, 79",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2016-12-04T23:00:00.000Z",fechaInforme:"2016-12-04T23:00:00.000Z",ieeArxiu:1106,ieeArxiuMime:"application/octet-stream",inspeccionId:1143,inspeccionLabel:"1143",lastModified:"2016-12-05T13:56:39.777Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1105,pdfArxiuMime:"application/pdf",primaryKey:1143,primaryLabel:"1143"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:null,primaryKey:664,primaryLabel:"CONQUISTADOR, 79",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-5"},{antiguedad:0,centroX:486776,centroY:4392639,clave:862,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1524,creatorUser:"admin",dateCreation:"2017-01-10T08:58:36.450Z",edificioId:862,edificioLabel:"CONQUISTADOR, 79",estadoInformeId:4,estadoInformeLabel:"Anulado",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1528,ieeArxiuMime:"application/octet-stream",inspeccionId:1524,inspeccionLabel:"1524",lastModified:"2017-01-10T09:01:57.527Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1527,pdfArxiuMime:"application/pdf",primaryKey:1524,primaryLabel:"1524"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:null,primaryKey:862,primaryLabel:"CONQUISTADOR, 79",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-6"},{antiguedad:0,centroX:486776,centroY:4392639,clave:881,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1545,creatorUser:"admin",dateCreation:"2017-01-10T09:29:05.151Z",edificioId:881,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1550,ieeArxiuMime:"application/octet-stream",inspeccionId:1545,inspeccionLabel:"1545",lastModified:"2017-01-10T09:29:05.151Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1549,pdfArxiuMime:"application/pdf",primaryKey:1545,primaryLabel:"1545"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:"Obligado",primaryKey:881,primaryLabel:"CONQUISTADOR, 79 (Obligado)",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-7"}],errorHtml:null,errorMsg:null,estadoInformeDisponibles:[{clave:3,creatorUser:null,dateCreation:"2016-10-10T13:15:23.000Z",lastModified:"2016-10-10T13:15:23.000Z",modUser:null,nombreCa:"En tramitació",nombreEs:"En tramitación",primaryKey:3,primaryLabel:"En tramitación",id:"extModel222-1"},{clave:2,creatorUser:null,dateCreation:"2016-10-10T13:15:23.000Z",lastModified:"2016-10-10T13:15:23.000Z",modUser:null,nombreCa:"Desfavorable",nombreEs:"Desfavorable",primaryKey:2,primaryLabel:"Desfavorable",id:"extModel222-2"}],estadoInformeId:5,estadoInformeLabel:"En curso",lastModified:null,modUser:null,primaryKey:1607,primaryLabel:"En curso"};Ext.define("At4FrameworkIntranet.ImportIteWindow",{extend:"At4FrameworkIntranet.Window",title:"Dar de alta una Inspección",closable:false,closeAction:"destroy",height:400,width:600,resizable:false,modal:true,cls:"importarieewindow",constructor:function(a){var c=this;var b=Ext.create("At4FrameworkIntranet.ImportIteForm");b.cancelarButton=Ext.create({text:"Cancelar",xtype:"button",handler:function(d,e){b.cancelarClick(b,d,e,c)}});b.avanzarButton=Ext.create({xtype:"button",text:"Siguiente",scope:c,ventanaScope:c,handler:function(d,e){b.avanzarClick(b,d,e,c)}});b.cerrarButton=Ext.create({xtype:"button",text:"Cerrar",scope:c,ventanaScope:c,handler:function(d,e){b.cerrarClick(b,d,e,c)}});b.changeButtons(1);c.items=[b];c.buttons=[b.cancelarButton,b.avanzarButton,b.cerrarButton];c.callParent(arguments);b.ventanaScope=c}});Ext.define("At4FrameworkIntranet.ImportIteForm",{extend:"Ext.panel.Panel",layout:"card",cls:"importariee",activeItem:0,requestactive:false,changeButtons:function(a){var e=this.cancelarButton;var c=this.avanzarButton;var b=this.cerrarButton;var d=["alert","info","done","warn"];e.removeCls(d);c.removeCls(d);b.removeCls(d);switch(a){case 1:e.setText("Cancelar");c.setText("Siguiente");e.addCls("alert");c.addCls("info");b.hide();break;case 2:e.setText("Cancelar");c.setText("Reintentar");e.addCls("alert");c.addCls("warn");b.hide();break;case 3:e.setText("Revertir");c.setText("Guardar y abrir informe");b.setText("Guardar y cerrar");e.addCls("alert");c.addCls("done");b.addCls("info");b.show();break}},acciones:{enviarImportacion:function(){var e=this.getLayout();var c=this.primerFormFields.documentoIee;var f=this.primerFormFields.documentoPdf;var g=c.isValid();var b=f.isValid();if(!g||!b){return}var a=c.getTrigger("filebutton").component.fileInputEl.dom;var d=f.getTrigger("filebutton").component.fileInputEl.dom;if(!this.requestactive){this.requestactive=true;serverDatabaseActions.runAction(FormDataService.importIte,[a,d],function(l,j){var i=1;this.requestactive=false;if(!l.correcto){this.changeButtons(2);var h="<div class='ko-invalid'><span class='glyphicons glyphicons-remove-circle'></span>{0}</div>";var k=h.replace("{0}",l.errorMsg);this.tercerFormItems.box.update(k);this.tercerFormItems.logField.setValue(l.errorHtml);i=2}else{i=1;this.loadIee(l);this.changeButtons(3)}this.activeItem=i;e.setActiveItem(i)}.bind(this))}else{console.info("Se han intentado enviar diversas solicitudes de importacion")}},guardarYCerrar:function(){if(!this.requestactive){this.submitSaveImport(function(a){this.requestactive=false;this.ventanaScope.destroy()})}else{console.info("Se han intentado enviar diversas solicitudes de guardar datos")}},guardarYAbrir:function(){if(!this.requestactive){this.submitSaveImport(function(a){this.ventanaScope.destroy();At4FrameworkIntranet.app.openRecordForm(this.formItem,{oid:a.claveInforme})})}else{console.info("Se han intentado enviar diversas solicitudes de guardar datos")}},errorReintentar:function(){var a=this.getLayout();this.changeButtons(1);this.activeItem=0;a.setActiveItem(0);this.primerFormFields.documentoIee.reset();this.primerFormFields.documentoPdf.reset()},cerrarVentana:function(){this.ventanaScope.destroy()},cancelarImportacionActiva:function(){serverDatabaseActions.runAction(FormDataService.cancelImport,[this.claveInforme],function(a){if(a){this.acciones.cerrarVentana.call(this);Ext.Msg.alert("Correcto","Importacion revertida")}else{this.acciones.cerrarVentana.call(this);Ext.Msg.alert("Advertencia","No se pudo revertir la importación, por favor contacte con un administrador")}},serverDatabaseActions.exceptionHandler,this)}},avanzarClick:function(d,a,c,b){if(this.activeItem==0){this.acciones.enviarImportacion.call(this)}else{if(this.activeItem==1){this.acciones.guardarYAbrir.call(this)}else{if(this.activeItem==2){this.acciones.errorReintentar.call(this)}}}},cerrarClick:function(d,a,c,b){if(this.activeItem==0){}else{if(this.activeItem==1){this.acciones.guardarYCerrar.call(this)}else{if(this.activeItem==2){}}}},cancelarClick:function(d,a,c,b){if(this.activeItem==0){this.acciones.cerrarVentana.call(this)}else{if(this.activeItem==1){this.acciones.cancelarImportacionActiva.call(this)}else{if(this.activeItem==2){this.acciones.cerrarVentana.call(this)}}}},submitSaveImport:function(d){if(!this.segundoFormItems.estadoInforme.validate()||(this.segundoFormItems.nuevoEdificioAction.isVisible()&&!this.segundoFormItems.nuevoEdificioAction.validate())||(this.segundoFormItems.numeroExtra.isVisible()&&!this.segundoFormItems.numeroExtra.validate())){return}this.requestactive=true;var b=this.segundoFormItems.estadoInforme.getValue();var a=this.segundoFormItems.numeroExtra.getValue();var c=this.segundoFormItems.nuevoEdificioAction.getValue();serverDatabaseActions.runAction(FormDataService.saveImport,[this.claveInforme,b,a,c],d.bind(this),this)},loadIee:function(e){this.claveInforme=e.primaryKey;var c=3;var f=e.estadoInformeDisponibles;var g=Ext.create("Ext.data.Store",{fields:["clave","nombreEs","nombreCa"],data:f});for(var h in f){if(f.hasOwnProperty(h)){var a=f[h];if(a.clave!=3){c=a.clave}}}var i=e.edificiosDisponibles;var d=e.edificiosDisponibles[0];i.unshift({clave:-1,primaryLabel:"[Crear un nuevo registro]",numeroExtra:d.numeroExtra,numeroCatastro:d.numeroCatastro,viaLabel:d.viaLabel,});var b=Ext.create("Ext.data.Store",{fields:["clave","primaryLabel","numeroExtra","numeroCatastro","viaLabel"],data:i});this.segundoFormItems.nuevoEdificioAction.setStore(b);this.segundoFormItems.estadoInforme.setStore(g);this.segundoFormItems.estadoInforme.setValue(c);this.segundoFormItems.nuevoEdificio.setHidden(!e.edificioExistia);this.segundoFormItems.nuevoEdificioAction.setHidden(!e.edificioExistia);this.segundoFormItems.nuevoEdificioAction.setValue(-1);this.segundoFormItems.numeroExtra.setHidden(!e.edificioExistia)},constructor:function(d){Ext.apply(this,d);var e=new At4util.tabIndexHelper(this.tabIndex);var a={};a.documentoPdf=Ext.create({allowBlank:false,margin:"0 30px",xtype:"filefield",width:500,name:"filePDF"});var b=Ext.create("Ext.data.Store",{fields:["abbr","name"],data:[{abbr:"0",name:"--"},{abbr:"30",name:"30"},{abbr:"50",name:"50"}]});a.tipusIee=Ext.create({allowBlank:false,width:500,margin:"0 30px",xtype:"combobox",store:b,queryMode:"local",displayField:"name",valueField:"abbr",autoSelect:true,editable:false,forceSelection:true,name:"tipusIee"});a.renovacio=Ext.create({margin:"0 30px",xtype:"checkbox",name:"renovacio",boxLable:"renovación"});this.primerFormFields=a;var c=[{xtype:"At4Framework-fieldmainpanel",items:[At4FrameworkIntranet.FormDefaults.rows([[{xtype:"container",margin:"15px 15px 0px 30px",html:"<span class='iee'><span class='icono pdf'></span><span class='texto'>Documento PDF </span>(.pdf)</span>"}],[a.documentoPdf],[{xtype:"container",margin:"15px 15px 0px 30px",html:"<span class='iee'><span class='texto'>Tipo IEE </span></span>"}],[a.tipusIee],[{xtype:"container",margin:"15px 15px 0px 30px",html:"<span class='iee'><span class='texto'>Es renovación </span></span>"}],[a.renovacio],[{xtype:"container",margin:"15px 0 0 15px",width:500,html:"<span class='regimg'></span>"}]],{},{minWidth:null,})]}];var k={};k.numeroCatastro=new Ext.form.TextField({name:"numeroCatastro",fieldLabel:"Numero catastro",labelAttrTpl:" data-qtip='"+this.numeroCatastroDescriptionLabel+"'",tabIndex:e.getNext(),editable:false,width:At4FrameworkIntranet.FormDefaults.size(3,2,12),maxLength:64});k.via=new Ext.form.TextField({name:"viaId",fieldLabel:"Via",tabIndex:e.getNext(),editable:false,width:At4FrameworkIntranet.FormDefaults.size(4,2,12)});k.numeroExtra=new Ext.form.TextField({name:"numeroExtra",fieldLabel:"Numero extra",tabIndex:e.getNext(),allowBlank:false,width:At4FrameworkIntranet.FormDefaults.size(4,2,12),maxLength:64});k.estadoInforme=Ext.create("Ext.form.field.ComboBox",{name:"estadoInformeId",fieldLabel:"Estado del informe",tabIndex:e.getNext(),width:At4FrameworkIntranet.FormDefaults.size(3,2,12),allowBlank:false,valueField:"clave",displayField:At4FrameworkIntranet.app.idioma==="ca"?"nombreCa":"nombreEs",});k.resultado=Ext.create({xtype:"container",width:At4FrameworkIntranet.FormDefaults.size(7,0,12),height:"auto",html:'<div class="ok-valid"><span class="glyphicons glyphicons-ok-circle"></span><div class="mensaje"> Subida de informe realizada con éxito.<span class="block">Por favor, compruebe los siguientes datos:</span></div></div>'});k.nuevoEdificio=Ext.create({xtype:"container",height:"auto",hidden:true,width:At4FrameworkIntranet.FormDefaults.size(7,0,12),html:'<div class="edificio-existente"><span class="glyphicons glyphicons-warning-sign"></span>El edificio ya existia</span></div>'});k.nuevoEdificioAction=Ext.create("Ext.form.field.ComboBox",{name:"nuevoEdificioAction",tabIndex:e.getNext(),width:At4FrameworkIntranet.FormDefaults.size(7,0,12),allowBlank:false,queryMode:"local",hidden:true,displayField:"primaryLabel",valueField:"clave",listeners:{change:{fn:function(o,q,m,n){var l=o.getSelectedRecord();if(!l){return}var p=l.getData();if(p.clave===-1){this.segundoFormItems.numeroExtra.show()}else{this.segundoFormItems.numeroExtra.hide()}this.segundoFormItems.via.setValue(p.viaLabel);this.segundoFormItems.numeroCatastro.setValue(p.numeroCatastro)},scope:this}}});this.segundoFormItems=k;var g={xtype:"At4Framework-fieldmainpanel",items:[{xtype:"At4Framework-rowContainer",items:[k.resultado],margin:"10px 40px"},{xtype:"At4Framework-rowContainer",items:[k.estadoInforme,k.numeroExtra],margin:"10px 40px"},{xtype:"At4Framework-rowContainer",items:[k.nuevoEdificio],margin:"0 40px"},{xtype:"At4Framework-rowContainer",items:[k.nuevoEdificioAction],margin:"0 40px"},{xtype:"At4Framework-rowContainer",items:[k.via,k.numeroCatastro],margin:"10px 40px"}]};var i={};i.box=Ext.create({xtype:"container",width:"100%",html:"Step 3",margin:"10px 40px"});i.logField=Ext.create({xtype:"htmleditor",cls:"out log",editable:false,width:"100%",value:"<br>",readOnly:true,listeners:{render:{scope:this,fn:function(){i.logField.getToolbar().hide()}},initialize:function(l){var m={"font-family":"monospace","background-color":"#eeeeee"};Ext.DomHelper.applyStyles(l.getEditorBody(),m)}}});var j=Ext.create({xtype:"fieldset",width:"100%",border:true,collapsible:true,collapsed:true,title:"Traza del error",items:[i.logField],});this.tercerFormItems=i;var f=At4FrameworkIntranet.FormDefaults.rows([[this.tercerFormItems.box],[j]],{},{minWidth:null,});var h=[{items:c},{items:g},{items:f}];this.items=h;this.callParent()},formItem:{form:"informe",href:null,iconCls:"glyphicons glyphicons-newspaper",id:null,link:false,menu:null,mode:"list",parameters:null,text:"Informe"}});window.testIee={claveInforme:1607,correcto:true,creatorUser:null,dateCreation:null,edificioExistia:true,edificiosDisponibles:[{clave:-1,primaryLabel:"[Crear un nuevo registro]",numeroExtra:"Obligado",numeroCatastro:"79",viaLabel:"CONQUISTADOR",id:"extModel224-1"},{antiguedad:0,centroX:486776,centroY:4392639,clave:706,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1561,creatorUser:"admin",dateCreation:"2017-01-10T09:53:11.732Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:3,estadoInformeLabel:"En tramitación",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1562,ieeArxiuMime:"application/octet-stream",inspeccionId:1561,inspeccionLabel:"1561",lastModified:"2017-01-10T09:53:11.732Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1561,pdfArxiuMime:"application/pdf",primaryKey:1561,primaryLabel:"1561"},{clave:1544,creatorUser:"admin",dateCreation:"2017-01-10T09:28:23.898Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1548,ieeArxiuMime:"application/octet-stream",inspeccionId:1544,inspeccionLabel:"1544",lastModified:"2017-01-10T09:28:23.898Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1547,pdfArxiuMime:"application/pdf",primaryKey:1544,primaryLabel:"1544"},{clave:1604,creatorUser:"admin",dateCreation:"2017-01-10T11:39:09.504Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1588,ieeArxiuMime:"application/octet-stream",inspeccionId:1604,inspeccionLabel:"1604",lastModified:"2017-01-10T11:39:09.504Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1587,pdfArxiuMime:"application/pdf",primaryKey:1604,primaryLabel:"1604"},{clave:1605,creatorUser:"admin",dateCreation:"2017-01-10T11:41:24.947Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1590,ieeArxiuMime:"application/octet-stream",inspeccionId:1605,inspeccionLabel:"1605",lastModified:"2017-01-10T11:41:24.947Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1589,pdfArxiuMime:"application/pdf",primaryKey:1605,primaryLabel:"1605"},{clave:1606,creatorUser:"admin",dateCreation:"2017-01-10T11:45:15.687Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1592,ieeArxiuMime:"application/octet-stream",inspeccionId:1606,inspeccionLabel:"1606",lastModified:"2017-01-10T11:45:15.687Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1591,pdfArxiuMime:"application/pdf",primaryKey:1606,primaryLabel:"1606"},{clave:1602,creatorUser:"admin",dateCreation:"2017-01-10T11:24:39.466Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1584,ieeArxiuMime:"application/octet-stream",inspeccionId:1602,inspeccionLabel:"1602",lastModified:"2017-01-10T11:24:39.466Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1583,pdfArxiuMime:"application/pdf",primaryKey:1602,primaryLabel:"1602"},{clave:1521,creatorUser:"admin",dateCreation:"2017-01-10T08:50:26.479Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1522,ieeArxiuMime:"application/octet-stream",inspeccionId:1521,inspeccionLabel:"1521",lastModified:"2017-01-10T08:50:26.479Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1521,pdfArxiuMime:"application/pdf",primaryKey:1521,primaryLabel:"1521"},{clave:1522,creatorUser:"admin",dateCreation:"2017-01-10T08:56:35.920Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1524,ieeArxiuMime:"application/octet-stream",inspeccionId:1522,inspeccionLabel:"1522",lastModified:"2017-01-10T08:56:35.920Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1523,pdfArxiuMime:"application/pdf",primaryKey:1522,primaryLabel:"1522"},{clave:1523,creatorUser:"admin",dateCreation:"2017-01-10T08:57:08.424Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1526,ieeArxiuMime:"application/octet-stream",inspeccionId:1523,inspeccionLabel:"1523",lastModified:"2017-01-10T08:57:08.424Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1525,pdfArxiuMime:"application/pdf",primaryKey:1523,primaryLabel:"1523"},{clave:1601,creatorUser:"admin",dateCreation:"2017-01-10T11:13:47.550Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:3,estadoInformeLabel:"En tramitación",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1582,ieeArxiuMime:"application/octet-stream",inspeccionId:1601,inspeccionLabel:"1601",lastModified:"2017-01-10T11:13:47.550Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1581,pdfArxiuMime:"application/pdf",primaryKey:1601,primaryLabel:"1601"},{clave:1603,creatorUser:"admin",dateCreation:"2017-01-10T11:24:58.788Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1586,ieeArxiuMime:"application/octet-stream",inspeccionId:1603,inspeccionLabel:"1603",lastModified:"2017-01-10T11:24:58.788Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1585,pdfArxiuMime:"application/pdf",primaryKey:1603,primaryLabel:"1603"},{clave:1541,creatorUser:"admin",dateCreation:"2017-01-10T09:05:04.892Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1542,ieeArxiuMime:"application/octet-stream",inspeccionId:1541,inspeccionLabel:"1541",lastModified:"2017-01-10T09:05:04.892Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1541,pdfArxiuMime:"application/pdf",primaryKey:1541,primaryLabel:"1541"},{clave:1542,creatorUser:"admin",dateCreation:"2017-01-10T09:20:20.546Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1544,ieeArxiuMime:"application/octet-stream",inspeccionId:1542,inspeccionLabel:"1542",lastModified:"2017-01-10T09:20:20.546Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1543,pdfArxiuMime:"application/pdf",primaryKey:1542,primaryLabel:"1542"},{clave:1543,creatorUser:"admin",dateCreation:"2017-01-10T09:25:17.582Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1546,ieeArxiuMime:"application/octet-stream",inspeccionId:1543,inspeccionLabel:"1543",lastModified:"2017-01-10T09:25:17.582Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1545,pdfArxiuMime:"application/pdf",primaryKey:1543,primaryLabel:"1543"},{clave:1185,creatorUser:"admin",dateCreation:"2016-12-05T15:06:44.769Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2016-12-04T23:00:00.000Z",fechaInforme:"2016-12-04T23:00:00.000Z",ieeArxiu:1150,ieeArxiuMime:"application/octet-stream",inspeccionId:1185,inspeccionLabel:"1185",lastModified:"2016-12-05T15:06:44.769Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1149,pdfArxiuMime:"application/pdf",primaryKey:1185,primaryLabel:"1185"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:"Obligado",primaryKey:706,primaryLabel:"CONQUISTADOR, 79 (Obligado)",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-2"},{antiguedad:0,centroX:486776,centroY:4392639,clave:861,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1501,creatorUser:"admin",dateCreation:"2017-01-10T08:12:57.222Z",edificioId:861,edificioLabel:"CONQUISTADOR, 79",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1502,ieeArxiuMime:"application/octet-stream",inspeccionId:1501,inspeccionLabel:"1501",lastModified:"2017-01-10T08:12:57.222Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1501,pdfArxiuMime:"application/pdf",primaryKey:1501,primaryLabel:"1501"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:null,primaryKey:861,primaryLabel:"CONQUISTADOR, 79",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-3"},{antiguedad:0,centroX:486776,centroY:4392639,clave:663,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:null,primaryKey:663,primaryLabel:"CONQUISTADOR, 79",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-4"},{antiguedad:0,centroX:486776,centroY:4392639,clave:664,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1143,creatorUser:"admin",dateCreation:"2016-12-05T13:56:39.777Z",edificioId:664,edificioLabel:"CONQUISTADOR, 79",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2016-12-04T23:00:00.000Z",fechaInforme:"2016-12-04T23:00:00.000Z",ieeArxiu:1106,ieeArxiuMime:"application/octet-stream",inspeccionId:1143,inspeccionLabel:"1143",lastModified:"2016-12-05T13:56:39.777Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1105,pdfArxiuMime:"application/pdf",primaryKey:1143,primaryLabel:"1143"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:null,primaryKey:664,primaryLabel:"CONQUISTADOR, 79",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-5"},{antiguedad:0,centroX:486776,centroY:4392639,clave:862,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1524,creatorUser:"admin",dateCreation:"2017-01-10T08:58:36.450Z",edificioId:862,edificioLabel:"CONQUISTADOR, 79",estadoInformeId:4,estadoInformeLabel:"Anulado",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1528,ieeArxiuMime:"application/octet-stream",inspeccionId:1524,inspeccionLabel:"1524",lastModified:"2017-01-10T09:01:57.527Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1527,pdfArxiuMime:"application/pdf",primaryKey:1524,primaryLabel:"1524"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:null,primaryKey:862,primaryLabel:"CONQUISTADOR, 79",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-6"},{antiguedad:0,centroX:486776,centroY:4392639,clave:881,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1545,creatorUser:"admin",dateCreation:"2017-01-10T09:29:05.151Z",edificioId:881,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1550,ieeArxiuMime:"application/octet-stream",inspeccionId:1545,inspeccionLabel:"1545",lastModified:"2017-01-10T09:29:05.151Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1549,pdfArxiuMime:"application/pdf",primaryKey:1545,primaryLabel:"1545"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:"Obligado",primaryKey:881,primaryLabel:"CONQUISTADOR, 79 (Obligado)",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-7"}],errorHtml:null,errorMsg:null,estadoInformeDisponibles:[{clave:3,creatorUser:null,dateCreation:"2016-10-10T13:15:23.000Z",lastModified:"2016-10-10T13:15:23.000Z",modUser:null,nombreCa:"En tramitació",nombreEs:"En tramitación",primaryKey:3,primaryLabel:"En tramitación",id:"extModel222-1"},{clave:2,creatorUser:null,dateCreation:"2016-10-10T13:15:23.000Z",lastModified:"2016-10-10T13:15:23.000Z",modUser:null,nombreCa:"Desfavorable",nombreEs:"Desfavorable",primaryKey:2,primaryLabel:"Desfavorable",id:"extModel222-2"}],estadoInformeId:5,estadoInformeLabel:"En curso",lastModified:null,modUser:null,primaryKey:1607,primaryLabel:"En curso"};Ext.define("At4FrameworkIntranet.InspeccionGrid",{extend:"At4FrameworkIntranet.ListadoGrid",constructor:function(){var b="./export/inspeccionExportar";var a=[{text:"excel",iconCls:"icon-export-excel",scope:this,handler:function(){this.exportFile("xls",b)}},{text:"csv",iconCls:"icon-export-csv",scope:this,handler:function(){this.exportFile("csv",b)}},{text:"pdf",iconCls:"icon-export-pdf",scope:this,handler:function(){this.exportFile("pdf",b)}},{text:"docx",iconCls:"icon-export-docx",scope:this,handler:function(){this.exportFile("docx",b)}}];this.extraSubMenuHerramientas={text:"Exportacion combinada",iconCls:"glyphicons glyphicons-package",menu:{items:a}};this.callParent(arguments)}});Ext.define("At4FrameworkIntranet.SubsanacioWindow",{extend:"At4FrameworkIntranet.Window",title:"Dar de alta una Inspección",closable:false,closeAction:"destroy",height:400,width:600,resizable:false,modal:true,cls:"importarieewindow",constructor:function(a){var c=this;var b=Ext.create("At4FrameworkIntranet.SubsanacioForm");b.cancelarButton=Ext.create({text:"Cancelar",xtype:"button",handler:function(d,e){b.cancelarClick(b,d,e,c)}});b.avanzarButton=Ext.create({xtype:"button",text:"Siguiente",scope:c,ventanaScope:c,handler:function(d,e){b.avanzarClick(b,d,e,c)}});b.cerrarButton=Ext.create({xtype:"button",text:"Cerrar",scope:c,ventanaScope:c,handler:function(d,e){b.cerrarClick(b,d,e,c)}});b.changeButtons(1);c.items=[b];c.buttons=[b.cancelarButton,b.avanzarButton,b.cerrarButton];c.callParent(arguments);b.ventanaScope=c}});Ext.define("At4FrameworkIntranet.SubsanacioForm",{extend:"Ext.panel.Panel",layout:"card",cls:"importariee",activeItem:0,requestactive:false,changeButtons:function(a){var e=this.cancelarButton;var c=this.avanzarButton;var b=this.cerrarButton;var d=["alert","info","done","warn"];e.removeCls(d);c.removeCls(d);b.removeCls(d);switch(a){case 1:e.setText("Cancelar");c.setText("Siguiente");e.addCls("alert");c.addCls("info");b.hide();break;case 2:e.setText("Cancelar");c.setText("Reintentar");e.addCls("alert");c.addCls("warn");b.hide();break;case 3:e.setText("Revertir");c.setText("Guardar y abrir informe");b.setText("Guardar y cerrar");e.addCls("alert");c.addCls("done");b.addCls("info");b.show();break}},acciones:{enviarImportacion:function(){var e=this.getLayout();var c=this.primerFormFields.documentoIee;var f=this.primerFormFields.documentoPdf;var g=c.isValid();var b=f.isValid();if(!g||!b){return}var a=c.getTrigger("filebutton").component.fileInputEl.dom;var d=f.getTrigger("filebutton").component.fileInputEl.dom;if(!this.requestactive){this.requestactive=true;serverDatabaseActions.runAction(FormDataService.subsanacio,[a,d],function(l,j){var i=1;this.requestactive=false;if(!l.correcto){this.changeButtons(2);var h="<div class='ko-invalid'><span class='glyphicons glyphicons-remove-circle'></span>{0}</div>";var k=h.replace("{0}",l.errorMsg);this.tercerFormItems.box.update(k);this.tercerFormItems.logField.setValue(l.errorHtml);i=2}else{i=1;this.loadIee(l);this.changeButtons(3)}this.activeItem=i;e.setActiveItem(i)}.bind(this))}else{console.info("Se han intentado enviar diversas solicitudes de importacion")}},guardarYCerrar:function(){if(!this.requestactive){this.submitSaveImport(function(a){this.requestactive=false;this.ventanaScope.destroy()})}else{console.info("Se han intentado enviar diversas solicitudes de guardar datos")}},guardarYAbrir:function(){if(!this.requestactive){this.submitSaveImport(function(a){this.ventanaScope.destroy();At4FrameworkIntranet.app.openRecordForm(this.formItem,{oid:a.claveInforme})})}else{console.info("Se han intentado enviar diversas solicitudes de guardar datos")}},errorReintentar:function(){var a=this.getLayout();this.changeButtons(1);this.activeItem=0;a.setActiveItem(0);this.primerFormFields.documentoIee.reset();this.primerFormFields.documentoPdf.reset()},cerrarVentana:function(){this.ventanaScope.destroy()},cancelarImportacionActiva:function(){serverDatabaseActions.runAction(FormDataService.cancelImport,[this.claveInforme],function(a){if(a){this.acciones.cerrarVentana.call(this);Ext.Msg.alert("Correcto","Importacion revertida")}else{this.acciones.cerrarVentana.call(this);Ext.Msg.alert("Advertencia","No se pudo revertir la importación, por favor contacte con un administrador")}},serverDatabaseActions.exceptionHandler,this)}},avanzarClick:function(d,a,c,b){if(this.activeItem==0){this.acciones.enviarImportacion.call(this)}else{if(this.activeItem==1){this.acciones.guardarYAbrir.call(this)}else{if(this.activeItem==2){this.acciones.errorReintentar.call(this)}}}},cerrarClick:function(d,a,c,b){if(this.activeItem==0){}else{if(this.activeItem==1){this.acciones.guardarYCerrar.call(this)}else{if(this.activeItem==2){}}}},cancelarClick:function(d,a,c,b){if(this.activeItem==0){this.acciones.cerrarVentana.call(this)}else{if(this.activeItem==1){this.acciones.cancelarImportacionActiva.call(this)}else{if(this.activeItem==2){this.acciones.cerrarVentana.call(this)}}}},submitSaveImport:function(d){if(!this.segundoFormItems.estadoInforme.validate()||(this.segundoFormItems.nuevoEdificioAction.isVisible()&&!this.segundoFormItems.nuevoEdificioAction.validate())||(this.segundoFormItems.numeroExtra.isVisible()&&!this.segundoFormItems.numeroExtra.validate())){return}this.requestactive=true;var b=this.segundoFormItems.estadoInforme.getValue();var a=this.segundoFormItems.numeroExtra.getValue();var c=this.segundoFormItems.nuevoEdificioAction.getValue();serverDatabaseActions.runAction(FormDataService.saveImport,[this.claveInforme,b,a,c],d.bind(this),this)},loadIee:function(e){this.claveInforme=e.primaryKey;var c=3;var f=e.estadoInformeDisponibles;var g=Ext.create("Ext.data.Store",{fields:["clave","nombreEs","nombreCa"],data:f});for(var h in f){if(f.hasOwnProperty(h)){var a=f[h];if(a.clave!=3){c=a.clave}}}var i=e.edificiosDisponibles;var d=e.edificiosDisponibles[0];i.unshift({clave:-1,primaryLabel:"[Crear un nuevo registro]",numeroExtra:d.numeroExtra,numeroCatastro:d.numeroCatastro,viaLabel:d.viaLabel,});var b=Ext.create("Ext.data.Store",{fields:["clave","primaryLabel","numeroExtra","numeroCatastro","viaLabel"],data:i});this.segundoFormItems.nuevoEdificioAction.setStore(b);this.segundoFormItems.estadoInforme.setStore(g);this.segundoFormItems.estadoInforme.setValue(c);this.segundoFormItems.nuevoEdificio.setHidden(!e.edificioExistia);this.segundoFormItems.nuevoEdificioAction.setHidden(!e.edificioExistia);this.segundoFormItems.nuevoEdificioAction.setValue(-1);this.segundoFormItems.numeroExtra.setHidden(!e.edificioExistia)},constructor:function(d){Ext.apply(this,d);var e=new At4util.tabIndexHelper(this.tabIndex);var a={};a.documentoPdf=Ext.create({allowBlank:false,margin:"0 30px",xtype:"filefield",width:500,name:"filePDF"});var b=Ext.create("Ext.data.Store",{fields:["abbr","name"],data:[{abbr:"0",name:"--"},{abbr:"30",name:"30"},{abbr:"50",name:"50"}]});a.tipusIee=Ext.create({allowBlank:false,width:500,margin:"0 30px",xtype:"combobox",store:b,queryMode:"local",displayField:"name",valueField:"abbr",autoSelect:true,editable:false,forceSelection:true,name:"tipusIee"});a.renovacio=Ext.create({margin:"0 30px",xtype:"checkbox",name:"renovacio",boxLable:"renovación"});this.primerFormFields=a;var c=[{xtype:"At4Framework-fieldmainpanel",items:[At4FrameworkIntranet.FormDefaults.rows([[{xtype:"container",margin:"15px 15px 0px 30px",html:"<span class='iee'><span class='icono pdf'></span><span class='texto'>Documento PDF </span>(.pdf)</span>"}],[a.documentoPdf],[{xtype:"container",margin:"15px 15px 0px 30px",html:"<span class='iee'><span class='texto'>Tipo IEE </span></span>"}],[a.tipusIee],[{xtype:"container",margin:"15px 15px 0px 30px",html:"<span class='iee'><span class='texto'>Es renovación </span></span>"}],[a.renovacio],[{xtype:"container",margin:"15px 0 0 15px",width:500,html:"<span class='regimg'></span>"}]],{},{minWidth:null,})]}];var k={};k.numeroCatastro=new Ext.form.TextField({name:"numeroCatastro",fieldLabel:"Numero catastro",labelAttrTpl:" data-qtip='"+this.numeroCatastroDescriptionLabel+"'",tabIndex:e.getNext(),editable:false,width:At4FrameworkIntranet.FormDefaults.size(3,2,12),maxLength:64});k.via=new Ext.form.TextField({name:"viaId",fieldLabel:"Via",tabIndex:e.getNext(),editable:false,width:At4FrameworkIntranet.FormDefaults.size(4,2,12)});k.numeroExtra=new Ext.form.TextField({name:"numeroExtra",fieldLabel:"Numero extra",tabIndex:e.getNext(),allowBlank:false,width:At4FrameworkIntranet.FormDefaults.size(4,2,12),maxLength:64});k.estadoInforme=Ext.create("Ext.form.field.ComboBox",{name:"estadoInformeId",fieldLabel:"Estado del informe",tabIndex:e.getNext(),width:At4FrameworkIntranet.FormDefaults.size(3,2,12),allowBlank:false,valueField:"clave",displayField:At4FrameworkIntranet.app.idioma==="ca"?"nombreCa":"nombreEs",});k.resultado=Ext.create({xtype:"container",width:At4FrameworkIntranet.FormDefaults.size(7,0,12),height:"auto",html:'<div class="ok-valid"><span class="glyphicons glyphicons-ok-circle"></span><div class="mensaje"> Subida de informe realizada con éxito.<span class="block">Por favor, compruebe los siguientes datos:</span></div></div>'});k.nuevoEdificio=Ext.create({xtype:"container",height:"auto",hidden:true,width:At4FrameworkIntranet.FormDefaults.size(7,0,12),html:'<div class="edificio-existente"><span class="glyphicons glyphicons-warning-sign"></span>El edificio ya existia</span></div>'});k.nuevoEdificioAction=Ext.create("Ext.form.field.ComboBox",{name:"nuevoEdificioAction",tabIndex:e.getNext(),width:At4FrameworkIntranet.FormDefaults.size(7,0,12),allowBlank:false,queryMode:"local",hidden:true,displayField:"primaryLabel",valueField:"clave",listeners:{change:{fn:function(o,q,m,n){var l=o.getSelectedRecord();if(!l){return}var p=l.getData();if(p.clave===-1){this.segundoFormItems.numeroExtra.show()}else{this.segundoFormItems.numeroExtra.hide()}this.segundoFormItems.via.setValue(p.viaLabel);this.segundoFormItems.numeroCatastro.setValue(p.numeroCatastro)},scope:this}}});this.segundoFormItems=k;var g={xtype:"At4Framework-fieldmainpanel",items:[{xtype:"At4Framework-rowContainer",items:[k.resultado],margin:"10px 40px"},{xtype:"At4Framework-rowContainer",items:[k.estadoInforme,k.numeroExtra],margin:"10px 40px"},{xtype:"At4Framework-rowContainer",items:[k.nuevoEdificio],margin:"0 40px"},{xtype:"At4Framework-rowContainer",items:[k.nuevoEdificioAction],margin:"0 40px"},{xtype:"At4Framework-rowContainer",items:[k.via,k.numeroCatastro],margin:"10px 40px"}]};var i={};i.box=Ext.create({xtype:"container",width:"100%",html:"Step 3",margin:"10px 40px"});i.logField=Ext.create({xtype:"htmleditor",cls:"out log",editable:false,width:"100%",value:"<br>",readOnly:true,listeners:{render:{scope:this,fn:function(){i.logField.getToolbar().hide()}},initialize:function(l){var m={"font-family":"monospace","background-color":"#eeeeee"};Ext.DomHelper.applyStyles(l.getEditorBody(),m)}}});var j=Ext.create({xtype:"fieldset",width:"100%",border:true,collapsible:true,collapsed:true,title:"Traza del error",items:[i.logField],});this.tercerFormItems=i;var f=At4FrameworkIntranet.FormDefaults.rows([[this.tercerFormItems.box],[j]],{},{minWidth:null,});var h=[{items:c},{items:g},{items:f}];this.items=h;this.callParent()},formItem:{form:"informe",href:null,iconCls:"glyphicons glyphicons-newspaper",id:null,link:false,menu:null,mode:"list",parameters:null,text:"Informe"}});window.testIee={claveInforme:1607,correcto:true,creatorUser:null,dateCreation:null,edificioExistia:true,edificiosDisponibles:[{clave:-1,primaryLabel:"[Crear un nuevo registro]",numeroExtra:"Obligado",numeroCatastro:"79",viaLabel:"CONQUISTADOR",id:"extModel224-1"},{antiguedad:0,centroX:486776,centroY:4392639,clave:706,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1561,creatorUser:"admin",dateCreation:"2017-01-10T09:53:11.732Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:3,estadoInformeLabel:"En tramitación",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1562,ieeArxiuMime:"application/octet-stream",inspeccionId:1561,inspeccionLabel:"1561",lastModified:"2017-01-10T09:53:11.732Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1561,pdfArxiuMime:"application/pdf",primaryKey:1561,primaryLabel:"1561"},{clave:1544,creatorUser:"admin",dateCreation:"2017-01-10T09:28:23.898Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1548,ieeArxiuMime:"application/octet-stream",inspeccionId:1544,inspeccionLabel:"1544",lastModified:"2017-01-10T09:28:23.898Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1547,pdfArxiuMime:"application/pdf",primaryKey:1544,primaryLabel:"1544"},{clave:1604,creatorUser:"admin",dateCreation:"2017-01-10T11:39:09.504Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1588,ieeArxiuMime:"application/octet-stream",inspeccionId:1604,inspeccionLabel:"1604",lastModified:"2017-01-10T11:39:09.504Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1587,pdfArxiuMime:"application/pdf",primaryKey:1604,primaryLabel:"1604"},{clave:1605,creatorUser:"admin",dateCreation:"2017-01-10T11:41:24.947Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1590,ieeArxiuMime:"application/octet-stream",inspeccionId:1605,inspeccionLabel:"1605",lastModified:"2017-01-10T11:41:24.947Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1589,pdfArxiuMime:"application/pdf",primaryKey:1605,primaryLabel:"1605"},{clave:1606,creatorUser:"admin",dateCreation:"2017-01-10T11:45:15.687Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1592,ieeArxiuMime:"application/octet-stream",inspeccionId:1606,inspeccionLabel:"1606",lastModified:"2017-01-10T11:45:15.687Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1591,pdfArxiuMime:"application/pdf",primaryKey:1606,primaryLabel:"1606"},{clave:1602,creatorUser:"admin",dateCreation:"2017-01-10T11:24:39.466Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1584,ieeArxiuMime:"application/octet-stream",inspeccionId:1602,inspeccionLabel:"1602",lastModified:"2017-01-10T11:24:39.466Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1583,pdfArxiuMime:"application/pdf",primaryKey:1602,primaryLabel:"1602"},{clave:1521,creatorUser:"admin",dateCreation:"2017-01-10T08:50:26.479Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1522,ieeArxiuMime:"application/octet-stream",inspeccionId:1521,inspeccionLabel:"1521",lastModified:"2017-01-10T08:50:26.479Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1521,pdfArxiuMime:"application/pdf",primaryKey:1521,primaryLabel:"1521"},{clave:1522,creatorUser:"admin",dateCreation:"2017-01-10T08:56:35.920Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1524,ieeArxiuMime:"application/octet-stream",inspeccionId:1522,inspeccionLabel:"1522",lastModified:"2017-01-10T08:56:35.920Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1523,pdfArxiuMime:"application/pdf",primaryKey:1522,primaryLabel:"1522"},{clave:1523,creatorUser:"admin",dateCreation:"2017-01-10T08:57:08.424Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1526,ieeArxiuMime:"application/octet-stream",inspeccionId:1523,inspeccionLabel:"1523",lastModified:"2017-01-10T08:57:08.424Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1525,pdfArxiuMime:"application/pdf",primaryKey:1523,primaryLabel:"1523"},{clave:1601,creatorUser:"admin",dateCreation:"2017-01-10T11:13:47.550Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:3,estadoInformeLabel:"En tramitación",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1582,ieeArxiuMime:"application/octet-stream",inspeccionId:1601,inspeccionLabel:"1601",lastModified:"2017-01-10T11:13:47.550Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1581,pdfArxiuMime:"application/pdf",primaryKey:1601,primaryLabel:"1601"},{clave:1603,creatorUser:"admin",dateCreation:"2017-01-10T11:24:58.788Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:5,estadoInformeLabel:"En curso",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1586,ieeArxiuMime:"application/octet-stream",inspeccionId:1603,inspeccionLabel:"1603",lastModified:"2017-01-10T11:24:58.788Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1585,pdfArxiuMime:"application/pdf",primaryKey:1603,primaryLabel:"1603"},{clave:1541,creatorUser:"admin",dateCreation:"2017-01-10T09:05:04.892Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1542,ieeArxiuMime:"application/octet-stream",inspeccionId:1541,inspeccionLabel:"1541",lastModified:"2017-01-10T09:05:04.892Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1541,pdfArxiuMime:"application/pdf",primaryKey:1541,primaryLabel:"1541"},{clave:1542,creatorUser:"admin",dateCreation:"2017-01-10T09:20:20.546Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1544,ieeArxiuMime:"application/octet-stream",inspeccionId:1542,inspeccionLabel:"1542",lastModified:"2017-01-10T09:20:20.546Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1543,pdfArxiuMime:"application/pdf",primaryKey:1542,primaryLabel:"1542"},{clave:1543,creatorUser:"admin",dateCreation:"2017-01-10T09:25:17.582Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1546,ieeArxiuMime:"application/octet-stream",inspeccionId:1543,inspeccionLabel:"1543",lastModified:"2017-01-10T09:25:17.582Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1545,pdfArxiuMime:"application/pdf",primaryKey:1543,primaryLabel:"1543"},{clave:1185,creatorUser:"admin",dateCreation:"2016-12-05T15:06:44.769Z",edificioId:706,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2016-12-04T23:00:00.000Z",fechaInforme:"2016-12-04T23:00:00.000Z",ieeArxiu:1150,ieeArxiuMime:"application/octet-stream",inspeccionId:1185,inspeccionLabel:"1185",lastModified:"2016-12-05T15:06:44.769Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1149,pdfArxiuMime:"application/pdf",primaryKey:1185,primaryLabel:"1185"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:"Obligado",primaryKey:706,primaryLabel:"CONQUISTADOR, 79 (Obligado)",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-2"},{antiguedad:0,centroX:486776,centroY:4392639,clave:861,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1501,creatorUser:"admin",dateCreation:"2017-01-10T08:12:57.222Z",edificioId:861,edificioLabel:"CONQUISTADOR, 79",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1502,ieeArxiuMime:"application/octet-stream",inspeccionId:1501,inspeccionLabel:"1501",lastModified:"2017-01-10T08:12:57.222Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1501,pdfArxiuMime:"application/pdf",primaryKey:1501,primaryLabel:"1501"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:null,primaryKey:861,primaryLabel:"CONQUISTADOR, 79",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-3"},{antiguedad:0,centroX:486776,centroY:4392639,clave:663,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:null,primaryKey:663,primaryLabel:"CONQUISTADOR, 79",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-4"},{antiguedad:0,centroX:486776,centroY:4392639,clave:664,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1143,creatorUser:"admin",dateCreation:"2016-12-05T13:56:39.777Z",edificioId:664,edificioLabel:"CONQUISTADOR, 79",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2016-12-04T23:00:00.000Z",fechaInforme:"2016-12-04T23:00:00.000Z",ieeArxiu:1106,ieeArxiuMime:"application/octet-stream",inspeccionId:1143,inspeccionLabel:"1143",lastModified:"2016-12-05T13:56:39.777Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1105,pdfArxiuMime:"application/pdf",primaryKey:1143,primaryLabel:"1143"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:null,primaryKey:664,primaryLabel:"CONQUISTADOR, 79",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-5"},{antiguedad:0,centroX:486776,centroY:4392639,clave:862,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1524,creatorUser:"admin",dateCreation:"2017-01-10T08:58:36.450Z",edificioId:862,edificioLabel:"CONQUISTADOR, 79",estadoInformeId:4,estadoInformeLabel:"Anulado",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1528,ieeArxiuMime:"application/octet-stream",inspeccionId:1524,inspeccionLabel:"1524",lastModified:"2017-01-10T09:01:57.527Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1527,pdfArxiuMime:"application/pdf",primaryKey:1524,primaryLabel:"1524"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:null,primaryKey:862,primaryLabel:"CONQUISTADOR, 79",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-6"},{antiguedad:0,centroX:486776,centroY:4392639,clave:881,creatorUser:"admin",dateCreation:"2016-12-05T13:56:42.859Z",informes:[{clave:1545,creatorUser:"admin",dateCreation:"2017-01-10T09:29:05.151Z",edificioId:881,edificioLabel:"CONQUISTADOR, 79 (Obligado)",estadoInformeId:2,estadoInformeLabel:"Desfavorable",fechaAlta:"2017-01-09T23:00:00.000Z",fechaInforme:"2017-01-09T23:00:00.000Z",ieeArxiu:1550,ieeArxiuMime:"application/octet-stream",inspeccionId:1545,inspeccionLabel:"1545",lastModified:"2017-01-10T09:29:05.151Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",pdfArxiu:1549,pdfArxiuMime:"application/pdf",primaryKey:1545,primaryLabel:"1545"}],lastModified:"2016-12-05T13:56:42.859Z",modUser:"admin",municipioId:353,municipioLabel:"BINISSALEM",numeroCatastro:"79",numeroExtra:"Obligado",primaryKey:881,primaryLabel:"CONQUISTADOR, 79 (Obligado)",referenciaCatastral:"6928216DD8962N",viaId:3639,viaLabel:"CONQUISTADOR",id:"extModel224-7"}],errorHtml:null,errorMsg:null,estadoInformeDisponibles:[{clave:3,creatorUser:null,dateCreation:"2016-10-10T13:15:23.000Z",lastModified:"2016-10-10T13:15:23.000Z",modUser:null,nombreCa:"En tramitació",nombreEs:"En tramitación",primaryKey:3,primaryLabel:"En tramitación",id:"extModel222-1"},{clave:2,creatorUser:null,dateCreation:"2016-10-10T13:15:23.000Z",lastModified:"2016-10-10T13:15:23.000Z",modUser:null,nombreCa:"Desfavorable",nombreEs:"Desfavorable",primaryKey:2,primaryLabel:"Desfavorable",id:"extModel222-2"}],estadoInformeId:5,estadoInformeLabel:"En curso",lastModified:null,modUser:null,primaryKey:1607,primaryLabel:"En curso"};